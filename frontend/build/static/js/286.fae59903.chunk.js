"use strict";(self.webpackChunkmy_react_app=self.webpackChunkmy_react_app||[]).push([[286],{48286:(e,s,t)=>{t.r(s),t.d(s,{default:()=>$e});var i=t(72791),n=t(37795),a=t(78914),l=t(84994),r=t(22741),o=t(88116),c=t(94744),d=t(9347),m=t(1716),u=(t(91344),t(80184));const h=function(e){var s;let{event:t,stats:a,onClose:l,onRefresh:c,orgId:d}=e;const[h,v]=(0,i.useState)(!1),{AtlasMain:g}=(0,o.Q)(),{addNotification:p}=(0,r.l)(),x=e=>{if(!e)return"";return new Date(e).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"})},j=(()=>{if(null===t||void 0===t||!t.start_time)return null;const e=new Date;return new Date(t.start_time)>e?"upcoming":"passed"})();return(0,u.jsxs)("div",{className:"event-dashboard-header",children:[(0,u.jsx)("div",{className:"header-background",children:(0,u.jsx)("img",{src:g,alt:""})}),(0,u.jsxs)("div",{className:"header-content",children:[(0,u.jsxs)("div",{className:"header-top",children:[(0,u.jsx)("button",{className:"close-btn",onClick:l,children:(0,u.jsx)(n.JO,{icon:"mdi:close"})}),(0,u.jsxs)("div",{className:"header-actions",children:["draft"===(null===t||void 0===t?void 0:t.status)&&(0,u.jsxs)("button",{className:"action-btn publish",onClick:async()=>{if(null!==t&&void 0!==t&&t._id){v(!0);try{const e=await(0,m.Z)(`/publish-event/${t._id}`,{},{method:"POST"});if(!e.success)throw new Error(e.message||e.error);p({title:"Event Published",message:"pending"===e.status?"Event submitted for approval.":"Event published successfully.",type:"success"}),null===c||void 0===c||c()}catch(e){p({title:"Publish Failed",message:e.message||"Failed to publish event.",type:"error"})}finally{v(!1)}}},disabled:h,title:"Publish Event",children:[(0,u.jsx)(n.JO,{icon:"mdi:publish"}),(0,u.jsx)("span",{children:h?"Publishing...":"Publish"})]}),(0,u.jsx)("button",{className:"action-btn refresh",onClick:c,title:"Refresh",children:(0,u.jsx)(n.JO,{icon:"mdi:refresh"})}),(0,u.jsx)("button",{className:"action-btn share",onClick:async()=>{if(null===t||void 0===t||!t._id)return;const e=`${window.location.origin}/event/${t._id}`;try{await navigator.clipboard.writeText(e),p({title:"Success",message:"Event link copied to clipboard",type:"success"})}catch(s){const t=document.createElement("textarea");t.value=e,t.style.position="fixed",t.style.left="-999999px",document.body.appendChild(t),t.select();try{document.execCommand("copy"),p({title:"Success",message:"Event link copied to clipboard",type:"success"})}catch(s){p({title:"Error",message:"Failed to copy link to clipboard",type:"error"})}document.body.removeChild(t)}},title:"Copy Event Link",disabled:!(null!==t&&void 0!==t&&t._id),children:(0,u.jsx)(n.JO,{icon:"mdi:share-variant"})}),(0,u.jsxs)("button",{className:"action-btn preview",onClick:()=>{if(null===t||void 0===t||!t._id)return;const e=`${window.location.origin}/event/${t._id}`;window.open(e,"_blank","noopener,noreferrer")},title:"Preview Event",disabled:!(null!==t&&void 0!==t&&t._id),children:[(0,u.jsx)(n.JO,{icon:"mdi:open-in-new"}),(0,u.jsx)("span",{children:"Preview"})]})]})]}),(0,u.jsxs)("div",{className:"header-main",children:[(0,u.jsxs)("div",{className:"event-title-section",children:[(0,u.jsx)("h1",{children:(null===t||void 0===t?void 0:t.name)||"Event"}),(0,u.jsxs)("div",{className:"event-meta",children:["draft"===(null===t||void 0===t?void 0:t.status)&&(0,u.jsx)("span",{className:"event-status-bubble draft",children:"Draft"}),j&&"draft"!==(null===t||void 0===t?void 0:t.status)&&(0,u.jsx)("span",{className:`event-status-bubble ${j}`,children:"upcoming"===j?"Upcoming":"Passed"})]})]}),(0,u.jsxs)("div",{className:"quick-stats",children:[(0,u.jsxs)("div",{className:"stat-item",children:[(0,u.jsx)(n.JO,{icon:"mingcute:user-group-fill",className:"stat-icon"}),(0,u.jsxs)("div",{className:"stat-content",children:[(0,u.jsx)("span",{className:"stat-value",children:null!==(s=null===a||void 0===a?void 0:a.registrationCount)&&void 0!==s?s:0}),(0,u.jsx)("span",{className:"stat-label",children:"Registrations"})]})]}),(0,u.jsxs)("div",{className:"stat-item",children:[(0,u.jsx)(n.JO,{icon:"mdi:calendar-clock",className:"stat-icon"}),(0,u.jsxs)("div",{className:"stat-content",children:[(0,u.jsx)("span",{className:"stat-value",children:(()=>{if(null===t||void 0===t||!t.start_time)return"";const e=new Date,s=new Date(t.start_time)-e;if(s<0)return"Event has started";const i=Math.floor(s/864e5),n=Math.floor(s%864e5/36e5),a=Math.floor(s%36e5/6e4);return i>0?`${i} day${1!==i?"s":""} until event`:n>0?`${n} hour${1!==n?"s":""} until event`:`${a} minute${1!==a?"s":""} until event`})()||"N/A"}),(0,u.jsx)("span",{className:"stat-label",children:"Time Until"})]})]})]})]}),(0,u.jsxs)("div",{className:"header-details",children:[(0,u.jsxs)("div",{className:"detail-item",children:[(0,u.jsx)(n.JO,{icon:"mdi:calendar"}),(0,u.jsx)("span",{children:(e=>{if(!e)return"";return new Date(e).toLocaleDateString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"})})(null===t||void 0===t?void 0:t.start_time)})]}),(0,u.jsxs)("div",{className:"detail-item",children:[(0,u.jsx)(n.JO,{icon:"mdi:clock-outline"}),(0,u.jsxs)("span",{children:[x(null===t||void 0===t?void 0:t.start_time)," - ",x(null===t||void 0===t?void 0:t.end_time)]})]}),(0,u.jsxs)("div",{className:"detail-item",children:[(0,u.jsx)(n.JO,{icon:"fluent:location-28-filled"}),(0,u.jsx)("span",{children:(null===t||void 0===t?void 0:t.location)||"TBD"})]})]})]})]})};const v=function(e){let{item:s,onEdit:t,onDelete:i}=e;const a=e=>{if(!e)return"TBD";return(e instanceof Date?e:new Date(e)).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"})},l=s.startTime?"string"===typeof s.startTime?new Date(s.startTime):s.startTime:null,r=s.endTime?"string"===typeof s.endTime?new Date(s.endTime):s.endTime:null,o=(()=>{if(!s.startTime||!s.endTime)return null;const e=s.startTime instanceof Date?s.startTime:new Date(s.startTime),t=s.endTime instanceof Date?s.endTime:new Date(s.endTime);return Math.round((t-e)/6e4)})();return(0,u.jsxs)("div",{className:"agenda-item",children:[(0,u.jsxs)("div",{className:"item-content",children:[(0,u.jsxs)("div",{className:"item-header",children:[(0,u.jsxs)("div",{className:"item-type-badge",style:{backgroundColor:(c=s.type,{Activity:"#4DAA57",Break:"#ffc107",Setup:"#6c757d",Breakdown:"#6c757d",Transition:"#17a2b8",Speaker:"#dc3545",Custom:"#6D8EFA"}[c]||"#6c757d")},children:[(0,u.jsx)(n.JO,{icon:(e=>({Activity:"mdi:run",Break:"mdi:coffee",Setup:"mdi:wrench",Breakdown:"mdi:package-down",Transition:"mdi:arrow-right",Speaker:"mdi:microphone",Custom:"mdi:star"}[e]||"mdi:circle"))(s.type)}),(0,u.jsx)("span",{children:s.type})]}),!s.isPublic&&(0,u.jsxs)("span",{className:"item-visibility",children:[(0,u.jsx)(n.JO,{icon:"mdi:lock"}),(0,u.jsx)("span",{children:"Internal"})]})]}),(0,u.jsx)("h4",{className:"item-title",children:s.title}),s.description&&(0,u.jsx)("p",{className:"item-description",children:s.description}),(0,u.jsxs)("div",{className:"item-meta",children:[l&&r&&(0,u.jsxs)("span",{className:"meta-item",children:[(0,u.jsx)(n.JO,{icon:"mdi:clock-outline"}),a(l)," - ",a(r)]}),null!=o&&(0,u.jsxs)("span",{className:"meta-item",children:[(0,u.jsx)(n.JO,{icon:"mdi:timer-outline"}),o," min"]}),s.location&&(0,u.jsxs)("span",{className:"meta-item",children:[(0,u.jsx)(n.JO,{icon:"fluent:location-28-filled"}),s.location]})]})]}),(0,u.jsxs)("div",{className:"item-actions",children:[(0,u.jsx)("button",{className:"action-btn edit",onClick:t,title:"Edit",children:(0,u.jsx)(n.JO,{icon:"mdi:pencil"})}),(0,u.jsx)("button",{className:"action-btn delete",onClick:i,title:"Delete",children:(0,u.jsx)(n.JO,{icon:"mdi:delete"})})]})]});var c};var g=t(96127),p=t(86769),x=t(76620),j=t(76507),b=t(3409),f=t(87700);const N=e=>e.index,y=e=>Math.max(e.value,.25);function w(e){return e.map(((s,t)=>function(e,s){if(!s)return e;const t=.25,i=.03*Math.abs(y(s)-y(e)),n=Math.abs(y(e)-i),a=Math.abs(y(s)+i),l=Math.abs(N(e)+t),r=Math.abs(N(s)-t);return[e,{index:l,value:n},{index:r,value:a}]}(s,e[t+1]))).flat()}const k=e=>(new Intl.NumberFormat).format(e);function C(e){var s,t;let{width:n,height:a,data:l}=e;const r=(0,i.useId)().replace(/:/g,"");if(!l||0===l.length)return null;const o=l.map(((e,s)=>({index:s,value:e.value,label:e.label})));o.push({index:l.length,value:0});const c=w(o),d=Math.max(...o.map(N)),m=Math.max(null!==(s=null===(t=o[0])||void 0===t?void 0:t.value)&&void 0!==s?s:1,.25),h=m+Math.min(50,Math.max(3,2*m)),v=(0,x.Z)({range:[0,n],domain:[0,d]}),g=(0,x.Z)({range:[a,0],domain:[-h,h]}),p=Array.from({length:d-1},((e,s)=>s+1));return(0,u.jsxs)("svg",{width:n,height:a,className:"funnel-chart-svg funnel-chart-horizontal",children:[(0,u.jsx)("defs",{children:(0,u.jsxs)("linearGradient",{id:r,x1:"0%",y1:"0%",x2:"100%",y2:"0%",children:[(0,u.jsx)("stop",{offset:"0%",stopColor:"#4DAA57"}),(0,u.jsx)("stop",{offset:"100%",stopColor:"#CAF080"})]})}),(0,u.jsx)("rect",{width:n,height:a,fill:"var(--background)",rx:22}),[{padPx:0,opacity:1},{padPx:15,opacity:.2},{padPx:30,opacity:.1}].map(((e,s)=>(0,u.jsx)(j.Z,{data:c,curve:b.ZP,x:e=>v(N(e)),y0:s=>g(y(s))-e.padPx,y1:s=>g(-y(s))+e.padPx,fill:`url(#${r})`,fillOpacity:e.opacity,stroke:"transparent"},`area-${s}`))),p.map((e=>{const s=v(e);return(0,u.jsx)("line",{className:"funnel-checkpoint-line",x1:s,y1:0,x2:s,y2:a,stroke:"rgba(0, 0, 0, 0.01)",strokeWidth:2},`checkpoint-${e}`)})),o.slice(0,-1).map(((e,s)=>{const t=v(s+.5)-42,i=a/2-20;return(0,u.jsx)("g",{className:"funnel-segment-label",children:(0,u.jsx)("foreignObject",{x:t,y:i,width:84,height:40,className:"funnel-segment-label-foreign",children:(0,u.jsxs)("div",{xmlns:"http://www.w3.org/1999/xhtml",className:"funnel-segment-label-bg",children:[(0,u.jsx)("span",{className:"funnel-segment-value-text",children:k(e.value)}),(0,u.jsx)("span",{className:"funnel-segment-label-text",children:e.label})]})})},`label-${s}`)}))]})}const S=function(e){return(0,u.jsx)(f.Z,{children:s=>{var t,i;return(0,u.jsx)(C,{...e,width:null!==(t=null===s||void 0===s?void 0:s.width)&&void 0!==t?t:400,height:null!==(i=null===s||void 0===s?void 0:s.height)&&void 0!==i?i:160})}})},_=[{_id:"1",title:"Welcome & Check-In",type:"Activity",startTime:new Date("2025-03-15T09:00:00"),endTime:new Date("2025-03-15T09:30:00"),isPublic:!0},{_id:"2",title:"Keynote Speaker",type:"Speaker",startTime:new Date("2025-03-15T10:00:00"),endTime:new Date("2025-03-15T11:00:00"),isPublic:!0},{_id:"3",title:"Workshop Sessions",type:"Activity",startTime:new Date("2025-03-15T11:30:00"),endTime:new Date("2025-03-15T12:30:00"),isPublic:!0}],D=[{id:"overview",label:"Overview",icon:"mingcute:chart-bar-fill",description:"View event statistics, readiness checks, and quick actions at a glance.",snippet:(0,u.jsx)("div",{className:"event-dashboard",children:(0,u.jsx)("div",{className:"event-overview",children:(0,u.jsx)("div",{className:"overview-layout",children:(0,u.jsx)("div",{className:"overview-left-column",children:(0,u.jsxs)("div",{className:"overview-card readiness-card",children:[(0,u.jsxs)("h3",{className:"event-dashboard-card-header",children:[(0,u.jsx)(n.JO,{icon:"mdi:clipboard-check-outline"}),"Event Readiness",(0,u.jsx)("span",{className:"readiness-count",children:"2/3"})]}),(0,u.jsxs)("div",{className:"readiness-list",children:[(0,u.jsxs)("div",{className:"readiness-item ready",children:[(0,u.jsx)(n.JO,{icon:"mdi:check-circle"}),(0,u.jsxs)("div",{className:"readiness-content",children:[(0,u.jsx)("div",{className:"readiness-header",children:(0,u.jsx)("span",{className:"readiness-label",children:"Agenda Published"})}),(0,u.jsx)("span",{className:"readiness-description",children:"Agenda is published and ready"})]})]}),(0,u.jsxs)("div",{className:"readiness-item pending",children:[(0,u.jsx)(n.JO,{icon:"mdi:alert-circle-outline"}),(0,u.jsxs)("div",{className:"readiness-content",children:[(0,u.jsxs)("div",{className:"readiness-header",children:[(0,u.jsx)("span",{className:"readiness-label",children:"Jobs Filled"}),(0,u.jsx)("span",{className:"readiness-stats",children:"5 / 8 (63%)"})]}),(0,u.jsx)("span",{className:"readiness-description",children:"5 of 8 positions filled"}),(0,u.jsx)("div",{className:"readiness-progress",children:(0,u.jsx)("div",{className:"readiness-progress-bar",children:(0,u.jsx)("div",{className:"readiness-progress-fill",style:{width:"63%"}})})})]})]})]})]})})})})})},{id:"agenda",label:"Agenda",icon:"mdi:calendar-clock",description:"Build and manage your event schedule with a visual timeline or list view.",snippet:(0,u.jsx)("div",{className:"agenda-builder",children:(0,u.jsx)("div",{className:"agenda-items-container",children:_.map((e=>(0,u.jsx)(v,{item:e,onEdit:()=>{},onDelete:()=>{}},e._id)))})})},{id:"jobs",label:"Jobs",icon:"mdi:briefcase",description:"Define volunteer roles and assign members to shifts.",snippet:(0,u.jsx)("div",{className:"roles-manager",children:(0,u.jsxs)("div",{className:"roles-list",children:[(0,u.jsxs)("div",{className:"role-card fully-staffed",children:[(0,u.jsx)("div",{className:"role-header",children:(0,u.jsx)("div",{className:"role-info",children:(0,u.jsx)("h4",{children:"Registration Desk"})})}),(0,u.jsx)("div",{className:"role-assignments",children:(0,u.jsxs)("div",{className:"assignments-header",children:[(0,u.jsx)("h5",{children:"Assignments (2 / 2)"}),(0,u.jsxs)("span",{className:"fully-staffed-badge",children:[(0,u.jsx)(n.JO,{icon:"mdi:check-circle"}),"Fully Staffed"]})]})})]}),(0,u.jsxs)("div",{className:"role-card",children:[(0,u.jsx)("div",{className:"role-header",children:(0,u.jsx)("div",{className:"role-info",children:(0,u.jsx)("h4",{children:"Setup Crew"})})}),(0,u.jsx)("div",{className:"role-assignments",children:(0,u.jsx)("div",{className:"assignments-header",children:(0,u.jsx)("h5",{children:"Assignments (1 / 3)"})})})]}),(0,u.jsxs)("div",{className:"role-card",children:[(0,u.jsx)("div",{className:"role-header",children:(0,u.jsx)("div",{className:"role-info",children:(0,u.jsx)("h4",{children:"Photographer"})})}),(0,u.jsx)("div",{className:"role-assignments",children:(0,u.jsx)("div",{className:"assignments-header",children:(0,u.jsx)("h5",{children:"Assignments (0 / 1)"})})})]})]})})},{id:"analytics",label:"Analytics",icon:"mingcute:chart-line-fill",description:"Track views, RSVPs, and engagement with detailed charts and metrics.",snippet:(0,u.jsxs)("div",{className:"event-analytics-detail",children:[(0,u.jsx)(p.Z,{icon:"mingcute:chart-bar-fill",header:"Engagement Funnel",classN:"analytics-card funnel-section",size:"1rem",children:(0,u.jsx)("div",{className:"card-content funnel-chart-container",children:(0,u.jsx)("div",{className:"funnel-chart-wrapper",children:(0,u.jsx)(S,{data:[{label:"Views",value:1250},{label:"Form Opens",value:680},{label:"Registrations",value:312},{label:"Check-ins",value:189}]})})})}),(0,u.jsxs)("div",{className:"analytics-grid",children:[(0,u.jsx)(p.Z,{icon:"mdi:eye",header:"Views",classN:"analytics-card",size:"1rem",children:(0,u.jsx)("div",{className:"card-content",children:(0,u.jsxs)("div",{className:"views-grid",children:[(0,u.jsxs)("div",{className:"views-squares-wrapper",children:[(0,u.jsx)("div",{className:"view-square-wrapper",children:(0,u.jsx)("div",{className:"view-square",children:(0,u.jsxs)("div",{className:"view-square-content",children:[(0,u.jsx)("span",{className:"view-value",children:"98"}),(0,u.jsx)("span",{className:"view-label",children:"Logged-in"}),(0,u.jsx)("span",{className:"view-subtitle",children:"45 unique"})]})})}),(0,u.jsx)("div",{className:"view-square-wrapper",children:(0,u.jsx)("div",{className:"view-square",children:(0,u.jsxs)("div",{className:"view-square-content",children:[(0,u.jsx)("span",{className:"view-value",children:"58"}),(0,u.jsx)("span",{className:"view-label",children:"Anonymous"}),(0,u.jsx)("span",{className:"view-subtitle",children:"32 unique"})]})})})]}),(0,u.jsx)("div",{className:"view-total-wrapper",children:(0,u.jsx)("div",{className:"view-total",children:(0,u.jsxs)("div",{className:"view-total-content",children:[(0,u.jsx)("span",{className:"view-value",children:"156"}),(0,u.jsx)("span",{className:"view-label",children:"Total Views"})]})})})]})})}),(0,u.jsx)(p.Z,{icon:"mingcute:trending-up-fill",header:"Engagement",classN:"analytics-card",size:"1rem",children:(0,u.jsxs)("div",{className:"card-content",children:[(0,u.jsxs)("div",{className:"stat-large",children:[(0,u.jsx)("span",{className:"stat-value",children:"15.4%"}),(0,u.jsx)("span",{className:"stat-label",children:"Engagement Rate"})]}),(0,u.jsx)("div",{className:"rsvp-segments-display",children:(0,u.jsxs)("div",{className:"rsvp-segment-item going",children:[(0,u.jsx)("span",{className:"segment-number",children:"24"}),(0,u.jsx)("span",{className:"segment-label",children:"Registrations"})]})})]})})]})]})},{id:"details",label:"Details",icon:"mdi:pencil",description:"Edit event name, date, location, and other basic information.",snippet:(0,u.jsx)("div",{className:"event-editor-tab",children:(0,u.jsxs)("div",{className:"editor-content create-event-v3-form",children:[(0,u.jsxs)("div",{className:"form-section",children:[(0,u.jsx)("label",{className:"section-label",children:"Event Name"}),(0,u.jsx)("div",{className:"onboarding-field-preview",children:"Annual Spring Gala"})]}),(0,u.jsxs)("div",{className:"form-section",children:[(0,u.jsx)("label",{className:"section-label",children:"Date & Time"}),(0,u.jsx)("div",{className:"onboarding-field-preview",children:"Saturday, March 15, 2025 at 6:00 PM \u2013 9:00 PM"})]}),(0,u.jsxs)("div",{className:"form-section",children:[(0,u.jsx)("label",{className:"section-label",children:"Location"}),(0,u.jsx)("div",{className:"onboarding-field-preview",children:"Main Hall, Building A"})]})]})})},{id:"registrations",label:"Registrations",icon:"mdi:clipboard-list-outline",description:"View registration responses, export to CSV, and manage form settings.",snippet:(0,u.jsx)("div",{className:"registrations-tab",children:(0,u.jsx)("div",{className:"registrations-table-wrapper",children:(0,u.jsxs)("table",{className:"registrations-table",children:[(0,u.jsx)("thead",{children:(0,u.jsxs)("tr",{children:[(0,u.jsx)("th",{children:"Name"}),(0,u.jsx)("th",{children:"Email"}),(0,u.jsx)("th",{children:"Submitted"}),(0,u.jsx)("th",{className:"th-actions",children:"Actions"})]})}),(0,u.jsxs)("tbody",{children:[(0,u.jsxs)("tr",{children:[(0,u.jsx)("td",{children:"Jane Doe"}),(0,u.jsx)("td",{children:"jane@example.com"}),(0,u.jsx)("td",{children:"3/13/2025, 2:30:00 PM"}),(0,u.jsx)("td",{className:"td-actions"})]}),(0,u.jsxs)("tr",{children:[(0,u.jsx)("td",{children:"John Smith"}),(0,u.jsx)("td",{children:"john@example.com"}),(0,u.jsx)("td",{children:"3/14/2025, 10:15:00 AM"}),(0,u.jsx)("td",{className:"td-actions"})]}),(0,u.jsxs)("tr",{children:[(0,u.jsx)("td",{children:"Alex Chen"}),(0,u.jsx)("td",{children:"alex@example.com"}),(0,u.jsx)("td",{children:"3/15/2025, 8:00:00 AM"}),(0,u.jsx)("td",{className:"td-actions"})]})]})]})})})},{id:"checkin",label:"Check-In",icon:"uil:qrcode-scan",description:"Enable QR or link check-in and track attendance in real time.",snippet:(0,u.jsxs)("div",{className:"event-checkin-tab",children:[(0,u.jsxs)("div",{className:"checkin-stats",children:[(0,u.jsx)(g.Z,{title:"Checked In",value:12,icon:"mdi:account-check",iconVariant:"approved"}),(0,u.jsx)(g.Z,{title:"Total Registrations",value:24,icon:"mdi:account-group"}),(0,u.jsx)(g.Z,{title:"Check-In Rate",value:"50%",icon:"mdi:chart-line"})]}),(0,u.jsx)("div",{className:"checkin-methods",children:(0,u.jsx)(p.Z,{icon:"fa7-solid:qrcode",header:"QR Code",classN:"checkin-section checkin-section-qr",right:(0,u.jsxs)("button",{type:"button",className:"copy-checkin-link-btn",disabled:!0,children:[(0,u.jsx)(n.JO,{icon:"mdi:link-variant"}),"Copy link"]}),children:(0,u.jsx)("div",{className:"checkin-section-content",children:(0,u.jsx)("div",{className:"qr-code-display",children:(0,u.jsxs)("div",{className:"qr-code-image-container onboarding-qr-placeholder",children:[(0,u.jsx)(n.JO,{icon:"fa7-solid:qrcode"}),(0,u.jsx)("span",{children:"QR Code"})]})})})})})]})}];const T=function(e){let{onClose:s,handleClose:t}=e;const a=t||s,{AtlasMain:l}=(0,o.Q)(),[r,c]=(0,i.useState)(0),d=D[r],m=0===r,h=r===D.length-1;return(0,u.jsxs)("div",{className:"event-dashboard-onboarding",children:[(0,u.jsxs)("div",{className:"event-dashboard-onboarding__header",children:[(0,u.jsx)("h2",{className:"event-dashboard-onboarding__title",children:"Welcome to the Event Dashboard"}),(0,u.jsx)("p",{className:"event-dashboard-onboarding__subtitle",children:"Here's a quick tour of what you can do"})]}),(0,u.jsxs)("div",{className:"event-dashboard-onboarding__slide",children:[(0,u.jsxs)("div",{className:"event-dashboard-onboarding__slide-header",children:[(0,u.jsx)(n.JO,{icon:d.icon,className:"slide-icon"}),(0,u.jsx)("h3",{className:"slide-title",children:d.label})]}),(0,u.jsxs)("div",{className:"event-dashboard-onboarding__snippet-area",children:[(0,u.jsx)("div",{className:"event-dashboard-onboarding__gradient-bg",children:(0,u.jsx)("img",{src:l,alt:""})}),(0,u.jsx)("span",{className:"event-dashboard-onboarding__preview-badge",children:"Preview"}),(0,u.jsx)("div",{className:"event-dashboard-onboarding__snippet-inner",children:d.snippet})]}),(0,u.jsx)("p",{className:"event-dashboard-onboarding__description",children:d.description})]}),(0,u.jsxs)("div",{className:"event-dashboard-onboarding__footer",children:[(0,u.jsx)("div",{className:"event-dashboard-onboarding__dots",children:D.map(((e,s)=>(0,u.jsx)("button",{type:"button",className:"onboarding-dot "+(s===r?"active":""),onClick:()=>c(s),"aria-label":`Go to slide ${s+1}`},e.id)))}),(0,u.jsxs)("div",{className:"event-dashboard-onboarding__actions",children:[(0,u.jsx)("button",{type:"button",className:"onboarding-btn onboarding-btn--skip",onClick:()=>{null===a||void 0===a||a()},children:"Skip"}),(0,u.jsxs)("div",{className:"onboarding-nav-buttons",children:[(0,u.jsxs)("button",{type:"button",className:"onboarding-btn onboarding-btn--prev",onClick:()=>{c((e=>Math.max(0,e-1)))},disabled:m,children:[(0,u.jsx)(n.JO,{icon:"mdi:chevron-left"}),"Prev"]}),(0,u.jsxs)("button",{type:"button",className:"onboarding-btn onboarding-btn--next",onClick:()=>{h?null===a||void 0===a||a():c((e=>Math.min(D.length-1,e+1)))},children:[h?"Get Started":"Next",!h&&(0,u.jsx)(n.JO,{icon:"mdi:chevron-right"})]})]})]})]})]})};var O=t(4506),I=t(41757),E=t(81079),R=t(69957),A=t(2921),J=t(57321),F=t(10044),q=t(54597),$=t(58377);const M={xAccessor:e=>e.x,yAccessor:e=>e.y};function P(e){const s=new Date(e);return`${s.getFullYear()}-${String(s.getMonth()+1).padStart(2,"0")}-${String(s.getDate()).padStart(2,"0")}`}function Z(e){const s=new Date(e+"T12:00:00"),t=new Date;t.setHours(0,0,0,0);const i=new Date(s);i.setHours(0,0,0,0);const n=Math.round((t-i)/864e5);return 0===n?"Today":1===n?"Yesterday":n>1&&n<7?s.toLocaleDateString("en-US",{weekday:"short"}):s.toLocaleDateString("en-US",{month:"short",day:"numeric"})}const L=(0,O.Z)({colors:["#22c55e","#94a3b8"],backgroundColor:"transparent",gridColor:"rgba(0, 0, 0, 0.14)",gridColorDark:"rgba(0, 0, 0, 0.2)",tickLength:0});const U=function(e){var s,t,l,r,o,c,d,m,h;let{eventId:v,orgId:g,expectedAttendance:p,registrationCount:x}=e;const[j,b]=(0,i.useState)(!0),[f,N]=(0,i.useState)(!1),y="undefined"!==typeof Intl?Intl.DateTimeFormat().resolvedOptions().timeZone:void 0,w=v&&g?`/org-event-management/${g}/events/${v}/rsvp-growth${y?`?timezone=${encodeURIComponent(y)}`:""}`:null,{data:k,loading:C,error:S}=(0,a.i)(w),{dailyData:_,requiredGrowth:D,targetAttendance:T,isFrozen:O,requiredPerDay:U}=(0,i.useMemo)((()=>{if(null===k||void 0===k||!k.success||null===k||void 0===k||!k.data)return console.log("[RSVPGrowthChart] no growthData",{success:null===k||void 0===k?void 0:k.success,hasData:!(null===k||void 0===k||!k.data)}),{dailyData:[],requiredGrowth:[],targetAttendance:0,isFrozen:!1,requiredPerDay:0};const{registrations:e={},eventCreated:s,eventStart:t,expectedAttendance:i}=k.data;console.log("[RSVPGrowthChart] raw API data",{rawRegistrations:e,eventCreated:s,eventStart:t,expectedAttendance:i});const n=new Date(t);n.setDate(n.getDate()-1),n.setHours(0,0,0,0);const a=f?function(e,s,t){const i={},n=new Date(e);n.setHours(0,0,0,0);const a=new Date(s);a.setHours(0,0,0,0);const l=new Date;l.setHours(23,59,59,999);const r=[];for(let v=new Date(n);v<=a;v.setDate(v.getDate()+1)){const e=new Date(v);e.setHours(0,0,0,0),e<=l&&r.push(e.toISOString().split("T")[0])}if(0===r.length)return i;const o=new Set;for(;o.size<Math.min(3,Math.floor(.15*r.length));)o.add(Math.floor(Math.random()*r.length));const c=new Set;for(;c.size<Math.min(5,Math.floor(.25*r.length));)c.add(Math.floor(Math.random()*r.length));const d=r.map(((e,s)=>{const t=s/Math.max(1,r.length-1);let i=.25*(1.5-t)+.35*(.5+t)+.4*(.8+.4*Math.sin(t*Math.PI));return o.has(s)&&(i*=2.5+Math.random()),c.has(s)&&(i*=.1+.2*Math.random()),Math.max(.01,i+(Math.random()-.3))})),m=d.reduce(((e,s)=>e+s),0),u=d.map((e=>Math.round(e/m*500))),h=500-u.reduce(((e,s)=>e+s),0);return u[u.length-1]+=h,r.forEach(((e,s)=>{const t=Math.max(0,u[s]||0);t>0&&(i[e]=t)})),i}(s,n):e,l=new Date,r=new Date(s),o=new Date(t),c=new Date(o<l?o:l);c.setHours(23,59,59,999);const d=new Date(r);d.setHours(0,0,0,0);const m=new Date(o);m.setHours(0,0,0,0);const u=[];let h=0;for(let j=new Date(d);j<=m;j.setDate(j.getDate()+1)){const e=new Date(j);e.setHours(0,0,0,0);const s=P(e),t=e<=c&&a[s]||0;h+=t,u.push({date:s,dailyRSVPs:t,cumulativeRSVPs:h})}const v=f?500:i||0,g=u.length,p=g>0?v/g:0,x=u.map(((e,s)=>({date:e.date,required:s===u.length-1?v:(s+1)*p})));return console.log("[RSVPGrowthChart] dailyData computed",{dailyDataLength:u.length,sampleDays:u.slice(0,3).map((e=>({date:e.date,dailyRSVPs:e.dailyRSVPs,cumulativeRSVPs:e.cumulativeRSVPs}))),lastDay:u[u.length-1],daysWithRegistrations:u.filter((e=>e.dailyRSVPs>0))}),{dailyData:u,requiredGrowth:x,targetAttendance:v,isFrozen:o<l,requiredPerDay:p}}),[k,f]),V=void 0!==x||(null!==p&&void 0!==p?p:0)>0,B=()=>(0,u.jsxs)("div",{className:"chart-stats-inline",children:[(0,u.jsxs)("div",{className:"chart-stat-item",children:[(0,u.jsx)("span",{className:"chart-stat-value",children:null!==x&&void 0!==x?x:0}),(0,u.jsx)("span",{className:"chart-stat-label",children:"Registered"})]}),(null!==p&&void 0!==p?p:0)>0&&(0,u.jsxs)("div",{className:"chart-stat-item",children:[(0,u.jsx)("span",{className:"chart-stat-value",children:p}),(0,u.jsx)("span",{className:"chart-stat-label",children:"Expected"})]})]});if(C)return(0,u.jsxs)("div",{className:"rsvp-growth-chart rsvp-growth-chart-visx",children:[V&&(0,u.jsx)("div",{className:"chart-header",children:(0,u.jsx)(B,{})}),(0,u.jsx)("div",{className:"chart-loading",children:"Loading growth data..."})]});if(S||null===k||void 0===k||!k.success)return(0,u.jsxs)("div",{className:"rsvp-growth-chart rsvp-growth-chart-visx",children:[V&&(0,u.jsx)("div",{className:"chart-header",children:(0,u.jsx)(B,{})}),(0,u.jsx)("div",{className:"chart-error",children:"Error loading growth data"})]});const z=f?null!==(s=null===_||void 0===_||null===(t=_[_.length-1])||void 0===t?void 0:t.cumulativeRSVPs)&&void 0!==s?s:0:null!==(l=null!==x&&void 0!==x?x:null===_||void 0===_||null===(r=_[_.length-1])||void 0===r?void 0:r.cumulativeRSVPs)&&void 0!==l?l:0,H=f?T:null!==(o=null!==p&&void 0!==p?p:T)&&void 0!==o?o:0,W=P(new Date),G=new Date;G.setDate(G.getDate()-1);const Q=P(G),Y=null!==(c=null===_||void 0===_||null===(d=_.find((e=>e.date===W)))||void 0===d?void 0:d.dailyRSVPs)&&void 0!==c?c:0,K=null!==(m=null===_||void 0===_||null===(h=_.find((e=>e.date===Q)))||void 0===h?void 0:h.dailyRSVPs)&&void 0!==m?m:0,X=K>0?Math.round((Y-K)/K*100):Y>0?100:0;if(!(_&&_.length>0))return(0,u.jsxs)("div",{className:"rsvp-growth-chart rsvp-growth-chart-visx rsvp-growth-chart-minimal",children:[(0,u.jsx)("div",{className:"chart-header",children:(0,u.jsxs)("div",{className:"chart-stats-inline",children:[(0,u.jsxs)("div",{className:"chart-stat-item",children:[(0,u.jsx)("span",{className:"chart-stat-value",children:z}),(0,u.jsx)("span",{className:"chart-stat-label",children:"Registered"})]}),H>0&&(0,u.jsxs)("div",{className:"chart-stat-item",children:[(0,u.jsx)("span",{className:"chart-stat-value",children:H}),(0,u.jsx)("span",{className:"chart-stat-label",children:"Expected"})]})]})}),(0,u.jsx)("div",{className:"chart-empty",children:"No registration data available"})]});const ee=j?_.map((e=>({x:e.date,y:e.cumulativeRSVPs}))):_.map((e=>({x:e.date,y:e.dailyRSVPs}))),se=ee.filter((e=>e.x<=W));console.log("[RSVPGrowthChart] chart data",{todayStr:W,isCumulative:j,beforeFilterLength:ee.length,beforeFilterWithY:ee.filter((e=>e.y>0)),actualDataLength:se.length,actualDataWithY:se.filter((e=>e.y>0)),filterRemoved:ee.filter((e=>e.x>W))});const te=j?D.map((e=>({x:e.date,y:e.required}))):_.map((e=>({x:e.date,y:Math.round(10*U)/10}))),ie=(()=>{const e=Math.max(...se.map((e=>e.y)),0),s=Math.max(...te.map((e=>e.y)),0),t=H>0?H:Math.max(e,s);return Math.ceil(1.1*Math.max(e,s,t))||10})();return(0,u.jsxs)("div",{className:"rsvp-growth-chart rsvp-growth-chart-visx",children:[(0,u.jsxs)("div",{className:"chart-header",children:[(0,u.jsxs)("div",{className:"chart-stats-inline",children:[(0,u.jsxs)("div",{className:"chart-stat-item",children:[(0,u.jsx)("span",{className:"chart-stat-value",children:z}),(0,u.jsx)("span",{className:"chart-stat-label",children:"Registered"})]}),H>0&&(0,u.jsxs)("div",{className:"chart-stat-item",children:[(0,u.jsx)("span",{className:"chart-stat-value",children:H}),(0,u.jsx)("span",{className:"chart-stat-label",children:"Expected"})]}),(0,u.jsxs)("div",{className:"chart-stat-item",children:[(0,u.jsx)("span",{className:"chart-stat-value",children:Y}),(0,u.jsxs)("span",{className:"chart-stat-label",children:["Daily",0!==X&&(0,u.jsxs)("span",{className:"chart-stat-change "+(X>0?"up":"down"),title:X>0?`Up ${X}% from yesterday`:`Down ${Math.abs(X)}% from yesterday`,children:[X>0?(0,u.jsx)(n.JO,{icon:"mdi:trending-up"}):(0,u.jsx)(n.JO,{icon:"mdi:trending-down"}),Math.abs(X),"%"]})]})]})]}),(0,u.jsxs)("div",{className:"chart-header-right",children:[f&&(0,u.jsx)("span",{className:"frozen-badge",style:{background:"var(--beacon-accent, #998df2)"},children:"Fake data"}),O&&(0,u.jsxs)("span",{className:"frozen-badge",children:[(0,u.jsx)(n.JO,{icon:"mdi:lock"}),"Frozen"]}),(0,u.jsxs)("div",{className:"chart-controls",children:[(0,u.jsx)("button",{type:"button",className:"toggle-btn "+(j?"active":""),onClick:()=>b(!0),children:"Cumulative"}),(0,u.jsx)("button",{type:"button",className:"toggle-btn "+(j?"":"active"),onClick:()=>b(!1),children:"Daily"})]})]})]}),(0,u.jsx)("div",{className:"chart-container chart-container-visx",children:(0,u.jsxs)(I.Z,{theme:L,xScale:{type:"band",paddingInner:.3,paddingOuter:.2},yScale:{type:"linear",domain:[0,ie]},height:280,margin:{top:12,right:12,bottom:28,left:36},children:[(0,u.jsx)(E.Z,{columns:!1,numTicks:4,strokeDasharray:"2 4",className:"chart-grid"}),(0,u.jsx)(R.Z,{orientation:"bottom",tickFormat:Z,tickLabelProps:()=>({fill:"var(--light-text)",fontSize:10,textAnchor:"middle"}),numTicks:Math.min(_.length,12)}),(0,u.jsx)(R.Z,{orientation:"left",tickLabelProps:()=>({fill:"var(--light-text)",fontSize:10,textAnchor:"end",dx:-4}),numTicks:4}),se.length>0&&(0,u.jsx)(A.Z,{dataKey:"actual",data:se,xAccessor:M.xAccessor,yAccessor:M.yAccessor,curve:$.Z,fillOpacity:.2,fill:"url(#actual-gradient)"}),(0,u.jsxs)("defs",{children:[(0,u.jsxs)("linearGradient",{id:"actual-gradient",x1:"0",y1:"0",x2:"0",y2:"1",children:[(0,u.jsx)("stop",{offset:"0%",stopColor:"#22c55e",stopOpacity:.4}),(0,u.jsx)("stop",{offset:"100%",stopColor:"#22c55e",stopOpacity:0})]}),(0,u.jsxs)("linearGradient",{id:"required-gradient",x1:"0",y1:"0",x2:"0",y2:"1",children:[(0,u.jsx)("stop",{offset:"0%",stopColor:"#94a3b8",stopOpacity:.25}),(0,u.jsx)("stop",{offset:"100%",stopColor:"#94a3b8",stopOpacity:0})]})]}),(0,u.jsx)(A.Z,{dataKey:"required",data:te,xAccessor:M.xAccessor,yAccessor:M.yAccessor,curve:$.Z,fillOpacity:.2,fill:"url(#required-gradient)",renderLine:!1}),se.length>0&&(0,u.jsxs)(u.Fragment,{children:[(0,u.jsx)(J.Z,{dataKey:"actual",data:se,xAccessor:M.xAccessor,yAccessor:M.yAccessor,curve:$.Z,stroke:"#22c55e",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"}),(0,u.jsx)(F.Z,{dataKey:"actual-end",data:[se[se.length-1]],xAccessor:M.xAccessor,yAccessor:M.yAccessor,size:8,enableEvents:!1,renderGlyph:e=>{let{key:s,x:t,y:i}=e;return(0,u.jsx)("circle",{cx:t,cy:i,r:4,fill:"#22c55e",stroke:"#fff",strokeWidth:2},s)}})]}),(0,u.jsx)(J.Z,{dataKey:"required",data:te,xAccessor:M.xAccessor,yAccessor:M.yAccessor,curve:$.Z,stroke:"#94a3b8",strokeWidth:1.5,strokeDasharray:"5 5",strokeLinecap:"round",strokeLinejoin:"round"}),(0,u.jsx)(q.Z,{className:"rsvp-chart-tooltip-wrapper",snapTooltipToDatumX:!0,snapTooltipToDatumY:!0,showVerticalCrosshair:!0,showSeriesGlyphs:!1,renderTooltip:e=>{var s,t,i,n,a;let{tooltipData:l}=e;if(null===l||void 0===l||!l.datumByKey)return null;const r=null===(s=l.datumByKey)||void 0===s||null===(t=s.actual)||void 0===t?void 0:t.datum,o=null===(i=l.datumByKey)||void 0===i||null===(n=i.required)||void 0===n?void 0:n.datum,c=null===(a=r||o)||void 0===a?void 0:a.x;if(!c)return null;const d=Z(c);return(0,u.jsxs)("div",{className:"rsvp-chart-tooltip",children:[(0,u.jsx)("div",{className:"rsvp-chart-tooltip-date",children:d}),r&&(0,u.jsxs)("div",{className:"rsvp-chart-tooltip-row",children:[(0,u.jsx)("span",{className:"rsvp-chart-tooltip-dot rsvp-chart-tooltip-dot-actual"}),j?"Registrations":"Daily",":"," ",Math.round(r.y)]}),o&&(0,u.jsxs)("div",{className:"rsvp-chart-tooltip-row",children:[(0,u.jsx)("span",{className:"rsvp-chart-tooltip-dot rsvp-chart-tooltip-dot-required"}),j?"Required":"Required daily",":"," ",Math.round(10*o.y)/10]})]})}})]})}),(0,u.jsxs)("div",{className:"chart-legend",children:[(0,u.jsxs)("span",{className:"chart-legend-item",children:[(0,u.jsx)("span",{className:"chart-legend-dot chart-legend-dot-actual"}),j?"Registrations":"Daily"]}),(0,u.jsxs)("span",{className:"chart-legend-item",children:[(0,u.jsx)("span",{className:"chart-legend-dot chart-legend-dot-required"}),j?"Required":"Required daily"]})]})]})};var V=t(86775),B=t(73109);t(14860);const z=function(e){let{event:s,onRefetch:t}=e;return s?(0,u.jsx)("div",{className:"event-preview",children:(0,u.jsx)("div",{className:"event-preview-layout",children:(0,u.jsx)("div",{className:"event-preview-wrapper event-preview-desktop",children:(0,u.jsx)("div",{className:"event-preview-scaled",children:(0,u.jsx)("div",{className:"event-page event-preview-page",children:(0,u.jsx)(B.Z,{event:s,onRefetch:t,previewMode:!0,showAnalytics:!1})})})})})}):null};const H=function(e){var s,t,l;let{event:o,stats:c,agenda:d,roles:m,equipment:h,orgId:v,onRefresh:g,onTabChange:p}=e;const{addNotification:x}=(0,r.l)(),[j,b]=(0,i.useState)([]),{data:f}=(0,a.i)(null!==o&&void 0!==o&&o._id&&v?`/org-event-management/${v}/events/${o._id}/roles`:null);(0,i.useEffect)((()=>{null!==f&&void 0!==f&&f.success&&b(f.data.roles||[])}),[f]);const N=(()=>{if(0===j.length)return{ready:!1,filled:0,required:0};let e=0,s=0;return j.forEach((t=>{var i;const n=t.requiredCount||0,a=(null===(i=t.assignments)||void 0===i?void 0:i.filter((e=>"confirmed"===e.status)).length)||0;e+=n,s+=a})),{ready:e>0&&s>=e,filled:s,required:e}})(),y=N.required>0?Math.round(N.filled/N.required*100):0,w=y<50,k=[{id:"agenda",label:"Agenda Published",description:null!==d&&void 0!==d&&d.isPublished?"Agenda is published and ready":"Agenda has pending changes - click Publish to make them publicly available",ready:(null===d||void 0===d?void 0:d.isPublished)||!1},{id:"jobs",label:"Jobs Filled",description:N.required>0?`${N.filled} of ${N.required} positions filled`:"No jobs defined",ready:N.ready,showProgress:N.required>0,progressData:{filled:N.filled,required:N.required,percentage:y,lowCoverage:w}},{id:"published",label:"Event Published",description:"Event is publicly visible",ready:!0}],C=k.filter((e=>e.ready)).length,S=k.length,_=(0,i.useMemo)((()=>((null===d||void 0===d?void 0:d.items)||[]).filter((e=>e.startTime&&e.endTime)).map((e=>({...e,startTime:"string"===typeof e.startTime?new Date(e.startTime):e.startTime,endTime:"string"===typeof e.endTime?new Date(e.endTime):e.endTime})))),[null===d||void 0===d?void 0:d.items]),D=_.length>0&&o,T=o?{...o,eventAgenda:{items:(null===d||void 0===d?void 0:d.items)||[],isPublished:null===d||void 0===d?void 0:d.isPublished}}:null,O=async()=>{if(null===o||void 0===o||!o._id)return;const e=`${window.location.origin}/event/${o._id}`;try{await navigator.clipboard.writeText(e),x({title:"Copied",message:"Event link copied to clipboard",type:"success"})}catch{x({title:"Error",message:"Failed to copy link",type:"error"})}},I=null!==(s=null!==(t=null===c||void 0===c?void 0:c.registrationCount)&&void 0!==t?t:null===o||void 0===o?void 0:o.registrationCount)&&void 0!==s?s:0,E=null!==(l=null===o||void 0===o?void 0:o.expectedAttendance)&&void 0!==l?l:0;return n.JO,n.JO,p&&(u.Fragment,n.JO,n.JO,n.JO),(0,u.jsxs)("div",{className:"event-overview",children:[(T||o)&&(0,u.jsxs)("div",{className:"overview-preview-chart-row",children:[T&&(0,u.jsxs)("div",{className:"overview-preview-box",children:[(0,u.jsx)("div",{className:"overview-preview-box-header",children:(0,u.jsxs)("h3",{className:"event-dashboard-card-header",children:[(0,u.jsx)(n.JO,{icon:"iconoir:eye-solid"}),"Event Preview"]})}),(0,u.jsxs)("div",{className:"overview-preview-box-body",children:[(0,u.jsx)(z,{event:T,onRefetch:g}),(0,u.jsxs)("div",{className:"overview-preview-actions",children:[(0,u.jsxs)("button",{type:"button",className:"event-preview-action",onClick:O,title:"Copy event link",children:[(0,u.jsx)(n.JO,{icon:"mdi:link"}),(0,u.jsx)("span",{children:"Copy link"})]}),p&&(0,u.jsxs)(u.Fragment,{children:[(0,u.jsxs)("button",{type:"button",className:"event-preview-action",onClick:()=>p("registrations"),title:"View registrations",children:[(0,u.jsx)(n.JO,{icon:"mdi:clipboard-list-outline"}),(0,u.jsx)("span",{children:"Registrations"})]}),(0,u.jsxs)("button",{type:"button",className:"event-preview-action",onClick:()=>p("checkin"),title:"Check-in management",children:[(0,u.jsx)(n.JO,{icon:"uil:qrcode-scan"}),(0,u.jsx)("span",{children:"Check-in"})]})]})]})]})]}),o&&(0,u.jsxs)("div",{className:"overview-chart-box",children:[(0,u.jsx)("div",{className:"overview-chart-box-header",children:(0,u.jsxs)("h3",{className:"event-dashboard-card-header",children:[(0,u.jsx)(n.JO,{icon:"mdi:chart-line"}),"Registration Chart"]})}),(0,u.jsx)("div",{className:"overview-chart-box-body",children:(0,u.jsx)(U,{eventId:o._id,orgId:v,expectedAttendance:E,registrationCount:I})})]})]}),(0,u.jsx)("div",{className:"overview-layout",children:(0,u.jsx)("div",{className:"overview-left-column",children:(0,u.jsxs)("div",{className:"overview-card readiness-card",children:[(0,u.jsxs)("h3",{className:"event-dashboard-card-header",children:[(0,u.jsx)(n.JO,{icon:"mdi:clipboard-check-outline"}),"Event Readiness",(0,u.jsxs)("span",{className:"readiness-count",children:[C,"/",S]})]}),(0,u.jsx)("div",{className:"readiness-list",children:k.map((e=>{var s;return(0,u.jsxs)("div",{className:`readiness-item ${e.ready?"ready":"pending"} ${null!==(s=e.progressData)&&void 0!==s&&s.lowCoverage?"low-coverage":""}`,children:[(0,u.jsx)(n.JO,{icon:e.ready?"mdi:check-circle":"mdi:alert-circle-outline"}),(0,u.jsxs)("div",{className:"readiness-content",children:[(0,u.jsxs)("div",{className:"readiness-header",children:[(0,u.jsx)("span",{className:"readiness-label",children:e.label}),e.showProgress&&e.progressData&&(0,u.jsxs)("span",{className:"readiness-stats",children:[e.progressData.filled," / ",e.progressData.required," (",e.progressData.percentage,"%)"]})]}),(0,u.jsx)("span",{className:"readiness-description",children:e.description}),e.showProgress&&e.progressData&&(0,u.jsx)("div",{className:"readiness-progress",children:(0,u.jsx)("div",{className:"readiness-progress-bar",children:(0,u.jsx)("div",{className:"readiness-progress-fill "+(e.progressData.lowCoverage?"low":""),style:{width:`${Math.min(e.progressData.percentage,100)}%`}})})})]})]},e.id)}))})]})})}),D&&(0,u.jsxs)("div",{className:"overview-schedule-section",children:[(0,u.jsxs)("h3",{className:"event-dashboard-card-header",children:[(0,u.jsx)(n.JO,{icon:"mdi:calendar-clock"}),"Schedule"]}),(0,u.jsx)(V.Z,{agendaItems:_,event:o,minuteHeight:2})]})]})};var W=t(89056),G=t(41795),Q=t(18633),Y=t(84244),K=t(73516),X=t(89185);function ee(e){let{room:s,isSelected:t,onToggle:i}=e;return(0,u.jsxs)("div",{className:"room-card "+(t?"selected":""),onClick:i,children:[(0,u.jsxs)("div",{className:"room-image",children:[s.image?(0,u.jsx)("img",{src:s.image,alt:s.name}):(0,u.jsx)("div",{className:"no-image",children:(0,u.jsx)(n.JO,{icon:"mdi:office-building"})}),t&&(0,u.jsx)("div",{className:"selected-badge",children:(0,u.jsx)(n.JO,{icon:"mdi:check-circle"})})]}),(0,u.jsxs)("div",{className:"room-content",children:[(0,u.jsx)("h4",{className:"room-name",children:s.name}),(0,u.jsxs)("div",{className:"room-meta",children:[s.average_rating>0&&(0,u.jsxs)("div",{className:"rating",children:[(0,u.jsx)("img",{src:K.Z,alt:"star"}),(0,u.jsx)("span",{children:s.average_rating.toFixed(1)})]}),s.capacity>0&&(0,u.jsxs)("div",{className:"capacity",children:[(0,u.jsx)(n.JO,{icon:"mdi:account-group"}),(0,u.jsx)("span",{children:s.capacity})]})]}),s.attributes&&s.attributes.length>0&&(0,u.jsxs)("div",{className:"room-attributes",children:[s.attributes.slice(0,3).map(((e,s)=>{const t=(e=>{const s=e.toLowerCase().trim();return X.Md[s]||X.jx[s]||null})(e);return(0,u.jsxs)("div",{className:"attribute-item",children:[t&&(0,u.jsx)("img",{src:t,alt:e}),(0,u.jsx)("span",{children:e})]},s)})),s.attributes.length>3&&(0,u.jsxs)("span",{className:"more-attributes",children:["+",s.attributes.length-3]})]})]})]})}const se=function(e){let{formData:s,setFormData:t,onComplete:a}=e;const{addNotification:l}=(0,r.l)(),[o,c]=(0,i.useState)([]),[h,v]=(0,i.useState)(!0),[g,p]=(0,i.useState)(new Set),[x,j]=(0,i.useState)(""),[b,f]=(0,i.useState)(""),[N,y]=(0,i.useState)([]),[w,k]=(0,i.useState)("name"),[C,S]=(0,i.useState)(!1),[_,D]=(0,i.useState)(1),[T,O]=(0,i.useState)(!0),[I,E]=(0,i.useState)(0),R=((0,i.useRef)(new Map),(0,i.useRef)(t)),A=(0,i.useRef)(a);(0,i.useEffect)((()=>{R.current=t,A.current=a}),[t,a]),(0,i.useEffect)((()=>{s.selectedRoomIds&&Array.isArray(s.selectedRoomIds)&&p(new Set(s.selectedRoomIds))}),[]),(0,i.useEffect)((()=>{if(x===b)return;const e=setTimeout((()=>{const e=b.trim(),s=x.trim();f(x),e!==s?(D(1),s?c([]):J.current=!1):s&&x!==b&&(D(1),c([]))}),300);return()=>clearTimeout(e)}),[x]);const J=(0,i.useRef)(!1),F=(0,i.useRef)(!1);(0,i.useEffect)((()=>{if(F.current)return;(async()=>{if(!(!b.trim()&&J.current&&o.length>0)){!b.trim()&&J.current&&0===o.length&&1===_&&(J.current=!1),F.current=!0,v(!0);try{if(b.trim()){const t=await(0,m.Z)("/search-rooms",null,{method:"GET",params:{query:b.trim(),limit:20,page:_}});if(t.success&&t.rooms){var e,s;const i=t.rooms.map((e=>({id:e._id,name:e.name||"Unknown Room",image:e.image||null,building:e.building||"",floor:e.floor||"",capacity:e.capacity||0,attributes:e.attributes||[],average_rating:e.average_rating||0,number_of_ratings:e.number_of_ratings||0})));c(1===_?i:e=>[...e,...i]),E((null===(e=t.pagination)||void 0===e?void 0:e.total)||i.length),O(_<((null===(s=t.pagination)||void 0===s?void 0:s.totalPages)||1))}}else if(!J.current){J.current=!0;const e=await(0,m.Z)("/top-rated-rooms",null,{method:"GET",params:{limit:10}});if(e&&e.success&&e.data){const s=e.data,t=await(0,m.Z)("/getrooms",null,{method:"GET"}),i=null!==t&&void 0!==t&&t.data?Object.keys(t.data).length:s.length;c(s),E(i),O(!1)}else{const e=await(0,m.Z)("/getrooms",null,{method:"GET"});if(e&&e.success&&e.data&&Object.keys(e.data).length>0){const s=Object.values(e.data),t=s.length,i=Math.min(20,s.length),n=s.slice(0,i);if(n.length>0){const e=await(0,m.Z)("/getbatch-new",{queries:n,exhaustive:!0});if(e&&e.success&&e.data){const s=e.data.map(((e,s)=>{if(!e||!e.room)return null;const t=e.room;return{id:n[s],name:t.name||"Unknown Room",image:t.image||null,building:t.building||"",floor:t.floor||"",capacity:t.capacity||0,attributes:t.attributes||[],average_rating:t.average_rating||0,number_of_ratings:t.number_of_ratings||0,schedule:e.data||null}})).filter(Boolean),i=s.sort(((e,s)=>{const t=e.average_rating||0,i=s.average_rating||0;return i!==t?i-t:(s.number_of_ratings||0)-(e.number_of_ratings||0)})).slice(0,10);c(i),E(t),O(!1)}}}}}}catch(t){console.error("[RoomSelectorV2] Error fetching rooms:",t),l({title:"Error",message:"Failed to load rooms. Please try again.",type:"error"})}finally{v(!1),F.current=!1}}})()}),[b,_,l]);const q=(0,i.useMemo)((()=>{const e=new Set;return o.forEach((s=>{s.attributes&&Array.isArray(s.attributes)&&s.attributes.forEach((s=>e.add(s)))})),Array.from(e).sort()}),[o]),$=(0,i.useMemo)((()=>{let e=[...o];return N.length>0&&(e=e.filter((e=>N.every((s=>{var t;return null===(t=e.attributes)||void 0===t?void 0:t.includes(s)}))))),e.sort(((e,s)=>{switch(w){case"name":return e.name.localeCompare(s.name);case"rating":return(s.average_rating||0)-(e.average_rating||0);case"capacity":return(s.capacity||0)-(e.capacity||0);default:return 0}})),e}),[o,N,w]),[M,P]=(0,i.useState)([]);(0,i.useEffect)((()=>{(async()=>{const e=Array.from(g);if(0===e.length)return void P([]);const s=e.map((e=>o.find((s=>s.id===e)))).filter(Boolean),t=e.filter((e=>!o.find((s=>s.id===e))));if(0!==t.length)try{const e=await(0,m.Z)("/getbatch-new",{queries:t,exhaustive:!0});if(e.success&&e.data){const i=e.data.map(((e,s)=>{if(!e.data||!e.room)return null;const i=e.room;return{id:t[s],name:i.name||"Unknown Room",image:i.image||null,building:i.building||"",floor:i.floor||"",capacity:i.capacity||0,attributes:i.attributes||[],average_rating:i.average_rating||0,number_of_ratings:i.number_of_ratings||0,schedule:e.data}})).filter(Boolean);P([...s,...i])}else P(s)}catch(i){console.error("Error fetching selected room details:",i),P(s)}else P(s)})()}),[g,o]);const Z=(0,i.useRef)(null);(0,i.useEffect)((()=>{if(h)return;const e=Array.from(g),s=JSON.stringify(e.sort());if(Z.current===s)return;Z.current=s;const t=e.length>0?o.find((s=>s.id===e[0]))||M.find((s=>s.id===e[0])):null;R.current((s=>({...s,selectedRoomIds:e,location:(null===t||void 0===t?void 0:t.name)||null,classroomId:(null===t||void 0===t?void 0:t.id)||null,classroom_id:(null===t||void 0===t?void 0:t.id)||null}))),A.current(e.length>0)}),[g,o,M,h]);const L=(0,i.useCallback)((()=>{!h&&T&&b.trim()&&D((e=>e+1))}),[h,T,b]),U=(0,i.useCallback)((e=>{p((s=>{const t=new Set(s);return t.has(e)?t.delete(e):t.add(e),t}))}),[]),V=(0,i.useCallback)((e=>{y((s=>s.includes(e)?s.filter((s=>s!==e)):[...s,e]))}),[]),B=(0,i.useRef)(null);return(0,i.useEffect)((()=>{if(!b.trim())return;const e=new IntersectionObserver((e=>{e[0].isIntersecting&&T&&!h&&L()}),{threshold:.1}),s=B.current;return s&&e.observe(s),()=>{s&&e.unobserve(s)}}),[T,h,L,b]),(0,u.jsxs)("div",{className:"room-selector-v2",children:[(0,u.jsx)("div",{className:"info-box",children:(0,u.jsx)("p",{className:"info-text",children:x.trim()?"Search results for your query. Select one or more rooms for your event.":"Showing top 10 highest rated rooms. Search to find specific rooms by name, building, or attributes."})}),(0,u.jsxs)("div",{className:"search-filter-bar",children:[(0,u.jsxs)("div",{className:"search-input-wrapper",children:[(0,u.jsx)(n.JO,{icon:"mdi:magnify",className:"search-icon"}),(0,u.jsx)("input",{type:"text",className:"search-input",placeholder:"Search rooms...",value:x,onChange:e=>j(e.target.value)}),x&&(0,u.jsx)("button",{className:"clear-search",onClick:()=>j(""),children:(0,u.jsx)(n.JO,{icon:"mdi:close"})})]}),(0,u.jsxs)("div",{className:"filter-buttons",children:[(0,u.jsxs)("button",{className:"filter-btn "+(N.length>0?"active":""),onClick:()=>S(!0),children:[(0,u.jsx)(n.JO,{icon:"mdi:filter"}),"Filters",N.length>0&&(0,u.jsx)("span",{className:"filter-count",children:N.length})]}),(0,u.jsxs)("div",{className:"sort-dropdown",children:[(0,u.jsxs)("select",{className:"sort-select",value:w,onChange:e=>k(e.target.value),children:[(0,u.jsx)("option",{value:"name",children:"Sort by Name"}),(0,u.jsx)("option",{value:"rating",children:"Sort by Rating"}),(0,u.jsx)("option",{value:"capacity",children:"Sort by Capacity"})]}),(0,u.jsx)(n.JO,{icon:"mdi:chevron-down",className:"sort-icon"})]})]})]}),M.length>0&&(0,u.jsxs)("div",{className:"selected-section",children:[(0,u.jsxs)("h3",{children:["Selected Rooms (",M.length,")"]}),(0,u.jsx)("div",{className:"selected-grid",children:M.map((e=>(0,u.jsx)(ee,{room:e,isSelected:!0,onToggle:()=>U(e.id)},e.id)))})]}),(0,u.jsx)("div",{className:"rooms-section",children:h&&0===o.length?(0,u.jsxs)("div",{className:"loading-state",children:[(0,u.jsx)(Y.Z,{}),(0,u.jsx)("p",{children:"Loading rooms..."})]}):(0,u.jsxs)(u.Fragment,{children:[(0,u.jsx)("h3",{children:0===$.length?"No rooms found":b.trim()?`Search Results (${I}${I>$.length?"+":""})`:`Top Rated Rooms (${$.length})`}),(0,u.jsx)("div",{className:"rooms-grid",children:$.map((e=>(0,u.jsx)(ee,{room:e,isSelected:g.has(e.id),onToggle:()=>U(e.id)},e.id)))}),h&&o.length>0&&(0,u.jsx)("div",{className:"loading-more",children:(0,u.jsx)(Y.Z,{})}),T&&!h&&(0,u.jsx)("div",{ref:B,className:"scroll-trigger"}),!T&&o.length>0&&(0,u.jsx)("div",{className:"no-more-rooms",children:(0,u.jsx)("p",{children:"No more rooms to load"})})]})}),(0,u.jsx)(d.Z,{isOpen:C,onClose:()=>S(!1),defaultStyling:!0,children:(0,u.jsxs)("div",{className:"filter-popup-content",children:[(0,u.jsx)("h3",{children:"Filter by Attributes"}),(0,u.jsx)("div",{className:"attributes-grid",children:q.map((e=>(0,u.jsx)("button",{className:"attribute-tag "+(N.includes(e)?"selected":""),onClick:()=>V(e),children:e},e)))}),(0,u.jsxs)("div",{className:"popup-actions",children:[(0,u.jsx)("button",{className:"btn-secondary",onClick:()=>{y([]),S(!1)},children:"Clear"}),(0,u.jsx)("button",{className:"btn-primary",onClick:()=>S(!1),children:"Apply"})]})]})})]})};var te=t(87404),ie=t(33329),ne=t(21437),ae=t(82460),le=t(93496);const re=function(e){let{formData:s,setFormData:t,onComplete:n}=e;const{addNotification:a}=(0,r.l)(),[l,o]=(0,i.useState)([]),[c,d]=(0,i.useState)(!0),[h,v]=(0,i.useState)(!1),[g,p]=(0,i.useState)(1),[x,j]=(0,i.useState)(500),[b,f]=(0,i.useState)(new Date((new Date).setDate((new Date).getDate()-(new Date).getDay()))),[N,y]=(0,i.useState)(new Date),[w,k]=(0,i.useState)((new Date).getMonth()+1),[C,S]=(0,i.useState)((new Date).getFullYear()),[_,D]=(0,i.useState)({type:"all"}),[T,O]=(0,i.useState)(!0),[I,E]=(0,i.useState)((()=>s.start_time&&s.end_time?[{id:"initial-selection",startTime:new Date(s.start_time),endTime:new Date(s.end_time),startDay:new Date(s.start_time),endDay:new Date(s.end_time),duration:(new Date(s.end_time)-new Date(s.start_time))/6e4}]:[])),R=(0,i.useRef)(null);(0,i.useRef)(!1),(0,i.useEffect)((()=>{R.current&&j(R.current.clientHeight)}),[R.current]);const A=e=>{const s={M:1,T:2,W:3,R:4,F:5},t={};return Object.keys(s).forEach((e=>{t[e]=[]})),e.forEach((e=>{var i;const n=null===(i=e.data)||void 0===i?void 0:i.weekly_schedule;n&&Object.keys(s).forEach((e=>{n[e]&&n[e].length>0&&n[e].forEach((s=>{t[e].push({start:s.start_time,end:s.end_time,class_name:s.class_name})}))}))})),Object.keys(t).forEach((e=>{t[e]=(e=>{if(0===e.length)return[];e.sort(((e,s)=>e.start-s.start));const s=[e[0]];for(let t=1;t<e.length;t++){const i=e[t],n=s[s.length-1];i.start<=n.end?n.end=Math.max(n.end,i.end):s.push(i)}return s})(t[e])})),t},J=async()=>{try{if(d(!0),!s.selectedRoomIds||0===s.selectedRoomIds.length)return a({title:"No Rooms Selected",message:"Please select rooms in the previous step",type:"error"}),o([]),void d(!1);const e=await(0,m.Z)("/getbatch-new",{queries:s.selectedRoomIds,exhaustive:!0});if(!e||!e.success||!e.data)throw new Error("Failed to fetch room schedules");const t=e.data.map(((e,t)=>{var i;const n=s.selectedRoomIds[t];return{id:n,name:(null===e||void 0===e||null===(i=e.room)||void 0===i?void 0:i.name)||`Room ${n}`,data:(null===e||void 0===e?void 0:e.data)||{},roomInfo:(null===e||void 0===e?void 0:e.room)||{}}})),i=(e=>{const s=[],t=new Date,i=new Date(t.setDate(t.getDate()-t.getDay()));for(let n=0;n<4;n++)Object.entries(e).forEach((e=>{let[t,a]=e;const l={M:1,T:2,W:3,R:4,F:5}[t];a.forEach(((e,a)=>{const r=new Date(i);r.setDate(i.getDate()+7*n+l);const o=new Date(r),c=Math.floor(e.start/60),d=e.start%60;o.setHours(c,d,0,0);const m=new Date(r),u=Math.floor(e.end/60),h=e.end%60;m.setHours(u,h,0,0),s.push({id:`blocked-${n}-${t}-${a}`,name:"Room Unavailable",type:"blocked",location:"Multiple Rooms",start_time:o,end_time:m,status:"blocked",description:"Combined unavailable time from selected rooms"})}))}));return s})(A(t));o(i),d(!1)}catch(e){console.error("Error fetching and combining room schedules:",e),a({title:"Error",message:"Failed to load room schedules",type:"error"}),d(!1)}},F=e=>{f((s=>{const t=new Date(s);return t.setDate(t.getDate()+e),t}))},q=e=>{y((s=>{const t=new Date(s);return t.setDate(t.getDate()+e),t}))};(0,i.useEffect)((()=>{J()}),[s.selectedRoomIds]);const $=(0,i.useCallback)((e=>{if(E(e),e&&e.length>0){const s=e[0];t((e=>{var t,i;const n=new Date(s.startTime),a=new Date(s.endTime);return(null===(t=e.start_time)||void 0===t?void 0:t.getTime())===n.getTime()&&(null===(i=e.end_time)||void 0===i?void 0:i.getTime())===a.getTime()?e:{...e,start_time:n,end_time:a}}))}else t((e=>e.start_time||e.end_time?{...e,start_time:null,end_time:null}:e))}),[t]),M=(0,i.useRef)(n),P=(0,i.useRef)(null);if((0,i.useEffect)((()=>{M.current=n}),[n]),(0,i.useEffect)((()=>{const e=!(!s.start_time||!s.end_time),t=s.selectedRoomIds&&s.selectedRoomIds.length>0&&e;h||v(!0),P.current!==t&&(P.current=t,M.current(t))}),[s.start_time,s.end_time,s.selectedRoomIds,h]),c)return(0,u.jsx)("div",{className:"when-component",children:(0,u.jsx)("div",{className:"loading",children:(0,u.jsx)("p",{children:"Loading room schedules..."})})});if(!s.selectedRoomIds||0===s.selectedRoomIds.length)return(0,u.jsx)("div",{className:"when-component",children:(0,u.jsx)("div",{className:"no-rooms",children:(0,u.jsx)("p",{children:"No rooms available. Please go back and select rooms first."})})});const Z=(()=>{if(0===g)return l.filter((e=>{const s=new Date(e.start_time);return s.getMonth()+1===w&&s.getFullYear()===C}));if(1===g){const e=new Date(b);return e.setDate(e.getDate()+6),e.setHours(23,59,59,999),l.filter((s=>{const t=new Date(s.start_time);return t>=b&&t<=e}))}return l.filter((e=>{const s=new Date(e.start_time),t=new Date(s.getFullYear(),s.getMonth(),s.getDate()),i=new Date(N.getFullYear(),N.getMonth(),N.getDate());return t.getTime()===i.getTime()}))})(),L=(new Date).getMonth()+1,U=(new Date).getFullYear(),V=(new Date).getDate();return(0,u.jsxs)("div",{className:"when-component",children:[(0,u.jsx)("div",{className:"info-box",children:(0,u.jsxs)("div",{className:"info-content",children:[(0,u.jsx)("span",{className:"info-text",children:T?`Grey blocks show unavailable times across all selected rooms (${s.selectedRoomIds.length} rooms). Click and drag on the calendar to select your event time.`:'Click and drag on the calendar to select your event time. Toggle "Show Availability" to see room availability.'}),s.start_time&&s.end_time&&(0,u.jsxs)("div",{className:"selected-time-info",style:{marginTop:"0.5rem",fontWeight:"500"},children:["Selected: ",new Date(s.start_time).toLocaleString()," - ",new Date(s.end_time).toLocaleString()]})]})}),(0,u.jsxs)("div",{className:"calendar-wrapper",children:[(0,u.jsxs)("div",{className:"calendar-controls",children:[(0,u.jsxs)("div",{className:"calendar-navigation",children:[0===g&&(0,u.jsxs)(u.Fragment,{children:[(0,u.jsx)("button",{onClick:()=>{k((e=>1===e?12:e-1)),S((e=>1===w?e-1:e))},className:"nav-button",children:"\u2190"}),(0,u.jsx)("span",{className:"date-display",children:new Date(C,w-1).toLocaleDateString("en-US",{month:"long",year:"numeric"})}),(0,u.jsx)("button",{onClick:()=>{k((e=>12===e?1:e+1)),S((e=>12===w?e+1:e))},className:"nav-button",children:"\u2192"})]}),1===g&&(0,u.jsxs)(u.Fragment,{children:[(0,u.jsx)("button",{onClick:()=>F(-7),className:"nav-button",children:"\u2190"}),(0,u.jsxs)("span",{className:"date-display",children:[b.toLocaleDateString("en-US",{month:"short",day:"numeric"})," - ",new Date(b.getTime()+5184e5).toLocaleDateString("en-US",{month:"short",day:"numeric"})]}),(0,u.jsx)("button",{onClick:()=>F(7),className:"nav-button",children:"\u2192"})]}),2===g&&(0,u.jsxs)(u.Fragment,{children:[(0,u.jsx)("button",{onClick:()=>q(-1),className:"nav-button",children:"\u2190"}),(0,u.jsx)("span",{className:"date-display",children:N.toLocaleDateString("en-US",{weekday:"long",month:"long",day:"numeric"})}),(0,u.jsx)("button",{onClick:()=>q(1),className:"nav-button",children:"\u2192"})]})]}),(0,u.jsxs)("div",{className:"calendar-controls-right",children:[1===g&&(0,u.jsxs)("div",{className:"availability-toggle",style:{display:"flex",alignItems:"center",gap:"0.5rem",marginRight:"1rem"},children:[(0,u.jsx)("label",{style:{fontSize:"0.875rem",cursor:"pointer",userSelect:"none"},onClick:()=>O(!T),children:"Show Availability"}),(0,u.jsx)(ae.Z,{options:["off","on"],onChange:e=>O(1===e),selectedPass:T?1:0,setSelectedPass:e=>O(1===e)})]}),(0,u.jsx)(ae.Z,{options:["month","week","day"],onChange:p,selectedPass:g,setSelectedPass:p}),(0,u.jsx)(le.Z,{options:["all","study","campus","social","club","meeting","sports"],selected:_.type,setSelected:e=>D({..._,type:e}),label:"filter"})]})]}),(0,u.jsxs)("div",{className:"calendar-content",ref:R,children:[0===g&&(0,u.jsx)(ne.Z,{month:w,year:C,events:Z,height:`${x}px`,currentMonth:L,currentYear:U,currentDay:V,onWeekClick:e=>{f(new Date(e)),p(1)}}),1===g&&(0,u.jsx)(te.Z,{startOfWeek:b,events:Z,height:`${x}px`,dayClick:e=>{y(new Date(e)),p(2)},autoEnableSelection:!0,selectionMode:"single",allowCrossDaySelection:!1,timeIncrement:15,singleSelectionOnly:!0,startHour:6,endHour:24,showAvailability:T,onSelectionsChange:$,initialSelections:I}),2===g&&(0,u.jsx)(ie.Z,{selectedDay:N,events:Z,height:`${x}px`})]})]})]})};function oe(e){let{popupStep:s,popupFormData:t,setPopupFormData:i,onLocationSelected:a,onTimeSelected:l,onClose:r,onBack:o,handleClose:c}=e;const d=c||r;return(0,u.jsxs)("div",{className:"location-time-popup-content",children:[(0,u.jsxs)("div",{className:"popup-header",children:[(0,u.jsx)("h3",{children:"location"===s?"Select Location":"Select Time"}),(0,u.jsx)("button",{className:"popup-close",onClick:d,children:(0,u.jsx)(n.JO,{icon:"mdi:close"})})]}),(0,u.jsx)("div",{className:"popup-body",children:"location"===s?(0,u.jsxs)("div",{children:[(0,u.jsx)(se,{formData:t,setFormData:i,onComplete:e=>{}}),(0,u.jsxs)("div",{className:"popup-actions",children:[(0,u.jsx)("button",{className:"popup-button secondary",onClick:d,children:"Cancel"}),(0,u.jsx)("button",{className:"popup-button primary",onClick:a,disabled:(!t.selectedRoomIds||0===t.selectedRoomIds.length)&&(!t.location||!t.location.trim()),children:"Next: Select Time"})]})]}):(0,u.jsxs)("div",{children:[(0,u.jsx)(re,{formData:t,setFormData:i,onComplete:e=>{}}),(0,u.jsxs)("div",{className:"popup-actions",children:[(0,u.jsx)("button",{className:"popup-button secondary",onClick:o,children:"Back"}),(0,u.jsx)("button",{className:"popup-button primary",onClick:l,disabled:!t.start_time||!t.end_time,children:"Confirm"})]})]})})]})}const ce=function(e){var s;let{event:t,agenda:l,orgId:o,onRefresh:c}=e;const{addNotification:h}=(0,r.l)(),[v,g]=(0,i.useState)(!1),[p,x]=(0,i.useState)("location"),[j,b]=(0,i.useState)(null),f=(0,a.i)("/api/event-system-config/form-config"),[N,y]=(0,i.useState)({name:"",description:"",type:"",visibility:"",expectedAttendance:0,contact:"",externalLink:"",image:null,start_time:null,end_time:null,location:"",classroom_id:null,selectedRoomIds:[]}),[w,k]=(0,i.useState)(null),[C,S]=(0,i.useState)({selectedRoomIds:[],start_time:null,end_time:null});(0,i.useEffect)((()=>{if(t){const e={name:t.name||"",description:t.description||"",type:t.type||"",visibility:t.visibility||"",expectedAttendance:t.expectedAttendance||0,contact:t.contact||"",externalLink:t.externalLink||"",image:null,start_time:t.start_time?new Date(t.start_time):null,end_time:t.end_time?new Date(t.end_time):null,location:t.location||"",classroom_id:t.classroom_id||null,selectedRoomIds:t.classroom_id?[t.classroom_id]:[]};t.customFields&&Object.keys(t.customFields).forEach((s=>{e[s]=t.customFields[s]})),y(e),k(JSON.parse(JSON.stringify(e)))}}),[t]),(0,i.useEffect)((()=>{v&&"location"===p&&S({selectedRoomIds:N.selectedRoomIds||[],location:N.location,classroom_id:N.classroom_id,start_time:N.start_time,end_time:N.end_time})}),[v,p]);const _=(e,s)=>{y((t=>({...t,[e]:s})))},D=()=>{g(!1),x("location"),b(null)},{hasChanges:T,saving:O,handleSave:I,handleDiscard:E}=(0,W.Z)(w,N,(async()=>{const e=(()=>{const e={};N.name&&""!==N.name.trim()||(e.name="Event name is required"),N.type||(e.type="Event type is required"),N.visibility||(e.visibility="Visibility is required"),N.start_time&&N.end_time||(e.time="Date and time are required");const s=N.selectedRoomIds&&N.selectedRoomIds.length>0,t=N.location&&""!==N.location.trim();return s||t||(e.location="Location is required (select a room or enter an address/place)"),e})();if(Object.keys(e).length>0)return h({title:"Validation Error",message:"Please fix all errors before saving",type:"error"}),!1;try{var s,i;const e={name:N.name,description:N.description,type:N.type,visibility:N.visibility,expectedAttendance:N.expectedAttendance,contact:N.contact||"",externalLink:N.externalLink||"",start_time:N.start_time.toISOString(),end_time:N.end_time.toISOString(),classroom_id:N.classroom_id,location:N.location},n={};if(null!==(s=f.data)&&void 0!==s&&null!==(i=s.data)&&void 0!==i&&i.fields){const e=["name","description","type","visibility","expectedAttendance","contact","externalLink","start_time","end_time","location","classroom_id","selectedRoomIds","image","hostingId","hostingType","rsvpEnabled","rsvpRequired","rsvpDeadline"];f.data.data.fields.forEach((s=>{e.includes(s.name)||void 0===N[s.name]||(n[s.name]=N[s.name])}))}Object.keys(n).length>0&&(e.customFields=n);const a=o?`/org-event-management/${o}/events/${t._id}`:`/update-event/${t._id}`,l=await(0,m.Z)(a,e,{method:"PUT"});if(l.success){if(N.image instanceof File){const e=new FormData;e.append("image",N.image),e.append("eventId",t._id),await(0,m.Z)("/upload-event-image",e,{method:"POST"})}return h({title:"Success",message:"Event updated successfully",type:"success"}),k(JSON.parse(JSON.stringify(N))),c&&c(),!0}throw new Error(l.message||"Failed to update event")}catch(n){return h({title:"Error",message:n.message||"Failed to update event",type:"error"}),!1}}),(()=>{w&&y(JSON.parse(JSON.stringify(w)))})),R=e=>e?new Date(e).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"}):"",A=null===(s=f.data)||void 0===s?void 0:s.data,J=(0,i.useMemo)((()=>{if(null===A||void 0===A||!A.fields)return[];const e=["name","description","type","visibility","expectedAttendance","image","start_time","end_time","location","classroom_id","selectedRoomIds","contact","externalLink","hostingId","hostingType","rsvpEnabled","rsvpRequired","rsvpDeadline","registrationEnabled","registrationRequired","registrationDeadline","registrationFormId","maxAttendees"],s=["location","date-time"];return A.fields.filter((t=>t.isActive&&!s.includes(t.step)&&!e.includes(t.name)))}),[A]),F=t?{...t,eventAgenda:{items:(null===l||void 0===l?void 0:l.items)||[],isPublished:null===l||void 0===l?void 0:l.isPublished}}:null;return t?(0,u.jsxs)("div",{className:"event-editor-tab",children:[F&&(0,u.jsx)(z,{event:F,onRefetch:c}),(0,u.jsxs)("div",{className:"editor-header",children:[(0,u.jsx)("h2",{children:"Details"}),T&&(0,u.jsxs)("div",{className:"editor-actions",children:[(0,u.jsx)("button",{type:"button",className:"cancel-button",onClick:E,disabled:O,children:"Discard"}),(0,u.jsx)("button",{type:"button",className:"save-button",onClick:I,disabled:O,children:O?"Saving...":"Save"})]})]}),(0,u.jsxs)("div",{className:"editor-content create-event-v3-form",children:[(0,u.jsx)("div",{className:"form-section",children:(0,u.jsx)(G.Z,{field:{name:"name",label:"Event Name",inputType:"text",placeholder:"Event name",validation:{}},value:N.name,onChange:_,formData:N,errors:{},color:"var(--primary-color)"})}),(0,u.jsx)("div",{className:"form-section",children:(0,u.jsx)(G.Z,{field:{name:"description",label:"Description",inputType:"markdown-textarea",placeholder:"Event description",validation:{},allowExpand:!0},value:N.description||"",onChange:_,formData:N,errors:{},color:"var(--primary-color)"})}),(0,u.jsx)("div",{className:"form-section",children:(0,u.jsx)(G.Z,{field:{name:"type",label:"Event Type",inputType:"select",validation:{options:["study","workshop","campus","social","club","meeting","sports"]}},value:N.type,onChange:_,formData:N,errors:{},color:"var(--primary-color)"})}),(0,u.jsx)("div",{className:"form-section",children:(0,u.jsx)(G.Z,{field:{name:"visibility",label:"Visibility",inputType:"select",validation:{}},value:N.visibility,onChange:_,formData:N,errors:{},color:"var(--primary-color)"})}),(0,u.jsx)("div",{className:"form-section",children:(0,u.jsx)(G.Z,{field:{name:"expectedAttendance",label:"Expected Attendance",inputType:"number",placeholder:"1",validation:{min:1}},value:N.expectedAttendance,onChange:_,formData:N,errors:{},color:"var(--primary-color)"})}),(0,u.jsxs)("div",{className:"form-section",children:[(0,u.jsx)("label",{className:"section-label",children:"Event Image"}),(0,u.jsx)(Q.Z,{uploadText:"Drag your image here",onFileSelect:e=>_("image",e),onFileClear:()=>_("image",null),showPrompt:!1,showActions:!1,initialImageUrl:null===t||void 0===t?void 0:t.image,color:"var(--primary-color)"})]}),(0,u.jsxs)("div",{className:"form-section",children:[(0,u.jsx)("label",{className:"section-label",children:"Date & Time"}),(0,u.jsxs)("div",{className:"read-only-value",children:[(q=N.start_time,q?`${(e=>e?new Date(e).toLocaleDateString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"}):"Not set")(q)} at ${R(q)}`:"Not set")," \u2013 ",R(N.end_time)]}),(0,u.jsxs)("button",{type:"button",className:"change-location-time-button",onClick:()=>{x("location"),g(!0)},children:[(0,u.jsx)(n.JO,{icon:"mdi:calendar-clock"}),"Change Location & Time"]})]}),(0,u.jsx)("div",{className:"form-section",children:(0,u.jsx)(G.Z,{field:{name:"location",label:"Location",inputType:"text",placeholder:"e.g. Room 101, Off-campus, or address",validation:{}},value:N.location||"",onChange:_,formData:N,errors:{},color:"var(--primary-color)"})}),(0,u.jsx)("div",{className:"form-section",children:(0,u.jsx)(G.Z,{field:{name:"contact",label:"Contact",inputType:"text",placeholder:"Contact information",validation:{}},value:N.contact||"",onChange:_,formData:N,errors:{},color:"var(--primary-color)"})}),(0,u.jsx)("div",{className:"form-section",children:(0,u.jsx)(G.Z,{field:{name:"externalLink",label:"External Link",inputType:"url",placeholder:"https://...",validation:{}},value:N.externalLink||"",onChange:_,formData:N,errors:{},color:"var(--primary-color)"})}),J.length>0&&(0,u.jsxs)("div",{className:"form-section",children:[(0,u.jsx)("label",{className:"section-label",children:"Additional Information"}),J.map((e=>(0,u.jsxs)("div",{className:"field-group",children:[(0,u.jsxs)("label",{className:"section-label",children:[e.label,e.isRequired&&(0,u.jsx)("span",{className:"required",children:"*"})]}),(0,u.jsx)(G.Z,{field:e,value:N[e.name],onChange:_,formData:N,color:"var(--primary-color)"})]},e.name)))]})]}),v&&(0,u.jsx)(d.Z,{isOpen:v,onClose:D,customClassName:"location-time-popup",children:(0,u.jsx)(oe,{popupStep:p,popupFormData:C,setPopupFormData:S,onLocationSelected:()=>{x("time"),b({selectedRoomIds:C.selectedRoomIds,location:C.location,classroom_id:C.classroom_id})},onTimeSelected:()=>{C.start_time&&C.end_time&&y((e=>{const s=C.selectedRoomIds&&C.selectedRoomIds.length>0;return{...e,start_time:C.start_time,end_time:C.end_time,...s?{selectedRoomIds:C.selectedRoomIds,classroom_id:C.classroom_id||C.selectedRoomIds[0],location:C.location||e.location}:{}}})),D()},onClose:D,onBack:()=>x("location")})})]}):(0,u.jsx)("div",{className:"event-editor-tab",children:"Loading..."});var q};var de=t(54164);const me=function(e){let{item:s,event:t,latestItemEnd:a,onSave:l,onCancel:r}=e;const[o,c]=(0,i.useState)("duration"),[m,h]=(0,i.useState)({title:"",description:"",startTime:null,endTime:null,durationMinutes:30,type:"Activity",location:"",isPublic:!0});(0,i.useEffect)((()=>{if(s){let e=null,i=null;if(s.startTime&&(e="string"===typeof s.startTime?new Date(s.startTime):s.startTime),s.endTime&&(i="string"===typeof s.endTime?new Date(s.endTime):s.endTime),!e||!i){const s=a?a instanceof Date?a:new Date(a):null!==t&&void 0!==t&&t.start_time?new Date(t.start_time):new Date,n=new Date(s);n.setMinutes(n.getMinutes()+30),e=e||s,i=i||n}const n=e&&i?Math.max(1,Math.round((i-e)/6e4)):30;h({title:s.title||"",description:s.description||"",startTime:e,endTime:i,durationMinutes:n,type:s.type||"Activity",location:s.location||"",isPublic:void 0===s.isPublic||s.isPublic})}else if(null!==t&&void 0!==t&&t.start_time||a){const e=a?a instanceof Date?a:new Date(a):new Date(t.start_time),s=new Date(e);s.setMinutes(s.getMinutes()+30),h((t=>({...t,startTime:e,endTime:s,durationMinutes:30})))}}),[s,t,a]);const v=e=>{if(!e)return"";const s=e instanceof Date?e:new Date(e);if(isNaN(s.getTime()))return"";return`${s.getFullYear()}-${String(s.getMonth()+1).padStart(2,"0")}-${String(s.getDate()).padStart(2,"0")}T${String(s.getHours()).padStart(2,"0")}:${String(s.getMinutes()).padStart(2,"0")}`},g=(e,s)=>{h((t=>{const i={...t};if("startTime"===e){const e=s?new Date(s):null;if(i.startTime=e,e&&i.endTime){const s=new Date(i.endTime);s>e&&(i.durationMinutes=Math.max(1,Math.round((s-e)/6e4)))}}else if("endTime"===e){const e=s?new Date(s):null;if(i.endTime=e,e&&i.startTime){const s=new Date(i.startTime);e>s&&(i.durationMinutes=Math.max(1,Math.round((e-s)/6e4)))}}else if("durationMinutes"===e){const e=parseInt(s,10);if(e>0&&i.startTime){i.durationMinutes=e;const s=new Date(i.startTime),t=new Date(s);t.setMinutes(t.getMinutes()+e),i.endTime=t}else i.durationMinutes=s}else i[e]=s;return i}))};return(0,u.jsx)(d.Z,{isOpen:!0,onClose:r,customClassName:"agenda-item-editor-popup",hideCloseButton:!0,children:(0,u.jsxs)("div",{className:"agenda-item-editor",children:[(0,u.jsxs)("div",{className:"editor-header",children:[(0,u.jsxs)("h3",{children:[(0,u.jsx)(n.JO,{icon:"mdi:pencil"}),null!==s&&void 0!==s&&s.id&&!s.id.startsWith("item-")?"Edit":"Create"," Agenda Item"]}),(0,u.jsx)("button",{className:"close-btn",onClick:r,children:(0,u.jsx)(n.JO,{icon:"mdi:close"})})]}),(0,u.jsxs)("form",{onSubmit:e=>{if(e.preventDefault(),!m.title||""===m.title.trim())return void alert("Please enter a title.");let t=m.startTime,i=m.endTime;if("duration"===o){const e=parseInt(m.durationMinutes,10);if(!e||e<=0)return void alert("Please enter a valid duration.");t=m.startTime?new Date(m.startTime):null,i=t?new Date(t):null,i&&i.setMinutes(i.getMinutes()+e)}else{if(!t||!i)return void alert("Please enter a start time and end time.");if(t=new Date(t),i=new Date(i),i<=t)return void alert("End time must be after start time.")}const n={...s,...m,startTime:t instanceof Date?t:new Date(t),endTime:i instanceof Date?i:new Date(i)};delete n.durationMinutes,l(n)},className:"editor-form",children:[(0,u.jsxs)("div",{className:"form-group",children:[(0,u.jsxs)("label",{children:["Title ",(0,u.jsx)("span",{className:"required",children:"*"})]}),(0,u.jsx)("input",{type:"text",value:m.title,onChange:e=>g("title",e.target.value),required:!0,placeholder:"Agenda item title"})]}),(0,u.jsxs)("div",{className:"form-group",children:[(0,u.jsx)("label",{children:"Description"}),(0,u.jsx)("textarea",{value:m.description,onChange:e=>g("description",e.target.value),rows:4,placeholder:"Item description"})]}),(0,u.jsxs)("div",{className:"form-row",children:[(0,u.jsxs)("div",{className:"form-group",children:[(0,u.jsx)("label",{children:"Type"}),(0,u.jsx)("select",{value:m.type,onChange:e=>g("type",e.target.value),children:["Activity","Break","Setup","Breakdown","Transition","Speaker","Custom"].map((e=>(0,u.jsx)("option",{value:e,children:e},e)))})]}),(0,u.jsxs)("div",{className:"form-group",children:[(0,u.jsx)("label",{children:"Location"}),(0,u.jsx)("input",{type:"text",value:m.location,onChange:e=>g("location",e.target.value),placeholder:"Location"})]})]}),(0,u.jsxs)("div",{className:"form-group",children:[(0,u.jsx)("label",{children:"How to specify time"}),(0,u.jsxs)("div",{className:"input-mode-toggle",children:[(0,u.jsxs)("button",{type:"button",className:"mode-btn "+("duration"===o?"active":""),onClick:()=>c("duration"),children:[(0,u.jsx)(n.JO,{icon:"mdi:timer-outline"}),(0,u.jsx)("span",{children:"Duration"})]}),(0,u.jsxs)("button",{type:"button",className:"mode-btn "+("endTime"===o?"active":""),onClick:()=>c("endTime"),children:[(0,u.jsx)(n.JO,{icon:"mdi:clock-outline"}),(0,u.jsx)("span",{children:"End Time"})]})]})]}),(0,u.jsxs)("div",{className:"form-row",children:[(0,u.jsxs)("div",{className:"form-group",children:[(0,u.jsx)("label",{children:"Start Time"}),(0,u.jsx)("input",{type:"datetime-local",value:m.startTime?v(m.startTime):"",onChange:e=>g("startTime",e.target.value),required:!0})]}),"duration"===o?(0,u.jsxs)("div",{className:"form-group",children:[(0,u.jsx)("label",{children:"Duration (minutes)"}),(0,u.jsx)("input",{type:"number",min:"1",value:m.durationMinutes,onChange:e=>g("durationMinutes",e.target.value),placeholder:"e.g., 30",required:!0}),(0,u.jsx)("p",{className:"help-text",children:"End time is calculated from start + duration"})]}):(0,u.jsxs)("div",{className:"form-group",children:[(0,u.jsx)("label",{children:"End Time"}),(0,u.jsx)("input",{type:"datetime-local",value:m.endTime?v(m.endTime):"",onChange:e=>g("endTime",e.target.value),required:!0})]})]}),(0,u.jsxs)("div",{className:"form-group checkbox-group",children:[(0,u.jsxs)("label",{children:[(0,u.jsx)("input",{type:"checkbox",checked:m.isPublic,onChange:e=>g("isPublic",e.target.checked)}),(0,u.jsx)("span",{children:"Public (visible to attendees)"})]}),(0,u.jsx)("p",{className:"help-text",children:"Uncheck to make this item internal-only"})]}),(0,u.jsxs)("div",{className:"form-actions",children:[(0,u.jsx)("button",{type:"button",className:"btn-cancel",onClick:r,children:"Cancel"}),(0,u.jsxs)("button",{type:"submit",className:"btn-save",children:[(0,u.jsx)(n.JO,{icon:"mdi:check"}),(0,u.jsx)("span",{children:"Save Item"})]})]})]})]})})};const ue=function(e){let{event:s,orgId:t,timeDifference:a,onConfirm:l,onCancel:o,onPublishWithoutAdjusting:c,isOpen:h=!0}=e;const{addNotification:v}=(0,r.l)(),[g,p]=(0,i.useState)(!1),[x,j]=(0,i.useState)(null),[b,f]=(0,i.useState)(null),N=(null===a||void 0===a?void 0:a.isOver)||!1,y=(null===a||void 0===a?void 0:a.isUnder)||!1,w=Math.abs((null===a||void 0===a?void 0:a.difference)||0),k=(()=>{if(null===s||void 0===s||!s.start_time||null===s||void 0===s||!s.end_time)return null;const e=new Date(s.end_time),t=new Date(e);return t.setMinutes(t.getMinutes()+a.difference),t})();(0,i.useEffect)((()=>{(N||y)&&null!==s&&void 0!==s&&s.classroom_id&&k?C():null!==s&&void 0!==s&&s.classroom_id||j(!0)}),[]);const C=async()=>{if(null!==s&&void 0!==s&&s._id&&t&&k){p(!0);try{try{const e=await(0,m.Z)(`/rooms/${s.classroom_id}`,null,{method:"GET"});e.success&&e.room&&f(e.room.name)}catch(e){console.warn("Could not fetch room name:",e)}const i=await(0,m.Z)(`/org-event-management/${t}/events/${s._id}/check-room-availability`,{startTime:s.start_time,endTime:k.toISOString()},{method:"POST"});i.success?j(i.data.isAvailable):j(!1)}catch(i){console.error("Error checking room availability:",i),j(!1)}finally{p(!1)}}},S=()=>{!1!==x?k&&l(k.toISOString()):v({title:"Room Unavailable",message:"The room is not available for the extended time. Please adjust your agenda or choose a different time.",type:"error"})},_=e=>{if(!e)return"";return new Date(e).toLocaleString("en-US",{month:"short",day:"numeric",hour:"numeric",minute:"2-digit",hour12:!0})};return(0,u.jsx)(d.Z,{isOpen:h,onClose:o,defaultStyling:!0,customClassName:"publish-confirm-modal-popup",children:(0,u.jsxs)("div",{className:"publish-confirm-modal",children:[(0,u.jsx)("div",{className:"modal-header",children:(0,u.jsxs)("h3",{children:[(0,u.jsx)(n.JO,{icon:"mdi:publish"}),"Publish Agenda"]})}),(0,u.jsxs)("div",{className:"modal-content",children:[(0,u.jsxs)("div",{className:"publish-info-note",children:[(0,u.jsx)(n.JO,{icon:"mdi:information-outline"}),(0,u.jsx)("span",{children:"Your agenda is already saved. Publishing makes it visible to attendees on the event page."})]}),N&&(0,u.jsxs)("div",{className:"time-warning-section over",children:[(0,u.jsx)(n.JO,{icon:"mdi:alert-circle"}),(0,u.jsxs)("div",{className:"warning-content",children:[(0,u.jsx)("h4",{children:"Agenda exceeds event time"}),(0,u.jsxs)("p",{children:["Your agenda is ",(0,u.jsxs)("strong",{children:[w," minutes"]})," longer than the scheduled event time."]})]})]}),y&&(0,u.jsxs)("div",{className:"time-warning-section under",children:[(0,u.jsx)(n.JO,{icon:"mdi:alert-circle-outline"}),(0,u.jsxs)("div",{className:"warning-content",children:[(0,u.jsx)("h4",{children:"Agenda shorter than event time"}),(0,u.jsxs)("p",{children:["Your agenda is ",(0,u.jsxs)("strong",{children:[w," minutes"]})," shorter than the scheduled event time."]})]})]}),(N||y)&&(0,u.jsxs)("div",{className:"time-comparison",children:[(0,u.jsxs)("div",{className:"time-row",children:[(0,u.jsx)("span",{className:"time-label",children:"Current end time:"}),(0,u.jsx)("span",{className:"time-value",children:_(null===s||void 0===s?void 0:s.end_time)})]}),(0,u.jsxs)("div",{className:"time-row",children:[(0,u.jsx)("span",{className:"time-label",children:"Proposed end time:"}),(0,u.jsx)("span",{className:"time-value "+(N?"over":"under"),children:_(k)})]})]}),(null===s||void 0===s?void 0:s.classroom_id)&&(N||y)&&(0,u.jsx)("div",{className:"room-availability-section",children:g?(0,u.jsxs)("div",{className:"availability-checking",children:[(0,u.jsx)(n.JO,{icon:"mdi:loading",className:"spinner"}),(0,u.jsx)("span",{children:"Checking room availability..."})]}):!0===x?(0,u.jsxs)("div",{className:"availability-status available",children:[(0,u.jsx)(n.JO,{icon:"mdi:check-circle"}),(0,u.jsxs)("span",{children:[b?`Room "${b}" is available`:"Room is available"," for the extended time"]})]}):!1===x?(0,u.jsxs)("div",{className:"availability-status unavailable",children:[(0,u.jsx)(n.JO,{icon:"mdi:alert-circle"}),(0,u.jsxs)("span",{children:[b?`Room "${b}" is unavailable`:"Room is unavailable"," for the extended time"]})]}):null}),!(null!==s&&void 0!==s&&s.classroom_id)&&(N||y)&&(0,u.jsxs)("div",{className:"no-room-notice",children:[(0,u.jsx)(n.JO,{icon:"mdi:information"}),(0,u.jsx)("span",{children:"No room reserved for this event. Time adjustment will proceed without room check."})]})]}),(0,u.jsxs)("div",{className:"modal-actions",children:[(N||y)&&(0,u.jsx)("button",{className:"btn-adjust "+(!1===x?"disabled":""),onClick:S,disabled:!1===x||g,children:"Adjust Time & Publish"}),(0,u.jsx)("button",{className:"btn-publish-without",onClick:N||y?c:S,children:N||y?"Publish Without Adjusting":"Publish"})]})]})})};var he=t(50188),ve=t(71096),ge=t(72547);const pe=[{id:"compact",label:"Compact",value:1},{id:"normal",label:"Normal",value:3},{id:"expanded",label:"Expanded",value:5}];const xe=function(e){var s,t;let{event:l,orgId:o,onRefresh:c,isTabActive:d=!0}=e;const{addNotification:h}=(0,r.l)(),[g,p]=(0,i.useState)([]),[x,j]=(0,i.useState)(null),[b,f]=(0,i.useState)(!1),[N,y]=(0,i.useState)(!1),[w,k]=(0,i.useState)(!1),[C,S]=(0,i.useState)(!1),[_,D]=(0,i.useState)(!1),[T,O]=(0,i.useState)(null),[I,E]=(0,i.useState)((()=>(0,ge.q)().viewMode)),[R,A]=(0,i.useState)((()=>(0,ge.q)().calendarMinuteHeight));(0,i.useEffect)((()=>{localStorage.setItem("meridian-agenda-view",JSON.stringify({viewMode:I,calendarMinuteHeight:R}))}),[I,R]);const[J,F]=(0,i.useState)(!1),q=(0,i.useRef)(null),{data:$,loading:M,refetch:P}=(0,a.i)(null!==l&&void 0!==l&&l._id&&o?`/org-event-management/${o}/events/${l._id}/agenda`:null);(0,i.useEffect)((()=>{var e;if(null!==$&&void 0!==$&&$.success&&null!==(e=$.data)&&void 0!==e&&e.agenda){const e=$.data.agenda;y(e.isPublished||!1);const s=null!==l&&void 0!==l&&l.start_time?new Date(l.start_time):new Date;let t=new Date(s);const i=(e.items||[]).map(((e,s)=>{const i={...e};if(e.startTime&&"string"===typeof e.startTime&&(i.startTime=new Date(e.startTime)),e.endTime&&"string"===typeof e.endTime&&(i.endTime=new Date(e.endTime)),i.startTime&&i.endTime)t=new Date(i.endTime);else{const s=parseInt(e.durationMinutes,10)||30;i.startTime=new Date(t),i.endTime=new Date(t),i.endTime.setMinutes(i.endTime.getMinutes()+s),t=new Date(i.endTime)}return i}));p(i)}}),[$,null===l||void 0===l?void 0:l.start_time]);const Z=()=>{if(0===g.length)return null!==l&&void 0!==l&&l.start_time?new Date(l.start_time):new Date;const e=[...g].sort(((e,s)=>(e.order||0)-(s.order||0))),s=e[e.length-1];return s.endTime?new Date(s.endTime):new Date((null===l||void 0===l?void 0:l.start_time)||Date.now())},L=()=>{const e=Z(),s=new Date(e),t=new Date(e);t.setMinutes(t.getMinutes()+30);const i={id:`item-${Date.now()}`,title:"New Agenda Item",description:"",startTime:s,endTime:t,type:"Activity",location:"",assignedRoles:[],isPublic:!0,order:g.length};j(i)},U=e=>{j(e)},B=()=>{if(null===l||void 0===l||!l.start_time||null===l||void 0===l||!l.end_time||0===g.length)return null;const e=g.reduce(((e,s)=>{if(s.startTime&&s.endTime){const t=new Date(s.startTime),i=new Date(s.endTime);return e+Math.round((i-t)/6e4)}return e}),0),s=new Date(l.start_time),t=new Date(l.end_time),i=Math.round((t-s)/6e4),n=e-i;return{agendaDuration:e,eventDuration:i,difference:n,isOver:n>0,isUnder:n<0,isExact:0===n}},z=()=>{if(null===l||void 0===l||!l._id||!o)return;if(0===g.length)return void h({title:"Error",message:"Cannot publish an empty agenda",type:"error"});const e=B();e&&!e.isExact?S(!0):H()},H=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(null!==l&&void 0!==l&&l._id&&o){k(!0);try{const s=e?{newEndTime:e}:{},t=await(0,m.Z)(`/org-event-management/${o}/events/${l._id}/agenda/publish`,s,{method:"POST"});if(!t.success)throw new Error(t.message||"Failed to publish agenda");y(!0),S(!1),c&&c(),h({title:"Success",message:e?"Agenda published and event time adjusted successfully":"Agenda published successfully",type:"success"})}catch(s){h({title:"Error",message:s.message||"Failed to publish agenda",type:"error"})}finally{k(!1)}}},W=(0,i.useCallback)((()=>{const e=q.current,s=(null===e||void 0===e?void 0:e.closest(".dashboard-overlay"))||(null===e||void 0===e?void 0:e.parentElement);if(!e||!s)return;const t=e.getBoundingClientRect(),i=s.getBoundingClientRect().top+60;F(t.bottom<i)}),[]);if((0,i.useEffect)((()=>{const e=q.current,s=(null===e||void 0===e?void 0:e.closest(".dashboard-overlay"))||(null===e||void 0===e?void 0:e.parentElement);if(!s)return;const t=()=>requestAnimationFrame(W);return W(),s.addEventListener("scroll",t,{passive:!0}),window.addEventListener("resize",t),()=>{s.removeEventListener("scroll",t),window.removeEventListener("resize",t)}}),[W,M]),M)return(0,u.jsxs)("div",{className:"agenda-builder loading",children:[(0,u.jsx)(n.JO,{icon:"mdi:loading",className:"spinner"}),(0,u.jsx)("p",{children:"Loading agenda..."})]});const G=B();return(0,u.jsxs)("div",{className:"agenda-builder",children:[(0,u.jsxs)("div",{ref:q,className:"agenda-header",children:[(0,u.jsxs)("div",{className:"header-left",children:[(0,u.jsxs)("h3",{children:[(0,u.jsx)(n.JO,{icon:"mdi:calendar-clock"}),"Event Agenda"]}),(0,u.jsxs)("div",{className:"header-meta",children:[(0,u.jsxs)("p",{children:[g.length," item",1!==g.length?"s":""]}),G&&!G.isExact&&(0,u.jsxs)("span",{className:"time-warning "+(G.isOver?"over":"under"),children:[(0,u.jsx)(n.JO,{icon:G.isOver?"mdi:alert-circle":"mdi:alert-circle-outline"}),G.isOver?`${Math.abs(G.difference)} min over`:`${Math.abs(G.difference)} min under`]}),N?(0,u.jsxs)("span",{className:"publish-status published",title:"Agenda is visible to attendees",children:[(0,u.jsx)(n.JO,{icon:"mdi:check-circle"}),"Published"]}):(0,u.jsxs)(u.Fragment,{children:[(0,u.jsxs)("span",{className:"publish-status saved",title:"Your changes are saved to the database",children:[(0,u.jsx)(n.JO,{icon:"mdi:content-save-check"}),"Saved"]}),(0,u.jsxs)("span",{className:"publish-status draft",title:"Not visible to attendees. Click Publish when ready.",children:[(0,u.jsx)(n.JO,{icon:"mdi:eye-off-outline"}),"Draft"]})]})]})]}),(0,u.jsxs)("div",{className:"header-actions",children:[(0,u.jsxs)("div",{className:"view-toggle",children:[(0,u.jsx)("label",{className:"view-label",children:"View:"}),(0,u.jsxs)("button",{className:"view-btn "+("creator"===I?"active":""),onClick:()=>E("creator"),title:"Creator View - Sequential list of items",children:[(0,u.jsx)(n.JO,{icon:"mdi:format-list-numbered"}),(0,u.jsx)("span",{children:"List"})]}),(0,u.jsxs)("button",{className:"view-btn "+("calendar"===I?"active":""),onClick:()=>E("calendar"),title:"Calendar View - Google-style timeline",children:[(0,u.jsx)(n.JO,{icon:"mdi:view-timeline"}),(0,u.jsx)("span",{children:"Calendar"})]})]}),(0,u.jsxs)("button",{className:"btn-primary",onClick:L,children:[(0,u.jsx)(n.JO,{icon:"mdi:plus"}),(0,u.jsx)("span",{children:"Add Item"})]}),!N&&g.length>0&&(0,u.jsxs)("button",{className:"btn-publish",onClick:z,disabled:w,title:"Make the agenda visible to attendees. Your changes are already saved.",children:[(0,u.jsx)(n.JO,{icon:w?"mdi:loading":"mdi:publish",className:w?"spinner":""}),(0,u.jsx)("span",{children:w?"Publishing...":"Publish"})]}),b&&(0,u.jsxs)("span",{className:"saving-indicator",children:[(0,u.jsx)(n.JO,{icon:"mdi:loading",className:"spinner"}),"Saving..."]})]})]}),J&&d&&(0,de.createPortal)((0,u.jsxs)("div",{className:"agenda-floating-actions",children:[(0,u.jsxs)("button",{className:"btn-primary",onClick:L,children:[(0,u.jsx)(n.JO,{icon:"mdi:plus"}),(0,u.jsx)("span",{children:"Add Item"})]}),!N&&g.length>0&&(0,u.jsxs)("button",{className:"btn-publish",onClick:z,disabled:w,children:[(0,u.jsx)(n.JO,{icon:w?"mdi:loading":"mdi:publish",className:w?"spinner":""}),(0,u.jsx)("span",{children:w?"Publishing...":"Publish"})]})]}),document.body),"calendar"===I?(0,u.jsxs)("div",{className:"agenda-calendar-wrapper",children:[(0,u.jsxs)("div",{className:"calendar-zoom-controls",children:[(0,u.jsx)("label",{className:"zoom-label",children:"Zoom:"}),pe.map((e=>(0,u.jsx)("button",{type:"button",className:"zoom-btn "+(R===e.id?"active":""),onClick:()=>A(e.id),title:`${e.label} (${e.value}px/min)`,children:e.label},e.id)))]}),(0,u.jsx)(V.Z,{agendaItems:g,event:l,minuteHeight:null!==(s=null===(t=pe.find((e=>e.id===R)))||void 0===t?void 0:t.value)&&void 0!==s?s:4,onEditItem:U})]}):0===g.length?(0,u.jsx)(ve.Z,{icon:"mdi:calendar-blank",title:"No agenda items yet",description:"Start building your event agenda by adding items.",actions:[{label:"Add first item",onClick:L,primary:!0}]}):(0,u.jsx)("div",{className:"agenda-items-container",children:[...g].sort(((e,s)=>(e.order||0)-(s.order||0))).map((e=>(0,u.jsx)(v,{item:e,onEdit:()=>U(e),onDelete:()=>{return s=e.id,O(s),void D(!0);var s}},e.id)))}),x&&(0,u.jsx)(me,{item:x,event:l,latestItemEnd:g.length>0?Z():null,onSave:async e=>{const{durationMinutes:s,...t}=e,i={...t};e.startTime&&(i.startTime=e.startTime instanceof Date?e.startTime:new Date(e.startTime)),e.endTime&&(i.endTime=e.endTime instanceof Date?e.endTime:new Date(e.endTime));const n=g.findIndex((e=>e.id===i.id));let a;n>=0?(a=[...g],a[n]={...i,order:a[n].order}):a=[...g,{...i,order:g.length}],p(a),j(null),await async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:g;if(null===l||void 0===l||!l._id||!o)return{success:!1,message:"Missing event ID or org ID"};f(!0);try{const s=e.map((e=>{const{durationMinutes:s,...t}=e,i={...t};return e.startTime&&(i.startTime="string"===typeof e.startTime?e.startTime:new Date(e.startTime).toISOString()),e.endTime&&(i.endTime="string"===typeof e.endTime?e.endTime:new Date(e.endTime).toISOString()),i})),t=await(0,m.Z)(`/org-event-management/${o}/events/${l._id}/agenda`,{items:s},{method:"POST"});if(t.success)return y(!1),c&&c(),{success:!0};throw new Error(t.message||"Failed to save agenda")}catch(s){return h({title:"Error",message:s.message||"Failed to save agenda",type:"error"}),{success:!1,message:s.message||"Failed to save agenda"}}finally{f(!1)}}(a)},onCancel:()=>j(null)}),C&&G&&(0,u.jsx)(ue,{event:l,orgId:o,timeDifference:G,onConfirm:e=>{H(e)},onCancel:()=>S(!1),onPublishWithoutAdjusting:()=>{H()}}),(0,u.jsx)(he.Z,{isOpen:_,onConfirm:async()=>{if(T&&null!==l&&void 0!==l&&l._id&&o)try{const e=await(0,m.Z)(`/org-event-management/${o}/events/${l._id}/agenda/items/${T}`,{},{method:"DELETE"});if(!e.success)throw new Error(e.message||"Failed to delete item");p(g.filter((e=>e.id!==T))),y(!1),c&&c(),h({title:"Success",message:"Agenda item deleted",type:"success"})}catch(e){h({title:"Error",message:e.message||"Failed to delete agenda item",type:"error"})}finally{D(!1),O(null)}},onCancel:()=>{D(!1),O(null)},title:"Delete Agenda Item",message:"Are you sure you want to delete this agenda item? This will remove the item from the agenda.",warningDetails:"This action cannot be undone."})]})};const je=function(e){let{roles:s,event:t}=e;if(!s||0===s.length||!t)return null;const i=e=>e?new Date(e).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"}):"TBD",a=s.filter((e=>e.shiftStart&&e.shiftEnd));return 0===a.length?(0,u.jsxs)("div",{className:"shift-scheduler",children:[(0,u.jsxs)("h4",{children:[(0,u.jsx)(n.JO,{icon:"mdi:calendar-clock"}),"Shift Schedule"]}),(0,u.jsx)("p",{className:"no-shifts",children:"Shift Scheduling Coming Soon."})]}):(0,u.jsxs)("div",{className:"shift-scheduler",children:[(0,u.jsxs)("h4",{children:[(0,u.jsx)(n.JO,{icon:"mdi:calendar-clock"}),"Shift Schedule"]}),(0,u.jsx)("div",{className:"shifts-timeline",children:a.map((e=>{var s;return(0,u.jsxs)("div",{className:"shift-item",children:[(0,u.jsxs)("div",{className:"shift-role",children:[(0,u.jsx)("strong",{children:e.name}),(0,u.jsxs)("span",{className:"shift-time",children:[i(e.shiftStart)," - ",i(e.shiftEnd)]})]}),(0,u.jsx)("div",{className:"shift-coverage",children:(0,u.jsxs)("span",{children:[(null===(s=e.assignments)||void 0===s?void 0:s.filter((e=>"confirmed"===e.status)).length)||0," / ",e.requiredCount]})})]},e._id)}))})]})};const be=function(e){let{orgRoles:s,roles:t,creatingJobTemplate:i,setCreatingJobTemplate:a,newJobTemplate:l,setNewJobTemplate:r,onCreateJobTemplate:o,onIncrementJob:c,onDecrementJob:d,onClose:m}=e;return(0,u.jsxs)(p.Z,{classN:"job-picker",icon:"mdi:briefcase",header:"Add Job Slots",right:(0,u.jsxs)("div",{className:"header-actions",children:[!i&&(0,u.jsxs)("button",{className:"btn-secondary",onClick:()=>a(!0),children:[(0,u.jsx)(n.JO,{icon:"mdi:plus"}),"New Template"]}),(0,u.jsx)("button",{className:"close-btn",onClick:m,type:"button","aria-label":"Close",children:(0,u.jsx)(n.JO,{icon:"mdi:close"})})]}),children:[i&&(0,u.jsxs)("div",{className:"job-template-form",children:[(0,u.jsxs)("div",{className:"form-group",children:[(0,u.jsx)("label",{children:"Template Name *"}),(0,u.jsx)("input",{type:"text",value:l.name,onChange:e=>r((s=>({...s,name:e.target.value}))),placeholder:"e.g., Registration, Ticketing"})]}),(0,u.jsxs)("div",{className:"form-group",children:[(0,u.jsx)("label",{children:"Description"}),(0,u.jsx)("textarea",{rows:2,value:l.description,onChange:e=>r((s=>({...s,description:e.target.value}))),placeholder:"Describe this job template"})]}),(0,u.jsxs)("div",{className:"form-actions",children:[(0,u.jsx)("button",{className:"btn-cancel",type:"button",onClick:()=>{a(!1),r({name:"",description:""})},children:"Cancel"}),(0,u.jsxs)("button",{className:"btn-save",onClick:o,disabled:!l.name.trim(),children:[(0,u.jsx)(n.JO,{icon:"mdi:check"}),"Create & Add Slot"]})]})]}),(0,u.jsxs)("div",{className:"job-picker-list",children:[0===s.length&&!i&&(0,u.jsx)(ve.Z,{icon:"mingcute:group-fill",title:"No job templates yet",description:"Create your first job template to add slots to this event.",actions:[{label:"New Template",onClick:()=>a(!0),primary:!0}]}),s.map((e=>{const s=t.find((s=>{var t;return((null===(t=s.orgRoleId)||void 0===t?void 0:t._id)||s.orgRoleId)===e._id})),i=(null===s||void 0===s?void 0:s.requiredCount)||0;return(0,u.jsxs)("div",{className:"job-picker-item",children:[(0,u.jsxs)("div",{className:"job-info",children:[(0,u.jsx)("strong",{children:e.name}),e.description&&(0,u.jsx)("p",{children:e.description})]}),(0,u.jsxs)("div",{className:"job-actions",children:[(0,u.jsx)("button",{className:"action-btn remove",onClick:()=>d(e),title:"Remove slot",disabled:i<=0,children:(0,u.jsx)(n.JO,{icon:"mdi:minus"})}),(0,u.jsx)("span",{className:"job-count",children:i}),(0,u.jsx)("button",{className:"action-btn add",onClick:()=>c(e),title:"Add slot",children:(0,u.jsx)(n.JO,{icon:"mdi:plus"})})]})]},e._id)}))]})]})};const fe=function(e){let{event:s,orgId:t,roles:a,onClose:l,onSuccess:o}=e;const{addNotification:c}=(0,r.l)(),[d,h]=(0,i.useState)(""),[v,g]=(0,i.useState)(""),[x,j]=(0,i.useState)(""),[b,f]=(0,i.useState)(!1),N=(null===a||void 0===a?void 0:a.filter((e=>{var s;return((null===(s=e.assignments)||void 0===s?void 0:s.filter((e=>"confirmed"===e.status)).length)||0)<e.requiredCount})))||[];return 0===N.length?(0,u.jsx)(p.Z,{classN:"volunteer-signup",icon:"mdi:account-plus",header:"Volunteer Signup",right:(0,u.jsx)("button",{className:"close-btn",onClick:l,type:"button","aria-label":"Close",children:(0,u.jsx)(n.JO,{icon:"mdi:close"})}),children:(0,u.jsxs)("div",{className:"no-roles-available",children:[(0,u.jsx)(n.JO,{icon:"mdi:information"}),(0,u.jsx)("p",{children:"No jobs available for signup. All jobs are fully staffed."})]})}):(0,u.jsx)(p.Z,{classN:"volunteer-signup",icon:"mdi:account-plus",header:"Volunteer Signup",right:(0,u.jsx)("button",{className:"close-btn",onClick:l,type:"button","aria-label":"Close",children:(0,u.jsx)(n.JO,{icon:"mdi:close"})}),children:(0,u.jsxs)("div",{className:"signup-form",children:[(0,u.jsxs)("div",{className:"form-group",children:[(0,u.jsxs)("label",{children:["Select Job ",(0,u.jsx)("span",{className:"required",children:"*"})]}),(0,u.jsxs)("select",{value:d,onChange:e=>h(e.target.value),required:!0,children:[(0,u.jsx)("option",{value:"",children:"Choose a job"}),N.map((e=>{var s;const t=(null===(s=e.assignments)||void 0===s?void 0:s.filter((e=>"confirmed"===e.status)).length)||0,i=e.requiredCount-t;return(0,u.jsxs)("option",{value:e._id,children:[e.name," (",i," spot",1!==i?"s":""," available)"]},e._id)}))]})]}),d&&(()=>{const e=N.find((e=>e._id===d));return!e||e.shiftStart&&e.shiftEnd?null:(0,u.jsxs)(u.Fragment,{children:[(0,u.jsxs)("div",{className:"form-group",children:[(0,u.jsx)("label",{children:"Shift Start (Optional)"}),(0,u.jsx)("input",{type:"datetime-local",value:v,onChange:e=>g(e.target.value)})]}),(0,u.jsxs)("div",{className:"form-group",children:[(0,u.jsx)("label",{children:"Shift End (Optional)"}),(0,u.jsx)("input",{type:"datetime-local",value:x,onChange:e=>j(e.target.value)})]})]})})(),(0,u.jsxs)("div",{className:"form-actions",children:[(0,u.jsx)("button",{type:"button",className:"btn-cancel",onClick:l,children:"Cancel"}),(0,u.jsx)("button",{type:"button",className:"btn-save",onClick:async()=>{if(d){if(null!==s&&void 0!==s&&s._id&&t){f(!0);try{const e=await(0,m.Z)(`/org-event-management/${t}/events/${s._id}/volunteer-signups`,{roleId:d,shiftStart:v||null,shiftEnd:x||null},{method:"POST"});if(!e.success)throw new Error(e.message||"Failed to sign up");c({title:"Success",message:"You have successfully signed up for this job",type:"success"}),o&&o(),l()}catch(e){c({title:"Error",message:e.message||"Failed to sign up for job",type:"error"})}finally{f(!1)}}}else c({title:"Error",message:"Please select a job",type:"error"})},disabled:!d||b,children:b?(0,u.jsxs)(u.Fragment,{children:[(0,u.jsx)(n.JO,{icon:"mdi:loading",className:"spinner"}),(0,u.jsx)("span",{children:"Signing Up..."})]}):(0,u.jsxs)(u.Fragment,{children:[(0,u.jsx)(n.JO,{icon:"mdi:check"}),(0,u.jsx)("span",{children:"Sign Up"})]})})]})]})})};var Ne=t(7768);const ye=function(e){var s,t,a;let{members:l,selectedMemberId:r,onMemberSelect:o,disabled:c,placeholder:d="Select member"}=e;const[m,h]=(0,i.useState)(!1),[v,g]=(0,i.useState)(!1),[p,x]=(0,i.useState)(!1),j=(0,i.useRef)(null),b=l.find((e=>{var s,t,i;return((null===(s=e.user_id)||void 0===s||null===(t=s._id)||void 0===t?void 0:t.toString())||(null===(i=e.user_id)||void 0===i?void 0:i.toString()))===r}));return(0,i.useEffect)((()=>{if(!m){g(!1);const e=setTimeout((()=>{x(!1)}),200);return()=>clearTimeout(e)}x(!0),g(!0)}),[m]),(0,i.useEffect)((()=>{const e=e=>{j.current&&!j.current.contains(e.target)&&h(!1)};return m&&document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}}),[m]),(0,u.jsxs)("div",{className:"member-dropdown",ref:j,onClick:e=>{c||(e.stopPropagation(),h(!m))},children:[b?(0,u.jsxs)(u.Fragment,{children:[(0,u.jsx)("img",{src:(null===(s=b.user_id)||void 0===s?void 0:s.picture)||Ne.Z,alt:(null===(t=b.user_id)||void 0===t?void 0:t.name)||"Member"}),(0,u.jsx)("h1",{children:(null===(a=b.user_id)||void 0===a?void 0:a.name)||"Unknown"})]}):(0,u.jsx)("h1",{children:d}),(0,u.jsx)(n.JO,{icon:""+(m?"ic:round-keyboard-arrow-up":"ic:round-keyboard-arrow-down"),width:"20",height:"20"}),p&&(0,u.jsx)("div",{className:"dropdown "+(v?"":"dropdown-exit"),onClick:e=>e.stopPropagation(),children:(0,u.jsx)("div",{className:"member-list",children:0===l.length?(0,u.jsx)("div",{className:"no-members",children:(0,u.jsx)("p",{children:"No members available"})}):l.map((e=>{var s,t,i,n,a,l;const c=(null===(s=e.user_id)||void 0===s||null===(t=s._id)||void 0===t?void 0:t.toString())||(null===(i=e.user_id)||void 0===i?void 0:i.toString()),d=c===r;return(0,u.jsxs)("div",{className:"drop-option "+(d?"selected":""),onClick:()=>(e=>{var s;const t=(null===(s=e.user_id)||void 0===s?void 0:s._id)||e.user_id;o&&o(t),h(!1)})(e),children:[(0,u.jsx)("img",{src:(null===(n=e.user_id)||void 0===n?void 0:n.picture)||Ne.Z,alt:(null===(a=e.user_id)||void 0===a?void 0:a.name)||"Member"}),(0,u.jsxs)("div",{className:"member-info",children:[(0,u.jsx)("p",{children:(null===(l=e.user_id)||void 0===l?void 0:l.name)||"Unknown"}),e.role&&(0,u.jsx)("span",{className:"member-role",children:e.role})]})]},c)}))})})]})};const we=function(e){let{event:s,orgId:t,onRefresh:l}=e;const{addNotification:o}=(0,r.l)(),[c,h]=(0,i.useState)(null),[v,g]=(0,i.useState)([]),[p,x]=(0,i.useState)([]),[j,b]=(0,i.useState)([]),[f,N]=(0,i.useState)(!1),[y,w]=(0,i.useState)(!1),[k,C]=(0,i.useState)(!1),[S,_]=(0,i.useState)({name:"",description:""}),[D,T]=(0,i.useState)(!0),[O,I]=(0,i.useState)({}),[E,R]=(0,i.useState)(!1),[A,J]=(0,i.useState)(null),[F,q]=(0,i.useState)(!1),[$,M]=(0,i.useState)(null),{data:P,refetch:Z}=(0,a.i)(null!==s&&void 0!==s&&s._id&&t?`/org-event-management/${t}/events/${s._id}/roles`:null),{data:L,refetch:U}=(0,a.i)(null!==s&&void 0!==s&&s._id&&t?`/org-event-management/${t}/events/${s._id}/volunteer-signups`:null),{data:V}=(0,a.i)(t?`/org-event-management/${t}/event-roles`:null),{data:B}=(0,a.i)(t?`/org-roles/${t}/members`:null),z=(null===B||void 0===B?void 0:B.members)||[];(0,i.useEffect)((()=>{null!==P&&void 0!==P&&P.success&&(g(P.data.roles||[]),T(!1))}),[P]),(0,i.useEffect)((()=>{null!==L&&void 0!==L&&L.success&&x(L.data.signups||[])}),[L]),(0,i.useEffect)((()=>{null!==V&&void 0!==V&&V.success&&b(V.data.roles||[])}),[V]);const H=()=>{w(!1),C(!1),_({name:"",description:""})},W=async e=>{if(null===s||void 0===s||!s._id||!t)return;const i=v.find((s=>{var t;return((null===(t=s.orgRoleId)||void 0===t?void 0:t._id)||s.orgRoleId)===e._id}));try{let n;if(n=i?await(0,m.Z)(`/org-event-management/${t}/events/${s._id}/roles/${i._id}`,{requiredCount:(i.requiredCount||0)+1},{method:"PUT"}):await(0,m.Z)(`/org-event-management/${t}/events/${s._id}/roles`,{orgRoleId:e._id,requiredCount:1},{method:"POST"}),!n.success)throw new Error(n.message||"Failed to update job count");Z(),l&&l()}catch(n){o({title:"Error",message:n.message||"Failed to update job count",type:"error"})}};return D?(0,u.jsxs)("div",{className:"roles-manager loading",children:[(0,u.jsx)(n.JO,{icon:"mdi:loading",className:"spinner"}),(0,u.jsx)("p",{children:"Loading jobs..."})]}):(0,u.jsxs)("div",{className:"roles-manager",children:[(0,u.jsxs)("div",{className:"roles-header",children:[(0,u.jsxs)("div",{className:"header-left",children:[(0,u.jsxs)("h3",{children:[(0,u.jsx)(n.JO,{icon:"mdi:account-group"}),"Event Jobs & Assignments"]}),(0,u.jsxs)("p",{children:[v.length," job",1!==v.length?"s":""," defined"]})]}),(0,u.jsxs)("div",{className:"header-actions",children:[(0,u.jsxs)("button",{className:"btn-secondary",onClick:()=>N(!0),children:[(0,u.jsx)(n.JO,{icon:"mdi:account-plus"}),(0,u.jsx)("span",{children:"Volunteer Signup"})]}),(0,u.jsxs)("button",{className:"btn-primary",onClick:()=>{w(!0)},children:[(0,u.jsx)(n.JO,{icon:"mdi:plus"}),(0,u.jsx)("span",{children:"Add Job Slots"})]})]})]}),0===v.length?(0,u.jsx)(ve.Z,{icon:"mingcute:group-fill",title:"No event jobs assigned yet",description:"Add event jobs to keep everyone organized."}):(0,u.jsx)("div",{className:"roles-list",children:v.map((e=>{var i,a;const r=(null===(i=e.assignments)||void 0===i?void 0:i.filter((e=>"confirmed"===e.status)).length)||0,d=r>=e.requiredCount;return(0,u.jsxs)("div",{className:"role-card "+(d?"fully-staffed":""),children:[(0,u.jsxs)("div",{className:"role-header",children:[(0,u.jsxs)("div",{className:"role-info",children:[(0,u.jsx)("h4",{children:e.name}),e.description&&(0,u.jsx)("p",{children:e.description})]}),(0,u.jsx)("div",{className:"role-actions",children:(0,u.jsx)("button",{className:"action-btn delete",onClick:()=>{return s=e._id,J(s),void R(!0);var s},title:"Delete Job",children:(0,u.jsx)(n.JO,{icon:"mdi:delete"})})})]}),e.shiftStart&&e.shiftEnd&&(0,u.jsx)("div",{className:"role-stats",children:(0,u.jsxs)("div",{className:"stat-item",children:[(0,u.jsx)(n.JO,{icon:"mdi:clock-outline"}),(0,u.jsxs)("span",{children:[new Date(e.shiftStart).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"})," -",new Date(e.shiftEnd).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"})]})]})}),(0,u.jsxs)("div",{className:"role-assignments",children:[(0,u.jsxs)("div",{className:"assignments-header",children:[(0,u.jsxs)("h5",{children:["Assignments (",r," / ",e.requiredCount,")"]}),!d&&(0,u.jsx)("div",{className:"member-selector",children:(0,u.jsx)(ye,{members:z.filter((s=>{var t;const i=s.user_id._id.toString();return!(null!==(t=e.assignments)&&void 0!==t&&t.some((e=>{var s,t,n;return((null===(s=e.memberId)||void 0===s||null===(t=s._id)||void 0===t?void 0:t.toString())||(null===(n=e.memberId)||void 0===n?void 0:n.toString()))===i})))})),onMemberSelect:i=>{i&&(async(e,i)=>{var n;if(!i||null===s||void 0===s||!s._id||!t||null===e||void 0===e||!e._id)return;if(null===(n=e.assignments)||void 0===n?void 0:n.some((e=>{var s,t,n;return(null===(s=e.memberId)||void 0===s||null===(t=s._id)||void 0===t?void 0:t.toString())===i||(null===(n=e.memberId)||void 0===n?void 0:n.toString())===i})))o({title:"Already Assigned",message:"This member is already assigned to this job",type:"warning"});else{I((s=>({...s,[e._id]:!0})));try{const n=await(0,m.Z)(`/org-event-management/${t}/events/${s._id}/assignments`,{roleId:e._id,memberId:i,status:"confirmed"},{method:"POST"});if(!n.success)throw new Error(n.message||"Failed to assign member");Z(),l&&l(),o({title:"Success",message:"Member assigned successfully",type:"success"})}catch(a){o({title:"Error",message:a.message||"Failed to assign member",type:"error"})}finally{I((s=>({...s,[e._id]:!1})))}}})(e,i)},disabled:O[e._id],placeholder:"Select member"})}),d&&(0,u.jsxs)("span",{className:"fully-staffed-badge",children:[(0,u.jsx)(n.JO,{icon:"mdi:check-circle"}),"Fully Staffed"]})]}),(0,u.jsxs)("div",{className:"assignments-list",children:[null===(a=e.assignments)||void 0===a?void 0:a.filter((e=>"confirmed"===e.status)).map(((s,t)=>{var i,a;return(0,u.jsxs)("div",{className:"assignment-item",children:[(0,u.jsxs)("div",{className:"member-info",children:[(0,u.jsx)("span",{className:"member-name",children:(null===(i=s.memberId)||void 0===i?void 0:i.name)||"Unknown"}),(null===(a=s.memberId)||void 0===a?void 0:a.email)&&(0,u.jsxs)("span",{className:"member-email clickable",onClick:()=>(async e=>{try{await navigator.clipboard.writeText(e),h(e),o({title:"Copied",message:"Email copied to clipboard",type:"success"}),setTimeout((()=>h(null)),2e3)}catch(s){o({title:"Error",message:"Failed to copy email",type:"error"})}})(s.memberId.email),title:"Click to copy email",children:[s.memberId.email,(0,u.jsx)(n.JO,{icon:c===s.memberId.email?"mdi:check":"mdi:content-copy",className:"copy-icon"})]})]}),(0,u.jsxs)("div",{className:"assignment-actions",children:[(0,u.jsx)("span",{className:`status-badge ${s.status||"confirmed"}`,children:s.status||"confirmed"}),(0,u.jsx)("button",{className:"remove-assignment-btn",onClick:()=>((e,s)=>{var t,i;const n=null===(t=e.assignments)||void 0===t?void 0:t.find((e=>e._id===s)),a=(null===n||void 0===n||null===(i=n.memberId)||void 0===i?void 0:i.name)||"this member";M({role:e,assignmentId:s,memberName:a}),q(!0)})(e,s._id),title:"Remove member",disabled:O[e._id],children:(0,u.jsx)(n.JO,{icon:"mdi:close"})})]})]},`assigned-${t}`)})),Array.from({length:Math.max(0,e.requiredCount-r)}).map(((e,s)=>(0,u.jsx)("div",{className:"assignment-item placeholder-slot",children:(0,u.jsxs)("div",{className:"member-info",children:[(0,u.jsx)(n.JO,{icon:"mdi:account-outline",className:"placeholder-icon"}),(0,u.jsx)("span",{className:"placeholder-text",children:"Open slot"})]})},`placeholder-${s}`)))]})]})]},e._id)}))}),(0,u.jsx)(je,{roles:v,event:s}),(0,u.jsx)(d.Z,{isOpen:y,onClose:H,customClassName:"job-picker-popup medium-content",defaultStyling:!1,hideCloseButton:!0,children:(0,u.jsx)(be,{orgRoles:j,roles:v,creatingJobTemplate:k,setCreatingJobTemplate:C,newJobTemplate:S,setNewJobTemplate:_,onCreateJobTemplate:async()=>{if(t&&S.name.trim())try{var e;const s=await(0,m.Z)(`/org-event-management/${t}/event-roles`,{name:S.name.trim(),description:S.description.trim()},{method:"POST"});if(!s.success)throw new Error(s.message||"Failed to create job template");const i=null===(e=s.data)||void 0===e?void 0:e.role;i&&(b((e=>[...e,i].sort(((e,s)=>e.name.localeCompare(s.name))))),_({name:"",description:""}),C(!1),await W(i))}catch(s){o({title:"Error",message:s.message||"Failed to create job template",type:"error"})}},onIncrementJob:W,onDecrementJob:async e=>{if(null===s||void 0===s||!s._id||!t)return;const i=v.find((s=>{var t;return((null===(t=s.orgRoleId)||void 0===t?void 0:t._id)||s.orgRoleId)===e._id}));if(i&&i.requiredCount)try{if(i.requiredCount<=1){const e=await(0,m.Z)(`/org-event-management/${t}/events/${s._id}/roles/${i._id}`,{},{method:"DELETE"});if(!e.success)throw new Error(e.message||"Failed to remove job")}else{const e=await(0,m.Z)(`/org-event-management/${t}/events/${s._id}/roles/${i._id}`,{requiredCount:i.requiredCount-1},{method:"PUT"});if(!e.success)throw new Error(e.message||"Failed to update job count")}Z(),l&&l()}catch(n){o({title:"Error",message:n.message||"Failed to update job count",type:"error"})}},onClose:H})}),(0,u.jsx)(d.Z,{isOpen:f,onClose:()=>N(!1),customClassName:"volunteer-signup-popup medium-content",defaultStyling:!1,hideCloseButton:!0,children:(0,u.jsx)(fe,{event:s,orgId:t,roles:v,onClose:()=>N(!1),onSuccess:()=>{U(),Z(),l&&l()}})}),(0,u.jsx)(he.Z,{isOpen:E,onConfirm:async()=>{if(A&&null!==s&&void 0!==s&&s._id&&t)try{const e=await(0,m.Z)(`/org-event-management/${t}/events/${s._id}/roles/${A}`,{},{method:"DELETE"});if(!e.success)throw new Error(e.message||"Failed to delete job");g(v.filter((e=>e._id!==A))),Z(),l&&l(),o({title:"Success",message:"Job deleted successfully",type:"success"})}catch(e){o({title:"Error",message:e.message||"Failed to delete job",type:"error"})}finally{R(!1),J(null)}},onCancel:()=>{R(!1),J(null)},title:"Delete Job",message:"Are you sure you want to delete this job? All assignments will be removed.",warningDetails:"All assigned members will be removed from this job."}),(0,u.jsx)(he.Z,{isOpen:F,onConfirm:async()=>{var e;if(!$||null===s||void 0===s||!s._id||!t||null===(e=$.role)||void 0===e||!e._id||!$.assignmentId)return;const{role:i,assignmentId:n}=$;I((e=>({...e,[i._id]:!0})));try{const e=await(0,m.Z)(`/org-event-management/${t}/events/${s._id}/assignments/${n}`,{},{method:"DELETE"});if(!e.success)throw new Error(e.message||"Failed to remove member");Z(),l&&l(),o({title:"Success",message:"Member removed successfully",type:"success"})}catch(a){o({title:"Error",message:a.message||"Failed to remove member",type:"error"})}finally{I((e=>({...e,[i._id]:!1}))),q(!1),M(null)}},onCancel:()=>{q(!1),M(null)},title:"Remove Assignment",message:`Are you sure you want to remove ${(null===$||void 0===$?void 0:$.memberName)||"this member"} from this job?`,warningDetails:"The member will be unassigned from this job slot.",confirmLabel:"Remove"})]})};const ke=function(e){let{event:s,orgId:t,onRefresh:l}=e;const{addNotification:o}=(0,r.l)(),[c,d]=(0,i.useState)(null),[m,h]=(0,i.useState)(!0),[v,g]=(0,i.useState)(!1),[x,j]=(0,i.useState)("30d"),{data:b,refetch:f}=(0,a.i)(null!==s&&void 0!==s&&s._id?`/event-analytics/event/${s._id}?timeRange=${x}`:null);(0,i.useEffect)((()=>{null!==b&&void 0!==b&&b.success?(d(b.data),h(!1)):b&&!b.success&&h(!1)}),[b]),(0,i.useEffect)((()=>{h(!0)}),[x]),(0,i.useEffect)((()=>{const e=setInterval((()=>{f()}),3e4);return()=>clearInterval(e)}),[f,x]);const N=e=>(new Intl.NumberFormat).format(e),y=(null===c||void 0===c?void 0:c.platform)||{},w=(0,i.useMemo)((()=>{var e,t,i,n,a;const l=(null!==(e=null===c||void 0===c?void 0:c.views)&&void 0!==e?e:0)+(null!==(t=null===c||void 0===c?void 0:c.anonymousViews)&&void 0!==t?t:0),r=null!==(i=null!==(n=null===c||void 0===c?void 0:c.registrations)&&void 0!==n?n:null===c||void 0===c||null===(a=c.registrationHistory)||void 0===a?void 0:a.length)&&void 0!==i?i:0,o=[{label:"Views",value:l}];return null!==s&&void 0!==s&&s.registrationFormId&&o.push({label:"Form Opens",value:y.registrationFormOpens||0}),o.push({label:"Registrations",value:r},{label:"Check-ins",value:y.checkins||0}),o}),[c,y.registrationFormOpens,y.checkins,null===s||void 0===s?void 0:s.registrationFormId]);if(m)return(0,u.jsxs)("div",{className:"event-analytics-detail loading",children:[(0,u.jsx)(n.JO,{icon:"mdi:loading",className:"spinner"}),(0,u.jsx)("p",{children:"Loading analytics..."})]});if(!c)return(0,u.jsxs)("div",{className:"event-analytics-detail error",children:[(0,u.jsx)(n.JO,{icon:"mdi:alert-circle"}),(0,u.jsx)("p",{children:"Failed to load analytics"})]});const k=c,C=k.registrationHistory||[],_=k.registrations||C.length||0,D=k.viewHistory||[],T=D.filter((e=>!e.isAnonymous&&e.userId)),O=T.length+D.filter((e=>e.isAnonymous)).length,I=k.views||0,E=k.anonymousViews||0,R=I+E,A=O>0?_/O*100:k.engagementRate||0,J=k.uniqueViews||0,F=k.uniqueRegistrations||0,q=J>0?(F/J*100).toFixed(1):0,$=J>0?(R/J).toFixed(1):0,M=new Date,P=new Date(M.getTime()-864e5),Z=D.filter((e=>new Date(e.timestamp)>=P)).length,L=C.filter((e=>new Date(e.timestamp)>=P)).length,U=y.tabViews||{},V=Object.entries(U).sort(((e,s)=>s[1]-e[1]));return(0,u.jsxs)("div",{className:"event-analytics-detail",children:[(0,u.jsxs)("div",{className:"analytics-header",children:[(0,u.jsxs)("h3",{children:[(0,u.jsx)(n.JO,{icon:"mingcute:chart-fill"}),"Event Analytics"]}),(0,u.jsxs)("div",{className:"analytics-header-controls",children:[(0,u.jsx)("div",{className:"time-range-selector",children:(0,u.jsxs)("select",{value:x,onChange:e=>j(e.target.value),children:[(0,u.jsx)("option",{value:"7d",children:"Last 7 days"}),(0,u.jsx)("option",{value:"30d",children:"Last 30 days"}),(0,u.jsx)("option",{value:"90d",children:"Last 90 days"})]})}),(0,u.jsxs)("div",{className:"live-indicator",children:[(0,u.jsx)("span",{className:"live-dot"}),(0,u.jsx)("span",{children:"Live"})]})]})]}),(R>0||_>0||y.checkins>0||y.registrationFormOpens>0)&&(0,u.jsx)(p.Z,{icon:"mingcute:chart-bar-fill",header:"Engagement Funnel",classN:"analytics-card funnel-section",size:"1rem",children:(0,u.jsxs)("div",{className:"card-content funnel-chart-container",children:[(0,u.jsx)("div",{className:"funnel-chart-wrapper",children:(0,u.jsx)(S,{data:w})}),(y.withdrawals>0||y.checkouts>0||y.registrationFormBounces>0)&&(0,u.jsxs)("div",{className:"funnel-secondary",children:[y.registrationFormBounces>0&&(0,u.jsxs)("span",{className:"funnel-secondary-item funnel-bounces",children:[N(y.registrationFormBounces)," opened form but did not register"]}),y.withdrawals>0&&(0,u.jsxs)("span",{className:"funnel-secondary-item",children:[N(y.withdrawals)," withdrawals"]}),y.checkouts>0&&(0,u.jsxs)("span",{className:"funnel-secondary-item",children:[N(y.checkouts)," check-outs"]})]})]})}),(0,u.jsxs)("div",{className:"analytics-grid",children:[(0,u.jsx)(p.Z,{icon:"mdi:eye",header:"Views",classN:"analytics-card",size:"1rem",children:(0,u.jsx)("div",{className:"card-content",children:(0,u.jsxs)("div",{className:"views-grid",children:[(0,u.jsxs)("div",{className:"views-squares-wrapper",children:[(0,u.jsx)("div",{className:"view-square-wrapper",children:(0,u.jsx)("div",{className:"view-square",children:(0,u.jsxs)("div",{className:"view-square-content",children:[(0,u.jsx)("span",{className:"view-value",children:N(I)}),(0,u.jsx)("span",{className:"view-label",children:"Logged-in"}),(0,u.jsxs)("span",{className:"view-subtitle",children:[N(k.uniqueViews||0)," unique"]})]})})}),(0,u.jsx)("div",{className:"view-square-wrapper",children:(0,u.jsx)("div",{className:"view-square",children:(0,u.jsxs)("div",{className:"view-square-content",children:[(0,u.jsx)("span",{className:"view-value",children:N(E)}),(0,u.jsx)("span",{className:"view-label",children:"Anonymous"}),(0,u.jsxs)("span",{className:"view-subtitle",children:[N(k.uniqueAnonymousViews||0)," unique"]})]})})})]}),(0,u.jsx)("div",{className:"view-total-wrapper",children:(0,u.jsx)("div",{className:"view-total",children:(0,u.jsxs)("div",{className:"view-total-content",children:[(0,u.jsx)("span",{className:"view-value",children:N(R)}),(0,u.jsx)("span",{className:"view-label",children:"Total Views"})]})})})]})})}),(0,u.jsx)(p.Z,{icon:"mingcute:trending-up-fill",header:"Engagement",classN:"analytics-card",size:"1rem",children:(0,u.jsxs)("div",{className:"card-content",children:[(0,u.jsxs)("div",{className:"stat-large",children:[(0,u.jsxs)("span",{className:"stat-value",children:[A.toFixed(1),"%"]}),(0,u.jsx)("span",{className:"stat-label",children:"Engagement Rate"})]}),(0,u.jsx)("div",{className:"engagement-bar-container",children:(0,u.jsx)("div",{className:"engagement-bar",children:(0,u.jsx)("div",{className:"engagement-fill",style:{width:`${Math.min(A,100)}%`}})})}),(0,u.jsx)("div",{className:"rsvp-segments-display",children:(0,u.jsxs)("div",{className:"rsvp-segment-item going",children:[(0,u.jsx)("span",{className:"segment-number",children:_}),(0,u.jsx)("span",{className:"segment-label",children:"Registrations"})]})})]})}),(0,u.jsx)(p.Z,{icon:"mingcute:chart-line-fill",header:"Conversion & Activity",classN:"analytics-card",size:"1rem",children:(0,u.jsxs)("div",{className:"card-content",children:[(0,u.jsxs)("div",{className:"conversion-metrics",children:[(0,u.jsxs)("div",{className:"conversion-item",children:[(0,u.jsxs)("div",{className:"conversion-value",children:[q,"%"]}),(0,u.jsx)("div",{className:"conversion-label",children:"View-to-Registration"}),(0,u.jsx)("div",{className:"conversion-subtitle",children:"Unique conversion rate"})]}),(0,u.jsxs)("div",{className:"conversion-item",children:[(0,u.jsx)("div",{className:"conversion-value",children:_}),(0,u.jsx)("div",{className:"conversion-label",children:"Registrations"}),(0,u.jsx)("div",{className:"conversion-subtitle",children:"Total registered"})]}),(0,u.jsxs)("div",{className:"conversion-item",children:[(0,u.jsx)("div",{className:"conversion-value",children:$}),(0,u.jsx)("div",{className:"conversion-label",children:"Avg Views/User"}),(0,u.jsx)("div",{className:"conversion-subtitle",children:"Per unique viewer"})]}),(0,u.jsxs)("div",{className:"conversion-item",children:[(0,u.jsx)("div",{className:"conversion-value",children:N(y.agendaViews||0)}),(0,u.jsx)("div",{className:"conversion-label",children:"Agenda Opens"}),(0,u.jsx)("div",{className:"conversion-subtitle",children:"Times agenda modal was viewed"})]})]}),(0,u.jsxs)("div",{className:"recent-activity",children:[(0,u.jsxs)("div",{className:"activity-header",children:[(0,u.jsx)(n.JO,{icon:"mdi:clock-outline"}),(0,u.jsx)("span",{children:"Last 24 Hours"})]}),(0,u.jsxs)("div",{className:"activity-stats",children:[(0,u.jsxs)("div",{className:"activity-stat",children:[(0,u.jsx)("span",{className:"activity-value",children:Z}),(0,u.jsx)("span",{className:"activity-label",children:"Views"})]}),(0,u.jsxs)("div",{className:"activity-stat",children:[(0,u.jsx)("span",{className:"activity-value",children:L}),(0,u.jsx)("span",{className:"activity-label",children:"Registrations"})]})]})]})]})})]}),y.registrationFormOpens>0&&(0,u.jsx)(p.Z,{icon:"mdi:form-select",header:"Registration Form",classN:"analytics-card registration-form-section",size:"1rem",children:(0,u.jsx)("div",{className:"card-content",children:(0,u.jsxs)("div",{className:"registration-form-metrics",children:[(0,u.jsxs)("div",{className:"form-metric",children:[(0,u.jsx)("span",{className:"form-metric-value",children:N(y.registrationFormOpens)}),(0,u.jsx)("span",{className:"form-metric-label",children:"Form Opens"})]}),(0,u.jsxs)("div",{className:"form-metric",children:[(0,u.jsxs)("span",{className:"form-metric-value",children:[y.registrationFormOpens>0?(_/y.registrationFormOpens*100).toFixed(1):0,"%"]}),(0,u.jsx)("span",{className:"form-metric-label",children:"Form Conversion"})]}),(0,u.jsxs)("div",{className:"form-metric form-metric-bounces",children:[(0,u.jsx)("span",{className:"form-metric-value",children:N(y.registrationFormBounces||0)}),(0,u.jsx)("span",{className:"form-metric-label",children:"Opened but did not register"})]})]})})}),V.length>0&&(0,u.jsx)(p.Z,{icon:"mdi:tab",header:"Workspace Tab Engagement",classN:"analytics-card tab-breakdown-section",size:"1rem",children:(0,u.jsx)("div",{className:"card-content",children:(0,u.jsx)("div",{className:"tab-breakdown-list",children:V.map((e=>{let[s,t]=e;return(0,u.jsxs)("div",{className:"tab-breakdown-item",children:[(0,u.jsx)("span",{className:"tab-name",children:s}),(0,u.jsx)("span",{className:"tab-count",children:N(t)})]},s)}))})})}),T.length>0&&(0,u.jsx)(p.Z,{icon:"mingcute:eye-fill",header:"Logged-in Views",classN:"logged-in-views-section",size:"1.25rem",children:(0,u.jsxs)("div",{className:"logged-in-views-list",children:[T.slice(0,20).map(((e,s)=>{return(0,u.jsxs)("div",{className:"history-item",children:[(0,u.jsx)("div",{className:"history-icon",children:(0,u.jsx)(n.JO,{icon:"mingcute:eye-fill"})}),(0,u.jsxs)("div",{className:"history-content",children:[(0,u.jsx)("p",{className:"history-time",children:(t=e.timestamp,new Date(t).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}))}),(0,u.jsx)("p",{className:"history-detail",children:"User viewed this event"})]})]},s);var t})),T.length>20&&(0,u.jsx)("div",{className:"views-more",children:(0,u.jsxs)("span",{children:["+",T.length-20," more views"]})})]})})]})};const Ce=function(e){let{qrCode:s,eventName:t}=e;const[a,l]=(0,i.useState)(!1);return(0,u.jsxs)("div",{className:"qr-code-display",children:[(0,u.jsx)("div",{className:"qr-code-image-container",children:(0,u.jsx)("img",{src:s,alt:"Check-in QR Code",className:"qr-code-image"})}),(0,u.jsxs)("div",{className:"qr-code-actions",children:[(0,u.jsxs)("button",{className:"action-button",onClick:()=>{const e=document.createElement("a");e.href=s,e.download=`${t||"event"}-checkin-qr.png`,document.body.appendChild(e),e.click(),document.body.removeChild(e)},children:[(0,u.jsx)(n.JO,{icon:"mingcute:download-fill"}),"Download"]}),(0,u.jsxs)("button",{className:"action-button",onClick:async()=>{if(navigator.share)try{await navigator.share({title:`Check-in QR Code - ${t}`,text:`Scan this QR code to check in to ${t}`,files:[await fetch(s).then((e=>e.blob()))]})}catch(e){"AbortError"!==e.name&&console.error("Error sharing QR code:",e)}else try{const e=await fetch(s),t=await e.blob();await navigator.clipboard.write([new ClipboardItem({"image/png":t})]),l(!0),setTimeout((()=>l(!1)),2e3)}catch(e){console.error("Error copying QR code:",e)}},children:[(0,u.jsx)(n.JO,{icon:a?"mdi:check":"mingcute:share-forward-fill"}),a?"Copied!":"Share"]})]})]})};const Se=function(e){let{checkInUrl:s,eventName:t}=e;const[a,l]=(0,i.useState)(!1),r=async()=>{try{await navigator.clipboard.writeText(s),l(!0),setTimeout((()=>l(!1)),2e3)}catch(e){console.error("Error copying link:",e);const t=document.createElement("textarea");t.value=s,document.body.appendChild(t),t.select(),document.execCommand("copy"),document.body.removeChild(t),l(!0),setTimeout((()=>l(!1)),2e3)}};return(0,u.jsxs)("div",{className:"checkin-link-display",children:[(0,u.jsx)("div",{className:"link-container",children:(0,u.jsx)("input",{type:"text",value:s,readOnly:!0,className:"link-input",onClick:e=>e.target.select()})}),(0,u.jsxs)("div",{className:"link-actions",children:[(0,u.jsxs)("button",{className:"action-button",onClick:r,children:[(0,u.jsx)(n.JO,{icon:a?"mdi:check":"mdi:content-copy"}),a?"Copied!":"Copy"]}),(0,u.jsxs)("button",{className:"action-button",onClick:async()=>{if(navigator.share)try{await navigator.share({title:`Check-in Link - ${t}`,text:`Check in to ${t}`,url:s})}catch(e){"AbortError"!==e.name&&console.error("Error sharing link:",e)}else r()},children:[(0,u.jsx)(n.JO,{icon:"mdi:share"}),"Share"]})]})]})};var _e=t(63130);const De=function(e){let{attendees:s,onManualCheckIn:t,onRemoveCheckIn:a,onOpenManualCheckInModal:l}=e;const[r,o]=(0,i.useState)(""),[c,d]=(0,i.useState)("all"),m=(0,i.useMemo)((()=>{let e=s;if(r){const s=r.toLowerCase();e=e.filter((e=>{const t=e.userId;return((null===t||void 0===t?void 0:t.name)||(null===t||void 0===t?void 0:t.username)||"Unknown").toLowerCase().includes(s)}))}return"self"===c?e=e.filter((e=>!e.checkedInBy)):"manual"===c&&(e=e.filter((e=>e.checkedInBy))),e}),[s,r,c]),h=e=>{if(!e)return"Unknown";try{return(0,_e.Q)(new Date(e),{addSuffix:!0})}catch(s){return"Unknown"}},v=e=>{const s=e.userId;return(null===s||void 0===s?void 0:s.name)||(null===s||void 0===s?void 0:s.username)||"Unknown User"},g=e=>{const s=e.userId;return(null===s||void 0===s?void 0:s.picture)||null};return 0===s.length?(0,u.jsxs)("div",{className:"checkin-list-empty",children:[(0,u.jsx)(n.JO,{icon:"mdi:account-off"}),(0,u.jsx)("p",{children:"No attendees have checked in yet."})]}):(0,u.jsxs)("div",{className:"checkin-list",children:[(0,u.jsxs)("div",{className:"checkin-list-controls",children:[(0,u.jsxs)("div",{className:"search-input-wrapper",children:[(0,u.jsx)(n.JO,{icon:"mdi:magnify",className:"search-icon"}),(0,u.jsx)("input",{type:"text",placeholder:"Search attendees...",value:r,onChange:e=>o(e.target.value),className:"search-input"})]}),(0,u.jsxs)("div",{className:"filter-buttons",children:[(0,u.jsx)("button",{className:"filter-button "+("all"===c?"active":""),onClick:()=>d("all"),children:"All"}),(0,u.jsx)("button",{className:"filter-button "+("self"===c?"active":""),onClick:()=>d("self"),children:"Self Check-In"}),(0,u.jsx)("button",{className:"filter-button "+("manual"===c?"active":""),onClick:()=>d("manual"),children:"Manual"})]})]}),(0,u.jsx)("div",{className:"attendees-list",children:0===m.length?(0,u.jsxs)("div",{className:"checkin-list-empty",children:[(0,u.jsx)(n.JO,{icon:"mdi:magnify"}),(0,u.jsx)("p",{children:"No attendees match your search."})]}):m.map(((e,s)=>{const t=e.userId,i=e.checkedInBy,l=!!i,r=t&&(t._id||t.id)?String(t._id||t.id):null;return(0,u.jsxs)("div",{className:"attendee-item",children:[(0,u.jsxs)("div",{className:"attendee-info",children:[(0,u.jsx)("div",{className:"attendee-avatar",children:g(e)?(0,u.jsx)("img",{src:g(e),alt:v(e)}):(0,u.jsx)(n.JO,{icon:"mdi:account-circle"})}),(0,u.jsxs)("div",{className:"attendee-details",children:[(0,u.jsx)("div",{className:"attendee-name",children:v(e)}),(0,u.jsxs)("div",{className:"attendee-meta",children:[(0,u.jsxs)("span",{className:"checkin-time",children:[(0,u.jsx)(n.JO,{icon:"mdi:clock-outline"}),h(e.checkedInAt)]}),(0,u.jsxs)("span",{className:"checkin-method "+(l?"manual":"self"),children:[(0,u.jsx)(n.JO,{icon:l?"mdi:account-check":"mdi:qrcode-scan"}),l?"Manual":"Self Check-In"]})]})]})]}),(0,u.jsxs)("div",{className:"attendee-actions",children:[l&&i&&(0,u.jsxs)("div",{className:"checked-in-by",children:["Checked in by ",(null===i||void 0===i?void 0:i.name)||(null===i||void 0===i?void 0:i.username)||"Organizer"]}),a&&r&&(0,u.jsxs)("button",{type:"button",className:"remove-checkin-btn",onClick:()=>a(r),title:"Remove check-in",children:[(0,u.jsx)(n.JO,{icon:"mdi:logout"}),"Remove"]})]})]},s)}))}),t&&l&&(0,u.jsx)("div",{className:"manual-checkin-section",children:(0,u.jsxs)("button",{type:"button",className:"manual-checkin-button",onClick:l,children:[(0,u.jsx)(n.JO,{icon:"mdi:account-plus"}),"Manually Check In Attendee"]})})]})};var Te=t(691);const Oe=function(e){var s,t,a,l;let{isOpen:o,onClose:c,event:h,orgId:v,onSaved:g,color:p}=e;const{addNotification:x}=(0,r.l)(),[j,b]=(0,i.useState)({method:"both",allowOnPageCheckIn:!0,requireRegistration:!1,autoCheckIn:!1}),[f,N]=(0,i.useState)(!1);(0,i.useEffect)((()=>{var e,s,t,i,n;o&&null!==h&&void 0!==h&&h.checkInSettings&&b({method:(null===(e=h.checkInSettings)||void 0===e?void 0:e.method)||"both",allowOnPageCheckIn:!1!==(null===(s=h.checkInSettings)||void 0===s?void 0:s.allowOnPageCheckIn),requireRegistration:null!==(t=null===(i=h.checkInSettings)||void 0===i?void 0:i.requireRegistration)&&void 0!==t&&t,autoCheckIn:(null===(n=h.checkInSettings)||void 0===n?void 0:n.autoCheckIn)||!1})}),[o,null===h||void 0===h||null===(s=h.checkInSettings)||void 0===s?void 0:s.method,null===h||void 0===h||null===(t=h.checkInSettings)||void 0===t?void 0:t.allowOnPageCheckIn,null===h||void 0===h||null===(a=h.checkInSettings)||void 0===a?void 0:a.requireRegistration,null===h||void 0===h||null===(l=h.checkInSettings)||void 0===l?void 0:l.autoCheckIn]);const y=[{title:"Ways to check in",subtitle:"QR code only, link only, or both",action:(0,u.jsxs)("div",{className:"radio-group",children:[(0,u.jsxs)("label",{className:"radio-label",children:[(0,u.jsx)("input",{type:"radio",name:"checkInMethod",value:"qr",checked:"qr"===j.method,onChange:e=>b((s=>({...s,method:e.target.value})))}),(0,u.jsx)("span",{children:"QR only"})]}),(0,u.jsxs)("label",{className:"radio-label",children:[(0,u.jsx)("input",{type:"radio",name:"checkInMethod",value:"link",checked:"link"===j.method,onChange:e=>b((s=>({...s,method:e.target.value})))}),(0,u.jsx)("span",{children:"Link only"})]}),(0,u.jsxs)("label",{className:"radio-label",children:[(0,u.jsx)("input",{type:"radio",name:"checkInMethod",value:"both",checked:"both"===j.method,onChange:e=>b((s=>({...s,method:e.target.value})))}),(0,u.jsx)("span",{children:"Both"})]})]})},{title:"Allow check-in from event page",subtitle:'Show a "Check in" button on the event page during the event',action:(0,u.jsx)("input",{type:"checkbox",checked:j.allowOnPageCheckIn,onChange:e=>b((s=>({...s,allowOnPageCheckIn:e.target.checked})))})},{title:"Require registration to check in",subtitle:"Attendees must register before they can check in",action:(0,u.jsx)("input",{type:"checkbox",checked:j.requireRegistration,onChange:e=>b((s=>({...s,requireRegistration:e.target.checked})))})},{title:"Auto check-in when using link or QR",subtitle:"Skip confirmation and check in immediately",action:(0,u.jsx)("input",{type:"checkbox",checked:j.autoCheckIn,onChange:e=>b((s=>({...s,autoCheckIn:e.target.checked})))})}];return(0,u.jsx)(d.Z,{isOpen:o,onClose:c,customClassName:"event-settings-modal",defaultStyling:!1,hideCloseButton:!0,children:(0,u.jsxs)("div",{className:"event-settings-modal-content",style:p?{"--event-settings-color":p}:void 0,children:[(0,u.jsxs)("div",{className:"event-settings-header",children:[(0,u.jsx)("h3",{children:"Check-In Settings"}),(0,u.jsx)("button",{type:"button",className:"event-settings-close",onClick:c,"aria-label":"Close",children:(0,u.jsx)(n.JO,{icon:"mdi:close"})})]}),(0,u.jsx)("div",{className:"event-settings-body",children:(0,u.jsx)(Te.Z,{items:y})}),(0,u.jsxs)("div",{className:"event-settings-actions",children:[(0,u.jsx)("button",{type:"button",className:"event-settings-btn secondary",onClick:c,children:"Cancel"}),(0,u.jsx)("button",{type:"button",className:"event-settings-btn primary",disabled:f,onClick:async()=>{if(v&&null!==h&&void 0!==h&&h._id){N(!0);try{const e=await(0,m.Z)(`/org-event-management/${v}/events/${h._id}`,{checkInSettings:{method:j.method,allowOnPageCheckIn:j.allowOnPageCheckIn,requireRegistration:j.requireRegistration,autoCheckIn:j.autoCheckIn}},{method:"PUT"});null!==e&&void 0!==e&&e.success?(x({title:"Saved",message:"Check-in settings updated",type:"success"}),c(),null===g||void 0===g||g()):x({title:"Error",message:(null===e||void 0===e?void 0:e.message)||"Failed to save settings",type:"error"})}catch(e){x({title:"Error",message:(null===e||void 0===e?void 0:e.message)||"Failed to save settings",type:"error"})}finally{N(!1)}}},children:f?"Saving...":"Save"})]})]})})};var Ie=t(64885);const Ee=function(e){var s,t,l,o,c,h,v;let{event:x,orgId:j,onRefresh:b,isTabActive:f=!1,color:N}=e;const{addNotification:y}=(0,r.l)(),[w,k]=(0,i.useState)(!1),[C,S]=(0,i.useState)(null),[_,D]=(0,i.useState)(null),[T,O]=(0,i.useState)([]),[I,E]=(0,i.useState)(null),[R,A]=(0,i.useState)(!1),[J,F]=(0,i.useState)(!1),[q,$]=(0,i.useState)(!1),[M,P]=(0,i.useState)(!1),{data:Z,refetch:L}=(0,a.i)(null!==x&&void 0!==x&&x.checkInEnabled&&("qr"===(null===x||void 0===x||null===(s=x.checkInSettings)||void 0===s?void 0:s.method)||"both"===(null===x||void 0===x||null===(t=x.checkInSettings)||void 0===t?void 0:t.method))&&null!==x&&void 0!==x&&x._id&&j?`/events/${x._id}/check-in/qr`:null),{data:U,refetch:V}=(0,a.i)(null!==x&&void 0!==x&&x.checkInEnabled&&("link"===(null===x||void 0===x||null===(l=x.checkInSettings)||void 0===l?void 0:l.method)||"both"===(null===x||void 0===x||null===(o=x.checkInSettings)||void 0===o?void 0:o.method))&&null!==x&&void 0!==x&&x._id&&j?`/events/${x._id}/check-in/link`:null),{data:B,refetch:z}=(0,a.i)(null!==x&&void 0!==x&&x.checkInEnabled&&null!==x&&void 0!==x&&x._id&&j?`/events/${x._id}/check-in/attendees`:null),{data:H,loading:W}=(0,a.i)(R&&null!==x&&void 0!==x&&x._id?`/attendees/${x._id}`:null),G=Boolean(f&&(null===x||void 0===x?void 0:x.checkInEnabled)&&(null===x||void 0===x?void 0:x._id));(0,Ie.tG)(G?x._id:null,(()=>{null===z||void 0===z||z(),null===b||void 0===b||b()})),(0,i.useEffect)((()=>{null!==Z&&void 0!==Z&&Z.success&&S(Z.qrCode)}),[Z]),(0,i.useEffect)((()=>{null!==U&&void 0!==U&&U.success&&D(U.checkInUrl)}),[U]),(0,i.useEffect)((()=>{null!==B&&void 0!==B&&B.success&&(O(B.attendees||[]),E(B.stats||null))}),[B]);const[Q,Y]=(0,i.useState)(!1),K=async e=>{try{const s=await(0,m.Z)(`/events/${x._id}/check-in/${e}`,{},{method:"POST"});if(!s.success)throw new Error(s.message||"Failed to check in user");y({title:"Success",message:"User checked in successfully",type:"success"}),A(!1),await z(),b&&b()}catch(s){y({title:"Error",message:s.message||"Failed to check in user",type:"error"})}},X=e=>e.userId&&(e.userId._id||e.userId.id||e.userId)?String(e.userId._id||e.userId.id||e.userId):null,ee=new Set((T||[]).map(X).filter(Boolean)),se=(null!==H&&void 0!==H&&H.success&&H.attendees||[]).filter((e=>{const s=X(e);return s&&!ee.has(s)}));if(!x)return(0,u.jsx)("div",{className:"event-checkin-tab",children:"Loading..."});const te=async()=>{$(!0);try{const e=await(0,m.Z)(`/events/${x._id}/check-in/enable`,{},{method:"POST"});if(!e.success)throw new Error(e.message||"Failed to enable check-in");y({title:"Success",message:"Check-in is now enabled for this event.",type:"success"}),b&&b()}catch(e){y({title:"Error",message:e.message||"Failed to enable check-in",type:"error"})}finally{$(!1)}};if(!x.checkInEnabled)return(0,u.jsx)("div",{className:"event-checkin-tab",children:(0,u.jsx)(ve.Z,{icon:"jam:qr-code",title:"Check-In Not Enabled",description:"Enable check-in to start tracking attendance with QR code, link, or manual check-in. You can change QR/link options in the Edit tab after enabling.",actions:(0,u.jsxs)("button",{type:"button",className:"enable-checkin-button",onClick:te,disabled:q,children:[(0,u.jsx)(n.JO,{icon:q?"mdi:loading":"fluent:scan-qr-code-24-regular",className:q?"spin":""}),q?"Enabling...":"Enable check-in"]})})});const ie=(null===(c=x.checkInSettings)||void 0===c?void 0:c.method)||"both",ne="qr"===ie||"both"===ie,ae="link"===ie||"both"===ie;return(0,u.jsxs)("div",{className:"event-checkin-tab",children:[(0,u.jsxs)("div",{className:"checkin-header",children:[(0,u.jsxs)("h2",{children:[(0,u.jsx)(n.JO,{icon:"uil:qrcode-scan"}),"Event Check-In"]}),(0,u.jsxs)("div",{className:"checkin-header-actions",children:[(0,u.jsxs)("button",{type:"button",className:"checkin-settings-button",onClick:()=>F(!0),title:"Check-in settings",children:[(0,u.jsx)(n.JO,{icon:"mdi:cog"}),"Settings"]}),(0,u.jsxs)("button",{type:"button",className:"disable-checkin-button",onClick:async()=>{if(null!==x&&void 0!==x&&x._id){P(!0);try{const e=await(0,m.Z)(`/events/${x._id}/check-in/disable`,{},{method:"POST"});if(!e.success)throw new Error(e.message||"Failed to disable check-in");y({title:"Success",message:"Check-in is now disabled for this event.",type:"success"}),b&&b()}catch(e){y({title:"Error",message:e.message||"Failed to disable check-in",type:"error"})}finally{P(!1)}}},disabled:M,title:"Turn off check-in for this event",children:[(0,u.jsx)(n.JO,{icon:M?"mdi:loading":"mdi:account-off",className:M?"spin":""}),M?"Disabling...":"Disable check-in"]}),(0,u.jsxs)("button",{className:"refresh-button",onClick:async()=>{k(!0);try{await Promise.all([L(),V(),z()]),b&&b()}catch(e){console.error("Error refreshing check-in data:",e)}finally{k(!1)}},disabled:w,children:[(0,u.jsx)(n.JO,{icon:w?"mdi:loading":"mdi:refresh",className:w?"spin":""}),w?"Refreshing...":"Refresh"]})]})]}),I&&(0,u.jsxs)("div",{className:"checkin-stats",children:[(0,u.jsx)(g.Z,{title:"Checked In",value:I.totalCheckedIn,icon:"mdi:account-check",iconVariant:"approved"}),(0,u.jsx)(g.Z,{title:"Total Registrations",value:null!==(h=null!==(v=I.totalRegistrations)&&void 0!==v?v:I.totalRSVPs)&&void 0!==h?h:0,icon:"mdi:account-group"}),(0,u.jsx)(g.Z,{title:"Check-In Rate",value:`${I.checkInRate}%`,icon:"mdi:chart-line"})]}),(0,u.jsxs)("div",{className:"checkin-methods",children:[(ne||ae)&&(0,u.jsx)(p.Z,{icon:ne?"fa7-solid:qrcode":"mdi:link",header:ne?"QR Code":"Check-in link",classN:"checkin-section checkin-section-qr",right:_?(0,u.jsxs)("button",{type:"button",className:"copy-checkin-link-btn",onClick:async()=>{if(_)try{await navigator.clipboard.writeText(_),Y(!0),setTimeout((()=>Y(!1)),2e3),y({title:"Copied",message:"Check-in link copied to clipboard",type:"success"})}catch(e){y({title:"Error",message:(null===e||void 0===e?void 0:e.message)||"Failed to copy link",type:"error"})}},title:"Copy check-in link",children:[(0,u.jsx)(n.JO,{icon:Q?"mdi:check":"mdi:link-variant"}),Q?"Copied":"Copy link"]}):ae&&!_?(0,u.jsx)("span",{className:"checkin-link-loading",children:"Loading link\u2026"}):null,children:(0,u.jsx)("div",{className:"checkin-section-content",children:ne?C?(0,u.jsx)(Ce,{qrCode:C,eventName:x.name}):(0,u.jsx)("div",{className:"loading-placeholder",children:"Loading QR code..."}):_?(0,u.jsx)(Se,{checkInUrl:_,eventName:x.name}):(0,u.jsx)("div",{className:"loading-placeholder",children:"Loading link..."})})}),(0,u.jsx)(p.Z,{icon:"mdi:account-check",header:"Checked-In Attendees",subheader:(0,u.jsxs)("span",{children:[T.length," attendees"]}),classN:"checkin-section checkin-section-attendees",children:(0,u.jsx)("div",{className:"checkin-section-content",children:0===T.length?(0,u.jsx)(ve.Z,{icon:"mingcute:user-follow-fill",title:"No attendees have checked in yet",description:"Checked-in attendees will appear here. You can manually check in someone from the list of registrations.",actions:(0,u.jsxs)("button",{type:"button",className:"manual-checkin-button",onClick:()=>A(!0),children:[(0,u.jsx)(n.JO,{icon:"mingcute:user-add-fill"}),"Manually check in attendee"]})}):(0,u.jsx)(De,{attendees:T,onManualCheckIn:K,onRemoveCheckIn:async e=>{try{const s=await(0,m.Z)(`/events/${x._id}/check-out/${e}`,{},{method:"POST"});if(!s.success)throw new Error(s.message||"Failed to remove check-in");y({title:"Success",message:"Check-in removed",type:"success"}),await z(),b&&b()}catch(s){y({title:"Error",message:s.message||"Failed to remove check-in",type:"error"})}},onOpenManualCheckInModal:()=>A(!0)})})})]}),(0,u.jsx)(Oe,{isOpen:J,onClose:()=>F(!1),event:x,orgId:j,color:"var(--org-primary)",onSaved:()=>null===b||void 0===b?void 0:b()}),(0,u.jsx)(d.Z,{isOpen:R,onClose:()=>A(!1),customClassName:"manual-checkin-modal",children:(0,u.jsxs)("div",{className:"manual-checkin-modal-content",children:[(0,u.jsxs)("h3",{children:[(0,u.jsx)(n.JO,{icon:"mdi:account-plus"}),"Manually Check In Attendee"]}),(0,u.jsx)("p",{className:"manual-checkin-modal-hint",children:"Select a registrant who has not checked in yet."}),W?(0,u.jsx)("p",{className:"manual-checkin-modal-loading",children:"Loading registrations..."}):0===se.length?(0,u.jsx)("p",{className:"manual-checkin-modal-empty",children:"Everyone registered has already checked in."}):(0,u.jsx)("ul",{className:"manual-checkin-modal-list",children:se.map((e=>{var s,t;const i=X(e),n=(null===(s=e.userId)||void 0===s?void 0:s.name)||(null===(t=e.userId)||void 0===t?void 0:t.username)||"Unknown";return(0,u.jsx)("li",{children:(0,u.jsx)("button",{type:"button",className:"manual-checkin-modal-item",onClick:()=>K(i),children:n})},i)}))}),(0,u.jsx)("button",{type:"button",className:"manual-checkin-modal-close",onClick:()=>A(!1),children:"Cancel"})]})})]})};var Re=t(73234);const Ae=function(e){var s;let{isOpen:t,onClose:a,event:l,orgId:o,orgForms:c=[],onSaved:h,refetchForms:v,color:g}=e;const{addNotification:p}=(0,r.l)(),[x,j]=(0,i.useState)({registrationRequired:!1,registrationDeadline:null,maxAttendees:null,registrationFormId:null}),[b,f]=(0,i.useState)(!1),[N,y]=(0,i.useState)(!1),[w,k]=(0,i.useState)(null);(0,i.useEffect)((()=>{var e,s,i;t&&l&&j({registrationRequired:null!==(e=l.registrationRequired)&&void 0!==e&&e,registrationDeadline:l.registrationDeadline?new Date(l.registrationDeadline):null,maxAttendees:null!==(s=l.maxAttendees)&&void 0!==s?s:null,registrationFormId:null!==(i=l.registrationFormId)&&void 0!==i?i:null})}),[t,null===l||void 0===l?void 0:l.registrationRequired,null===l||void 0===l?void 0:l.registrationDeadline,null===l||void 0===l?void 0:l.maxAttendees,null===l||void 0===l?void 0:l.registrationFormId]);const C=[{title:"Require registration",subtitle:"Attendees must register to attend",action:(0,u.jsx)("input",{type:"checkbox",checked:x.registrationRequired,onChange:e=>j((s=>({...s,registrationRequired:e.target.checked})))})},{title:"Registration deadline",subtitle:"Last date/time attendees can register",action:(0,u.jsx)("input",{type:"datetime-local",value:x.registrationDeadline?new Date(x.registrationDeadline).toISOString().slice(0,16):"",onChange:e=>j((s=>({...s,registrationDeadline:e.target.value?new Date(e.target.value):null})))})},{title:"Max attendees",subtitle:"Leave empty for no limit",action:(0,u.jsx)("input",{type:"number",value:null!==(s=x.maxAttendees)&&void 0!==s?s:"",onChange:e=>j((s=>({...s,maxAttendees:e.target.value?parseInt(e.target.value,10):null}))),placeholder:"No limit",min:"1"})},{title:"Registration form",subtitle:"Optional form attendees fill out when registering",action:(0,u.jsxs)("div",{className:"registration-form-select-row",children:[(0,u.jsxs)("select",{value:x.registrationFormId||"",onChange:e=>j((s=>({...s,registrationFormId:e.target.value||null}))),children:[(0,u.jsx)("option",{value:"",children:"None"}),c.map((e=>(0,u.jsx)("option",{value:e._id,children:e.title},e._id)))]}),(0,u.jsxs)("button",{type:"button",className:"create-form-btn",onClick:()=>{k(null),y(!0)},children:[(0,u.jsx)(n.JO,{icon:"mdi:plus"}),"Create form"]}),x.registrationFormId&&(0,u.jsxs)("button",{type:"button",className:"edit-form-btn",onClick:()=>{k(x.registrationFormId),y(!0)},children:[(0,u.jsx)(n.JO,{icon:"mdi:pencil"}),"Edit form"]})]})}];return(0,u.jsxs)(u.Fragment,{children:[(0,u.jsx)(d.Z,{isOpen:t,onClose:a,customClassName:"event-settings-modal",defaultStyling:!1,hideCloseButton:!0,children:(0,u.jsxs)("div",{className:"event-settings-modal-content",style:g?{"--event-settings-color":g}:void 0,children:[(0,u.jsxs)("div",{className:"event-settings-header",children:[(0,u.jsx)("h3",{children:"Registration Settings"}),(0,u.jsx)("button",{type:"button",className:"event-settings-close",onClick:a,"aria-label":"Close",children:(0,u.jsx)(n.JO,{icon:"mdi:close"})})]}),(0,u.jsx)("div",{className:"event-settings-body",children:(0,u.jsx)(Te.Z,{items:C})}),(0,u.jsxs)("div",{className:"event-settings-actions",children:[(0,u.jsx)("button",{type:"button",className:"event-settings-btn secondary",onClick:a,children:"Cancel"}),(0,u.jsx)("button",{type:"button",className:"event-settings-btn primary",disabled:b,onClick:async()=>{if(o&&null!==l&&void 0!==l&&l._id){f(!0);try{var e;const s=await(0,m.Z)(`/org-event-management/${o}/events/${l._id}`,{registrationRequired:x.registrationRequired,registrationDeadline:x.registrationDeadline?x.registrationDeadline.toISOString():null,maxAttendees:null!==(e=x.maxAttendees)&&void 0!==e?e:null,registrationFormId:x.registrationFormId||null},{method:"PUT"});null!==s&&void 0!==s&&s.success?(p({title:"Saved",message:"Registration settings updated",type:"success"}),a(),null===h||void 0===h||h()):p({title:"Error",message:(null===s||void 0===s?void 0:s.message)||"Failed to save settings",type:"error"})}catch(s){p({title:"Error",message:(null===s||void 0===s?void 0:s.message)||"Failed to save settings",type:"error"})}finally{f(!1)}}},children:b?"Saving...":"Save"})]})]})}),N&&(0,u.jsx)(Re.Z,{orgId:o,formId:w||void 0,initialForm:w?c.find((e=>e._id===w)):void 0,onCreated:e=>{e&&j((s=>({...s,registrationFormId:e}))),null===v||void 0===v||v(),null===h||void 0===h||h()},onClose:()=>{y(!1),k(null)}})]})},Je=[{id:"table",label:"Table",icon:"mdi:table"},{id:"cards",label:"Cards",icon:"mdi:card-multiple"},{id:"summary",label:"Summary",icon:"mdi:chart-bar"}];const Fe=function(e){var s,t;let{event:l,orgId:o,onRefresh:c,color:h}=e;const{addNotification:v}=(0,r.l)(),[g,p]=(0,i.useState)(!1),[x,j]=(0,i.useState)("table"),[b,f]=(0,i.useState)(null),[N,y]=(0,i.useState)(null),{data:w,loading:k,error:C,refetch:S}=(0,a.i)(null!==l&&void 0!==l&&l._id&&o?`/org-event-management/${o}/events/${l._id}/registration-responses`:null),{data:_,refetch:D}=(0,a.i)(o?`/org-event-management/${o}/forms`:null),T=null!==_&&void 0!==_&&_.success&&_.data||[],[O,I]=(0,i.useState)(!1),[E,R]=(0,i.useState)(null),[A,J]=(0,i.useState)(!1),{registrations:F=[],formResponses:q=[],registrationFormId:$}=(null===w||void 0===w?void 0:w.data)||{},M=Boolean($),P=M?T.find((e=>e._id===$)):null,Z=(0,i.useMemo)((()=>{var e;const s=null===(e=q[0])||void 0===e?void 0:e.formSnapshot;return(null===s||void 0===s?void 0:s.questions)||[]}),[q]),L=(0,i.useMemo)((()=>{if(!M||!Z.length||!q.length)return[];const e=q.length;return Z.map(((s,t)=>{const i={};q.forEach((e=>{var s;const n=null===(s=e.answers)||void 0===s?void 0:s[t];if(void 0===n||null===n)return;const a=(Array.isArray(n)?n.join(", "):String(n).trim())||"(empty)";i[a]=(i[a]||0)+1}));const n="multiple_choice"===s.type||"select_multiple"===s.type,a=Object.entries(i).map((e=>{let[s,t]=e;return{answer:s,count:t}}));a.sort(((e,s)=>s.count-e.count));const l=a.reduce(((e,s)=>e+s.count),0);return{question:s,total:e,answered:l,entries:a,isChoice:n}}))}),[M,Z,q]),U=e=>{e&&navigator.clipboard.writeText(e).then((()=>v({title:"Copied",message:"Email copied to clipboard",type:"success"})),(()=>v({title:"Copy failed",message:"Could not copy to clipboard",type:"error"})))},V=e=>(null===e||void 0===e?void 0:e.name)||(null===e||void 0===e?void 0:e.username)||"\u2014",B=e=>e.submittedBy?V(e.submittedBy):e.guestName||"Guest",z=e=>{return e.submittedBy?(null===(s=e.submittedBy)||void 0===s?void 0:s.email)||"\u2014":e.guestEmail||e.guestUsername||"\u2014";var s};if(k)return(0,u.jsxs)("div",{className:"registrations-tab loading",children:[(0,u.jsx)(n.JO,{icon:"mdi:loading",className:"spinner"}),(0,u.jsx)("p",{children:"Loading registrations..."})]});if(C||w&&!w.success)return(0,u.jsxs)("div",{className:"registrations-tab error",children:[(0,u.jsx)(n.JO,{icon:"mdi:alert-circle"}),(0,u.jsx)("p",{children:C||(null===w||void 0===w?void 0:w.message)||"Failed to load registrations"})]});const H=null!==(s=null===l||void 0===l?void 0:l.registrationCount)&&void 0!==s?s:F.length,W=null!==(t=null===l||void 0===l?void 0:l.registrationEnabled)&&void 0!==t&&t;return(0,u.jsxs)("div",{className:"registrations-tab",children:[!W&&(0,u.jsxs)("div",{className:"registrations-disabled-banner",children:[(0,u.jsxs)("div",{className:"registrations-disabled-content",children:[(0,u.jsx)(n.JO,{icon:"mdi:account-off",className:"disabled-icon"}),(0,u.jsxs)("div",{className:"disabled-text",children:[(0,u.jsx)("strong",{children:"Registration is disabled"}),(0,u.jsx)("p",{children:"Enable registration to allow attendees to register for this event."})]})]}),(0,u.jsxs)("button",{type:"button",className:"enable-registration-btn",onClick:async()=>{if(o&&null!==l&&void 0!==l&&l._id){p(!0);try{const e=await(0,m.Z)(`/org-event-management/${o}/events/${l._id}`,{registrationEnabled:!0},{method:"PUT"});null!==e&&void 0!==e&&e.success?(v({title:"Registration enabled",message:"Registration is now enabled for this event",type:"success"}),null===c||void 0===c||c(),null===S||void 0===S||S()):v({title:"Enable failed",message:(null===e||void 0===e?void 0:e.message)||(null===e||void 0===e?void 0:e.error)||"Failed to enable registration",type:"error"})}catch(e){v({title:"Enable failed",message:(null===e||void 0===e?void 0:e.message)||"Failed to enable registration",type:"error"})}finally{p(!1)}}},disabled:g,children:[(0,u.jsx)(n.JO,{icon:g?"mdi:loading":"mdi:account-plus",className:g?"spin":""}),g?"Enabling...":"Enable Registration"]})]}),(0,u.jsxs)("div",{className:"registrations-tab-header",children:[(0,u.jsxs)("div",{className:"registrations-summary",children:[(0,u.jsx)("span",{className:"count",children:H}),(0,u.jsx)("span",{className:"label",children:"Registrations"}),W&&(0,u.jsxs)("span",{className:"registration-status-badge",children:[(0,u.jsx)(n.JO,{icon:"mdi:check-circle"}),"Enabled"]})]}),(0,u.jsxs)("div",{className:"registrations-tab-actions",children:[W&&(0,u.jsxs)(u.Fragment,{children:[(0,u.jsxs)("button",{type:"button",className:"registration-settings-btn",onClick:()=>J(!0),title:"Registration settings",children:[(0,u.jsx)(n.JO,{icon:"mdi:cog"}),"Settings"]}),(0,u.jsxs)("button",{type:"button",className:"disable-registration-btn",onClick:async()=>{if(o&&null!==l&&void 0!==l&&l._id){p(!0);try{const e=await(0,m.Z)(`/org-event-management/${o}/events/${l._id}`,{registrationEnabled:!1},{method:"PUT"});null!==e&&void 0!==e&&e.success?(v({title:"Registration disabled",message:"Registration is now disabled for this event",type:"success"}),null===c||void 0===c||c(),null===S||void 0===S||S()):v({title:"Disable failed",message:(null===e||void 0===e?void 0:e.message)||(null===e||void 0===e?void 0:e.error)||"Failed to disable registration",type:"error"})}catch(e){v({title:"Disable failed",message:(null===e||void 0===e?void 0:e.message)||"Failed to disable registration",type:"error"})}finally{p(!1)}}},disabled:g,title:"Disable registration",children:[(0,u.jsx)(n.JO,{icon:g?"mdi:loading":"mdi:account-off",className:g?"spin":""}),g?"Disabling...":"Disable"]}),(0,u.jsxs)("button",{type:"button",className:"copy-registration-link-btn",onClick:async()=>{if(null===l||void 0===l||!l._id)return;const e=`${window.location.origin}/event/${l._id}`;try{await navigator.clipboard.writeText(e),v({title:"Copied",message:"Registration link copied to clipboard",type:"success"})}catch{const s=document.createElement("textarea");s.value=e,s.style.position="fixed",s.style.left="-999999px",document.body.appendChild(s),s.select();try{document.execCommand("copy"),v({title:"Copied",message:"Registration link copied to clipboard",type:"success"})}catch{v({title:"Copy failed",message:"Could not copy link to clipboard",type:"error"})}document.body.removeChild(s)}},title:"Copy registration link",children:[(0,u.jsx)(n.JO,{icon:"mdi:link-variant"}),"Copy Link"]})]}),M&&q.length>0&&(0,u.jsxs)(u.Fragment,{children:[(0,u.jsx)("div",{className:"view-mode-toggle",role:"tablist",children:Je.map((e=>(0,u.jsxs)("button",{type:"button",role:"tab","aria-selected":x===e.id,className:x===e.id?"active":"",onClick:()=>j(e.id),title:e.label,children:[(0,u.jsx)(n.JO,{icon:e.icon}),(0,u.jsx)("span",{children:e.label})]},e.id)))}),(0,u.jsxs)("button",{type:"button",className:"export-csv-btn",onClick:()=>{var e;const s=["Name","Email","Registered At",...Z.map((e=>e.question||""))],t=q.map((e=>[B(e),z(e),e.submittedAt?new Date(e.submittedAt).toLocaleString():"",...(e.answers||[]).map((e=>Array.isArray(e)?e.join("; "):String(e)))])),i=[s.join(","),...t.map((e=>e.map((e=>`"${String(e).replace(/"/g,'""')}"`)).join(",")))].join("\n"),n=new Blob([i],{type:"text/csv;charset=utf-8;"}),a=document.createElement("a");a.href=URL.createObjectURL(n),a.download=`registrations-${(null===l||void 0===l||null===(e=l.name)||void 0===e?void 0:e.replace(/\W/g,"-"))||(null===l||void 0===l?void 0:l._id)}.csv`,a.click(),URL.revokeObjectURL(a.href)},children:[(0,u.jsx)(n.JO,{icon:"mdi:download"}),"Export CSV"]})]})]})]}),(0,u.jsxs)("div",{className:"registrations-form-selector",children:[M?(0,u.jsxs)(u.Fragment,{children:[(0,u.jsxs)("div",{className:"registrations-form-info",children:[(0,u.jsxs)("div",{className:"registrations-form-info-content",children:[(0,u.jsx)("label",{children:"Registration form"}),(0,u.jsx)("span",{className:"form-title",children:(null===P||void 0===P?void 0:P.title)||"Untitled Form"})]}),(0,u.jsxs)("div",{className:"registrations-form-actions",children:[(0,u.jsxs)("button",{type:"button",className:"edit-form-btn",onClick:()=>{R($),I(!0)},disabled:g,children:[(0,u.jsx)(n.JO,{icon:"mdi:pencil"}),"Edit"]}),(0,u.jsxs)("button",{type:"button",className:"delete-form-btn",onClick:async()=>{if(o&&null!==l&&void 0!==l&&l._id){p(!0);try{const e=await(0,m.Z)(`/org-event-management/${o}/events/${l._id}`,{registrationFormId:null},{method:"PUT"});null!==e&&void 0!==e&&e.success?(v({title:"Form removed",message:"Registration form has been removed from this event",type:"success"}),null===c||void 0===c||c(),null===S||void 0===S||S()):v({title:"Remove failed",message:(null===e||void 0===e?void 0:e.message)||(null===e||void 0===e?void 0:e.error)||"Failed to remove form",type:"error"})}catch(e){v({title:"Remove failed",message:(null===e||void 0===e?void 0:e.message)||"Failed to remove registration form",type:"error"})}finally{p(!1)}}},disabled:g,children:[(0,u.jsx)(n.JO,{icon:g?"mdi:loading":"mdi:delete-outline",className:g?"spin":""}),"Delete"]})]})]}),g&&(0,u.jsxs)("span",{className:"registrations-form-selector-saving",children:[(0,u.jsx)(n.JO,{icon:"mdi:loading",className:"spin"}),"Saving\u2026"]})]}):(0,u.jsxs)("div",{className:"registrations-form-empty",children:[(0,u.jsxs)("div",{className:"registrations-form-empty-content",children:[(0,u.jsx)(n.JO,{icon:"mdi:form-select",className:"empty-icon"}),(0,u.jsxs)("div",{className:"empty-text",children:[(0,u.jsx)("label",{children:"Registration form"}),(0,u.jsx)("p",{children:"Create a registration form to collect information from attendees when they register for this event."})]})]}),(0,u.jsxs)("button",{type:"button",className:"create-form-btn",onClick:()=>{R(null),I(!0)},children:[(0,u.jsx)(n.JO,{icon:"mdi:plus"}),"Create form"]})]}),O&&(0,u.jsx)(Re.Z,{orgId:o,formId:E||void 0,initialForm:E?T.find((e=>e._id===E)):void 0,onCreated:async e=>{if(null===D||void 0===D||D(),!E&&null!==l&&void 0!==l&&l._id&&o){p(!0);try{const s=await(0,m.Z)(`/org-event-management/${o}/events/${l._id}`,{registrationFormId:e},{method:"PUT"});null!==s&&void 0!==s&&s.success&&(v({title:"Form created",message:"The registration form is now active for this event.",type:"success"}),null===c||void 0===c||c(),null===S||void 0===S||S())}catch(s){v({title:"Form created",message:"There was an issue linking the form to the event.",type:"warning"})}finally{p(!1)}}else E&&(null===c||void 0===c||c(),null===S||void 0===S||S())},onClose:()=>{I(!1),R(null)}})]}),M&&q.length>0?(0,u.jsxs)(u.Fragment,{children:["table"===x&&(0,u.jsx)("div",{className:"registrations-table-wrapper",children:(0,u.jsxs)("table",{className:"registrations-table",children:[(0,u.jsx)("thead",{children:(0,u.jsxs)("tr",{children:[(0,u.jsx)("th",{children:"Name"}),(0,u.jsx)("th",{children:"Email"}),(0,u.jsx)("th",{children:"Submitted"}),Z.map(((e,s)=>(0,u.jsx)("th",{children:e.question||`Q${s+1}`},s))),(0,u.jsx)("th",{className:"th-actions",children:"Actions"})]})}),(0,u.jsx)("tbody",{children:q.map(((e,s)=>(0,u.jsxs)("tr",{children:[(0,u.jsx)("td",{children:B(e)}),(0,u.jsx)("td",{children:z(e)}),(0,u.jsx)("td",{children:e.submittedAt?new Date(e.submittedAt).toLocaleString():"\u2014"}),(e.answers||[]).map(((e,s)=>(0,u.jsx)("td",{children:Array.isArray(e)?e.join(", "):String(null!==e&&void 0!==e?e:"\u2014")},s))),(0,u.jsxs)("td",{className:"td-actions",children:[(0,u.jsx)("button",{type:"button",className:"action-btn copy-email",onClick:()=>{var s;return U((null===(s=e.submittedBy)||void 0===s?void 0:s.email)||e.guestEmail)},title:"Copy email",children:(0,u.jsx)(n.JO,{icon:"mdi:email-outline"})}),(0,u.jsx)("button",{type:"button",className:"action-btn remove",onClick:()=>y({responseId:e._id,name:B(e)}),title:"Remove registration",disabled:b===e._id,children:(0,u.jsx)(n.JO,{icon:b===e._id?"mdi:loading":"mdi:account-minus",className:b===e._id?"spin":""})})]})]},e._id||s)))})]})}),"cards"===x&&(0,u.jsx)("div",{className:"registrations-cards",children:q.map(((e,s)=>(0,u.jsxs)("div",{className:"registration-card",children:[(0,u.jsxs)("div",{className:"registration-card-header",children:[(0,u.jsxs)("div",{className:"registration-card-user",children:[(0,u.jsx)("span",{className:"name",children:B(e)}),(0,u.jsx)("span",{className:"email",children:z(e)})]}),(0,u.jsx)("div",{className:"registration-card-meta",children:e.submittedAt?new Date(e.submittedAt).toLocaleString():"\u2014"}),(0,u.jsxs)("div",{className:"registration-card-actions",children:[(0,u.jsx)("button",{type:"button",className:"action-btn copy-email",onClick:()=>{var s;return U((null===(s=e.submittedBy)||void 0===s?void 0:s.email)||e.guestEmail)},title:"Copy email",children:(0,u.jsx)(n.JO,{icon:"mdi:email-outline"})}),(0,u.jsx)("button",{type:"button",className:"action-btn remove",onClick:()=>y({responseId:e._id,name:B(e)}),title:"Remove registration",disabled:b===e._id,children:(0,u.jsx)(n.JO,{icon:b===e._id?"mdi:loading":"mdi:account-minus",className:b===e._id?"spin":""})})]})]}),(0,u.jsx)("div",{className:"registration-card-answers",children:(e.answers||[]).map(((e,s)=>{var t;return(0,u.jsxs)("div",{className:"registration-card-answer",children:[(0,u.jsx)("span",{className:"q",children:(null===(t=Z[s])||void 0===t?void 0:t.question)||`Q${s+1}`}),(0,u.jsx)("span",{className:"a",children:Array.isArray(e)?e.join(", "):String(null!==e&&void 0!==e?e:"\u2014")})]},s)}))})]},e._id||s)))}),"summary"===x&&(0,u.jsxs)("div",{className:"registrations-summary-view",children:[(0,u.jsxs)("p",{className:"summary-intro",children:[q.length," response",1!==q.length?"s":""," \u2014 breakdown by question"]}),L.map(((e,s)=>{var t;return(0,u.jsxs)("div",{className:"summary-question-block",children:[(0,u.jsx)("h4",{className:"summary-question-title",children:(null===(t=e.question)||void 0===t?void 0:t.question)||`Question ${s+1}`}),(0,u.jsxs)("p",{className:"summary-question-meta",children:[e.answered," of ",e.total," answered"]}),e.isChoice?(0,u.jsx)("div",{className:"summary-bars",children:e.entries.map((s=>{let{answer:t,count:i}=s;const n=e.answered?Math.round(i/e.answered*100):0;return(0,u.jsxs)("div",{className:"summary-bar-row",children:[(0,u.jsx)("span",{className:"summary-bar-label",title:t,children:t}),(0,u.jsx)("div",{className:"summary-bar-track",children:(0,u.jsx)("div",{className:"summary-bar-fill",style:{width:`${n}%`}})}),(0,u.jsx)("span",{className:"summary-bar-count",children:i})]},t)}))}):(0,u.jsx)("div",{className:"summary-text-responses",children:0===e.entries.length?(0,u.jsx)("span",{className:"summary-no-answers",children:"No answers"}):(0,u.jsxs)(u.Fragment,{children:[(0,u.jsx)("ul",{className:"summary-text-list",children:e.entries.slice(0,6).map((e=>{let{answer:s,count:t}=e;return(0,u.jsxs)("li",{children:[(0,u.jsx)("span",{className:"summary-text-answer",children:s.length>100?`${s.slice(0,100)}\u2026`:s}),t>1&&(0,u.jsxs)("span",{className:"summary-text-count",children:["\xd7",t]})]},s)}))}),e.entries.length>6&&(0,u.jsxs)("p",{className:"summary-text-more",children:["+",e.entries.length-6," other answers \u2014 see Table or Cards for full list"]})]})})]},s)}))]})]}):(0,u.jsx)("div",{className:"registrations-list-simple",children:0===F.length?(0,u.jsx)(ve.Z,{icon:"mingcute:group-fill",title:"No registrations yet",description:"Registrations will appear here once people sign up for this event."}):(0,u.jsx)("ul",{children:F.map(((e,s)=>{var t,i;const a=(null===(t=e.userId)||void 0===t?void 0:t._id)||e.userId,l=(null===a||void 0===a||null===(i=a.toString)||void 0===i?void 0:i.call(a))||a;return(0,u.jsxs)("li",{children:[(0,u.jsx)("span",{className:"user",children:V("object"===typeof e.userId?e.userId:null)}),(0,u.jsxs)("span",{className:"meta",children:[e.registeredAt?new Date(e.registeredAt).toLocaleDateString():"",e.guestCount>1?` \xb7 ${e.guestCount} guests`:"",e.checkedIn?" \xb7 Checked in":""]}),(0,u.jsxs)("span",{className:"list-actions",children:[(0,u.jsx)("button",{type:"button",className:"action-btn copy-email",onClick:()=>{var s;return U(null===(s=e.userId)||void 0===s?void 0:s.email)},title:"Copy email",children:(0,u.jsx)(n.JO,{icon:"mdi:email-outline"})}),(0,u.jsx)("button",{type:"button",className:"action-btn remove",onClick:()=>y({userId:l,name:V(e.userId)}),title:"Remove registration",disabled:b===l,children:(0,u.jsx)(n.JO,{icon:b===l?"mdi:loading":"mdi:account-minus",className:b===l?"spin":""})})]})]},l||s)}))})}),(0,u.jsx)(Ae,{isOpen:A,onClose:()=>J(!1),event:l,orgId:o,orgForms:T,refetchForms:D,color:"var(--org-primary)",onSaved:()=>{null===c||void 0===c||c(),null===S||void 0===S||S()}}),N&&(0,u.jsx)(d.Z,{isOpen:!0,onClose:()=>y(null),customClassName:"registrations-confirm-remove-modal",children:(0,u.jsxs)("div",{className:"registrations-confirm-remove-inner",children:[(0,u.jsx)("h3",{children:"Remove registration?"}),(0,u.jsxs)("p",{children:["This will remove ",(0,u.jsx)("strong",{children:N.name})," from the event. They will need to register again to rejoin."]}),(0,u.jsxs)("div",{className:"registrations-confirm-remove-actions",children:[(0,u.jsx)("button",{type:"button",className:"btn-cancel",onClick:()=>y(null),children:"Cancel"}),(0,u.jsx)("button",{type:"button",className:"btn-remove",onClick:()=>(async e=>{const{responseId:s,userId:t}=e||{},i=s||t;if(o&&null!==l&&void 0!==l&&l._id&&i){f(i);try{const e=s?`/org-event-management/${o}/events/${l._id}/registration-responses/${s}`:`/org-event-management/${o}/events/${l._id}/registrations/${t}`,i=await(0,m.Z)(e,null,{method:"DELETE"});null!==i&&void 0!==i&&i.success?(v({title:"Removed",message:"Registration removed",type:"success"}),y(null),null===c||void 0===c||c(),null===S||void 0===S||S()):v({title:"Remove failed",message:(null===i||void 0===i?void 0:i.message)||(null===i||void 0===i?void 0:i.error)||"Failed to remove",type:"error"})}catch(n){v({title:"Remove failed",message:(null===n||void 0===n?void 0:n.message)||"Failed to remove",type:"error"})}finally{f(null)}}})(N),disabled:null!=b,children:b?"Removing\u2026":"Remove"})]})]})})]})};var qe=t(41270);const $e=function(e){let{event:s,orgId:t,onClose:m,className:v=""}=e;const{addNotification:g}=(0,r.l)(),{AtlasMain:p}=(0,o.Q)(),[x,j]=(0,i.useState)(null),[b,f]=(0,i.useState)(!0),[N,y]=(0,i.useState)(0),[w,k]=(0,i.useState)("overview"),[C,S]=(0,i.useState)(!1),{data:_,loading:D,error:O,refetch:I}=(0,a.i)(null!==s&&void 0!==s&&s._id&&t?`/org-event-management/${t}/events/${s._id}/dashboard`:null);(0,i.useEffect)((()=>{null!==_&&void 0!==_&&_.success?(j(_.data),f(!1)):O||_&&!_.success?(g({title:"Error",message:O||(null===_||void 0===_?void 0:_.message)||"Failed to load event dashboard",type:"error"}),f(!1)):D&&f(!0)}),[_,O,D,g]),(0,i.useEffect)((()=>{N>0&&I()}),[N,I]);const E=()=>{y((e=>e+1))},R=(0,i.useCallback)((e=>{k(e),null!==s&&void 0!==s&&s._id&&t&&l.c.track("event_workspace_tab_view",{event_id:s._id,org_id:t,tab:e})}),[null===s||void 0===s?void 0:s._id,t]);(0,i.useEffect)((()=>{null!==s&&void 0!==s&&s._id&&t&&x&&!b&&(l.c.screen("Event Workspace",{event_id:s._id,org_id:t}),l.c.track("event_workspace_view",{event_id:s._id,org_id:t}),l.c.track("event_workspace_tab_view",{event_id:s._id,org_id:t,tab:w}))}),[null===s||void 0===s?void 0:s._id,t,x,b]),(0,i.useEffect)((()=>{if(b||!x)return;const e="true"===new URLSearchParams(window.location.search).get("test-event-onboarding"),s=localStorage.getItem("eventDashboardOnboardingSeen");!e&&s||S(!0)}),[b,x]);const A=(0,i.useCallback)((()=>{"true"===new URLSearchParams(window.location.search).get("test-event-onboarding")||localStorage.setItem("eventDashboardOnboardingSeen","true"),S(!1)}),[]),J=(0,i.useRef)(null),F=(0,i.useRef)({spacer:null,tabsWrapper:null}),q=(0,i.useCallback)((()=>{const e=J.current;if(!e)return;const s=e.closest(".dashboard-overlay")||e.parentElement,t=e.querySelector(".tabbed-container__tabs-wrapper");if(!s||!t)return;const i=s.getBoundingClientRect(),n=F.current.spacer;if("fixed"===t.style.position&&n&&"none"!==n.style.display){n.getBoundingClientRect().top>i.top&&(t.style.position="",t.style.top="",t.style.left="",t.style.width="",t.style.zIndex="",t.style.background="",t.style.borderBottom="",n.style.display="none",n.style.height="0")}else{const e=t.getBoundingClientRect();if(e.top<=i.top){let s=F.current.spacer;s||(s=document.createElement("div"),s.className="event-dashboard-tabs-sticky-spacer",t.parentNode.insertBefore(s,t),F.current.spacer=s),s.style.height=`${e.height}px`,s.style.display="block",t.style.position="fixed",t.style.top=`${i.top}px`,t.style.left=`calc(${i.left}px + 1.5rem)`,t.style.width=`${i.width}px`,t.style.zIndex="100",t.style.background="var(--background)",t.style.borderBottom="1px solid var(--lighterborder)"}}}),[]);if((0,i.useEffect)((()=>{if(b||!x)return;const e=J.current;if(!e)return;const s=e.closest(".dashboard-overlay")||e.parentElement,t=e.querySelector(".tabbed-container__tabs-wrapper");if(!s||!t)return;const i=()=>{requestAnimationFrame(q)};return q(),s.addEventListener("scroll",i,{passive:!0}),window.addEventListener("resize",i),()=>{s.removeEventListener("scroll",i),window.removeEventListener("resize",i);const{spacer:e}=F.current;e&&e.parentNode&&e.parentNode.removeChild(e),t&&(t.style.position="",t.style.top="",t.style.left="",t.style.width="",t.style.zIndex="",t.style.background="",t.style.borderBottom="")}}),[b,x,q]),b)return(0,u.jsx)("div",{className:`event-dashboard ${v}`,children:(0,u.jsxs)("div",{className:"loading-container",children:[(0,u.jsx)(n.JO,{icon:"mdi:loading",className:"spinner"}),(0,u.jsx)("p",{children:"Loading event dashboard..."})]})});if(!x)return(0,u.jsx)("div",{className:`event-dashboard ${v}`,children:(0,u.jsxs)("div",{className:"error-container",children:[(0,u.jsx)(n.JO,{icon:"mdi:alert-circle"}),(0,u.jsx)("p",{children:"Failed to load event dashboard"}),(0,u.jsx)("button",{onClick:m,children:"Close"})]})});const $=[{id:"overview",label:"Overview",icon:"mingcute:chart-bar-fill",description:"Event statistics and quick actions",content:(0,u.jsx)(H,{event:x.event,stats:x.stats,agenda:x.agenda,roles:x.roles,equipment:x.equipment,orgId:t,onRefresh:E,onTabChange:R})},{id:"agenda",label:"Agenda",icon:"mdi:calendar-clock",description:"Build and manage event agenda",content:(0,u.jsx)(xe,{event:x.event,orgId:t,onRefresh:E,isTabActive:"agenda"===w})},{id:"jobs",label:"Jobs",icon:"mdi:briefcase",description:"Manage event jobs and assignments",content:(0,u.jsx)(we,{event:x.event,orgId:t,onRefresh:E})},{id:"analytics",label:"Analytics",icon:"mingcute:chart-line-fill",description:"Detailed event analytics and insights",content:(0,u.jsx)(ke,{event:x.event,orgId:t,onRefresh:E})},{id:"edit",label:"Details",icon:"mdi:pencil",description:"Event details and basic information",content:(0,u.jsx)(ce,{event:x.event,agenda:x.agenda,orgId:t,onRefresh:E})},{id:"registrations",label:"Registrations",icon:"mdi:clipboard-list-outline",description:"View registrations and form responses",content:(0,u.jsx)(Fe,{event:x.event,orgId:t,onRefresh:E,color:"var(--primary-color)"})},{id:"checkin",label:"Check-In",icon:"uil:qrcode-scan",description:"Manage event check-in and attendance",content:(0,u.jsx)(Ee,{event:x.event,orgId:t,onRefresh:E,isTabActive:"checkin"===w,color:"var(--primary-color)"})},{id:"equipment",label:"Equipment",icon:"mdi:package-variant",description:"Manage equipment checkout and tracking",comingSoon:!0,content:(0,u.jsx)(qe.Z,{feature:"Equipment"})},{id:"communications",label:"Communications",icon:"mdi:message-text",description:"Message volunteers and attendees",comingSoon:!0,content:(0,u.jsx)(qe.Z,{feature:"Communications"})}];return(0,u.jsxs)(u.Fragment,{children:[(0,u.jsxs)("div",{ref:J,className:`event-dashboard ${v}`,children:[(0,u.jsx)(h,{event:x.event,stats:x.stats,onClose:m,onRefresh:E,orgId:t}),(0,u.jsx)("div",{className:"event-dashboard-content",children:(0,u.jsx)(c.ZP,{tabs:$,defaultTab:"overview",activeTab:w,onTabChange:R,tabStyle:"default",size:"medium",animated:!0,showTabIcons:!0,showTabLabels:!0,fullWidth:!1,scrollable:!0,lazyLoad:!0,keepAlive:!0,className:"event-dashboard-tabs"})})]}),(0,u.jsx)(d.Z,{isOpen:C,onClose:A,customClassName:"event-dashboard-onboarding-popup",children:(0,u.jsx)(T,{onClose:A})})]})}}}]);
//# sourceMappingURL=286.fae59903.chunk.js.map